# 1. C++åŸºç¡€

###  1.æ™ºèƒ½æŒ‡é’ˆ

æ™ºèƒ½æŒ‡é’ˆä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ï¼š

æ™ºèƒ½æŒ‡é’ˆæ˜¯è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ï¼Œéšå¯¹è±¡é‡Šæ”¾æ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œè¦å’Œæ·±æ‹·è´æµ…æ‹·è´ç»“åˆã€‚

ä»€ä¹ˆæ˜¯æµ…æ‹·è´ï¼š

```c
æµ…æ‹·è´ï¼šæ‹·è´å¯¹è±¡çš„æ¯ä¸ªå­—æ®µå€¼ï¼ŒåŒ…æ‹¬æŒ‡é’ˆçš„åœ°å€ï¼Œä¸å¤åˆ¶æŒ‡é’ˆæŒ‡å‘çš„æ•°æ®ã€‚    ä¸¤ä¸ªå¯¹è±¡æŒ‡å‘åŒä¸€ç‰‡å†…å­˜

```

ä»€ä¹ˆæ˜¯æ·±æ‹·è´

```c
æ·±æ‹·è´ï¼šæ‹·è´å€¼å¯¹è±¡ï¼ŒæŒ‡é’ˆå¯¹è±¡å¼€è¾Ÿæ–°çš„åœ°å€å­˜æ”¾å€¼ï¼Œå†…ä¸ªå¯¹è±¡æ‹¥æœ‰è‡ªå·±çš„å‰¯æœ¬
```

![image-20250714110658850](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714110658850.png)

é—®é¢˜  ï¼š

æµ…æ‹·è´å½“ä¸€ä¸ªå¯¹è±¡ææ„æ—¶ï¼Œä¼šé€ æˆé‡æŒ‡é’ˆï¼ŒäºŒæ¬¡é‡Šæ”¾ç¨‹åºä¼šå´©æºƒ



C++ä¸­æ³¨æ„äº‹é¡¹

å¦‚æœç±»ä¸­åŒ…å«æŒ‡é’ˆæˆå‘˜ï¼Œæˆ–èµ„æºä½ å¿…é¡»ï¼ˆä¸‰æ³•åˆ™ï¼‰

1.å®ç°è‡ªå®šä¹‰çš„æ‹·è´æ„é€ å‡½æ•°ï¼ˆæ·±æ‹·è´ï¼‰

2.è‡ªå®šä¹‰èµ‹å€¼è¿ç®—ç¬¦

3.å®ç°ææ„å‡½æ•°

```c++
#ä¸‰æ³•åˆ™ï¼š
class MYclass{
    public:
    int *data;
    Myclass(int val) //é»˜è®¤æ„é€ 
    {
        data=new int(val);
    }
    //æ·±æ‹·è´æ„é€ 
    Myclass(const Myclass&other)
    {
        data=new int(other->data);
    }
    //é‡è½½èµ‹å€¼è¿ç®—ç¬¦
    Myclass & operator=(const Myclass &other)
    {
        if(this!=other) //ä¸èƒ½åˆ é™¤è‡ªå·±
        {
            delete data;
            date =new (int other->data)
        }
        return *this
    }
    //ææ„å‡½æ•°
    ~Myclass()  
    {
        delete data;//æ‰‹åŠ¨æ˜¯åœ°æ–¹
    }
}
```

 æˆ‘èƒ½ä¸èƒ½è‡ªå®šä¹‰ç±»ä¸­å¯¹è±¡çš„æ—¶å€™ç”¨æ™ºèƒ½æŒ‡é’ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸è¿›è¡Œä¸‰æ³•åˆ™ï¼Œè¿˜æ˜¯å¿…é¡»è¿›è¡Œä¸‰æ³•åˆ™ï¼Œä½†ç°ä»£ C++ ä¸­ï¼Œ**æ™ºèƒ½æŒ‡é’ˆï¼ˆå¦‚ `std::unique_ptr`ã€`std::shared_ptr`ï¼‰å¯ä»¥æ›¿ä»£æ‰‹åŠ¨èµ„æºç®¡ç†ï¼Œä»è€Œé¿å…æ˜¾å¼å®ç°ä¸‰æ³•åˆ™**ï¼Œä½†éœ€æ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚æ–¹æ¡ˆï¼š

### **1. ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼ˆæ¨èç°ä»£ C++ æ–¹å¼ï¼‰**

**é€‚ç”¨åœºæ™¯**ï¼šç±»çš„å”¯ä¸€ç›®çš„æ˜¯ç®¡ç†åŠ¨æ€èµ„æºçš„ç”Ÿå‘½å‘¨æœŸã€‚
**ä¼˜ç‚¹**ï¼š

- **è‡ªåŠ¨é‡Šæ”¾èµ„æº**ï¼šæ™ºèƒ½æŒ‡é’ˆä¼šåœ¨ææ„æ—¶è‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼Œæ— éœ€æ‰‹åŠ¨å®ç°ææ„å‡½æ•°ã€‚
- **ç¦ç”¨æˆ–é»˜è®¤æ‹·è´è¯­ä¹‰**ï¼š
  - `std::unique_ptr`ï¼šé»˜è®¤ç¦ç”¨æ‹·è´ï¼ˆç§»åŠ¨è¯­ä¹‰æ›¿ä»£ï¼‰ï¼Œç›´æ¥é¿å…æµ…æ‹·è´é—®é¢˜ã€‚
  - `std::shared_ptr`ï¼šé»˜è®¤æ”¯æŒæ·±æ‹·è´ï¼ˆå¼•ç”¨è®¡æ•°ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨å®ç°ã€‚

### 1.æ™ºèƒ½æŒ‡é’ˆ

ç§ç±»

```c++
std::unique_ptr  //ç‹¬å æŒ‡é’ˆ ç§»åŠ¨è¯­ä¹‰ ç¦æ­¢æ‹·è´
std::shared_ptr  //è®¡æ•°æŒ‡é’ˆ  é»˜è®¤å®ç°æ·±æ‹·è´ è®¡æ•°å€¼++
std:: weak_ptr //å¼±æŒ‡é’ˆ  
    
//ä½¿ç”¨æ—¶å¿…é¡»åŠ memoryå¤´æ–‡ä»¶
#include <memory>
    //æ ˆä¸Šèµ„æºè‡ªåŠ¨é‡Šæ”¾
    //å †ä¸Šèµ„æºæ‰‹åŠ¨é‡Šæ”¾
    
    
```

#### 1.æ™ºèƒ½æŒ‡é’ˆæ¦‚è¿°

è‡ªåŠ¨åˆ†é…å†…å­˜

![image-20250714113636153](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714113636153.png)

![image-20250714113729628](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714113729628.png)



#### 2. unique_ptrï¼ˆï¼‰



ä¸å¸Œæœ›å¤šä¸ªç±»å…±äº«è¯¥èµ„æº

âœ… æ€»ç»“ä¸€å¥è¯ï¼š

> **`unique_ptr` ç”¨äºèµ„æºçš„ç‹¬å ç®¡ç†ï¼Œè‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼Œé˜²æ­¢æ³„æ¼å’Œè¯¯ç”¨ï¼Œç‰¹åˆ«é€‚åˆå¯¹è±¡ç”Ÿå‘½å‘¨æœŸæ¸…æ™°ã€ä¸éœ€è¦å…±äº«çš„åœºæ™¯ã€‚**

![image-20250714113945480](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714113945480.png)

ä¸‰ç§åˆ›å»ºæ–¹å¼
é€šè¿‡å·²æœ‰è£¸æŒ‡é’ˆåˆ›å»º
é€šè¿‡newæ¥åˆ›å»º
**é€šè¿‡std::make_uniqueåˆ›å»º**
**(æ¨èï¼‰**
unique_ptrå¯ä»¥é€šè¿‡get(è·å–åœ°å€ï¼‰
unique_ptrå®ç°äº†->ä¸â€˜
å¯ä»¥é€šè¿‡->è°ƒç”¨æˆå‘˜å‡½æ•°
å¯ä»¥é€šè¿‡*è°ƒç”¨dereferencing

![image-20250714114134196](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714114134196.png)



![image-20250714115251523](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714115251523.png)

å±€éƒ¨ä½œç”¨åŸŸ{}

```c++
//æ–¹å¼ä¸€ï¼š  åŸå§‹æŒ‡é’ˆåˆ›å»ºç‹¬å æŒ‡é’ˆ
cat *cat1=new cat("mimi");
unique_ptr<cat> cat2{cat1};//å·²ç»å…±äº«ä¸€å—æŒ‡é’ˆåœ°å€äº†
delete cat1; //é‡Šæ”¾åé‡æŒ‡é’ˆ  ç›´æ¥ç½®ç©ºä¸éœ€è¦å†é‡Šæ”¾
cat1=nullptr;
```

é€šè¿‡åŸå§‹æŒ‡é’ˆèµ‹å€¼åè¦é”€æ¯åŸå§‹æŒ‡é’ˆï¼Œå› ä¸ºä»–ä¼šè·ŸåŸå§‹æŒ‡é’ˆæ”¹å˜ï¼Œè¾¾ä¸åˆ°ç‹¬å çš„æ•ˆæœã€‚

![image-20250714115835941](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714115835941.png)

```
â— ä¸ºä»€ä¹ˆä¸åº”è¯¥è¿™æ ·å†™ï¼Ÿ
1. unique_ptr æ˜¯ç‹¬å æ‰€æœ‰æƒçš„æ™ºèƒ½æŒ‡é’ˆ
å½“ä½ å†™ï¼š

cpp
Copy code
std::unique_ptr<cat> cat2{cat1};
å®é™…ä¸Šæ˜¯æŠŠä¸€ä¸ª å·²ç»ç”± new åˆ›å»ºå¹¶ä¸”ä»è¢« cat1 ç®¡ç† çš„å¯¹è±¡ï¼Œäº¤ç»™äº† unique_ptr æ¥æ‰˜ç®¡ã€‚è¿™ä¼šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š

âŒ é”™è¯¯ä¸€ï¼šcat1 ä»ç„¶æŒæœ‰è£¸æŒ‡é’ˆï¼Œå’Œ cat2 å…±äº«åŒä¸€å—å †å†…å­˜
cat2 ç°åœ¨æ‹¥æœ‰è¿™å—å†…å­˜çš„é‡Šæ”¾æƒã€‚

cat1 ä»ç„¶å¯ä»¥è®¿é—®å®ƒï¼Œä½†ä¸åº”å†è´Ÿè´£é‡Šæ”¾ï¼Œå¦åˆ™å°±æ˜¯é‡å¤é‡Šæ”¾ã€‚

âŒ é”™è¯¯äºŒï¼šä½ åé¢è¿˜æ‰‹åŠ¨ delete cat1
cpp
Copy code
delete cat1;
è¿™ç›¸å½“äºæ‰‹åŠ¨é‡Šæ”¾äº†ä¸€å—å·²ç»äº¤ç»™ unique_ptr ç®¡ç†çš„å †å†…å­˜ï¼Œç­‰ cat2 è¢«é”€æ¯æ—¶ï¼Œå®ƒä¼šå†æ¬¡ deleteï¼Œè¿™å°†å¯¼è‡´äºŒæ¬¡é‡Šæ”¾ï¼ˆdouble freeï¼‰é”™è¯¯ï¼
```

```c++
//æ–¹å¼äºŒï¼š  æ˜¾ç¤ºå†™
unique_ptr<cat> cat2{new cat("cat")}
```

```c++
//æ–¹å¼ä¸‰  make_ptr  æ¨è
unique_ptr<car> cat=make_unique<cat>("mini")
```

![image-20250714121242323](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714121242323.png)

è‡ªåŠ¨é‡Šæ”¾  ä¸éœ€è¦æ‰‹åŠ¨delet

```c++
//get()  å‡½æ•° æ‰“å°åœ°å€

```



![image-20250714121521555](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714121521555.png)

![image-20250714121556965](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714121556965.png)



#### 3.unique_pträ¸å‡½æ•°

å› ä¸ºæˆ‘æ˜¯ç‹¬å æŒ‡é’ˆ  ä¸å¯èƒ½æœ‰copyçš„å‰¯æœ¬

1.åšä¸ºå‚æ•°ä¼ é€’

â€‹	ä¼ value  moveï¼ˆï¼‰//ä½œä¸ºiå³å€¼  ä¸å¯ä»¥åšä¸ºå·¦å€¼copyï¼Œ

â€‹	ä½œä¸ºå¼•ç”¨

```c++
void do_trans_val(unique_ptr<cat> b)
{
	b.reset() //æƒ…ç©ºæŒ‡é’ˆæ‰€æœ‰åœ°æ–¹éƒ½ä¸èƒ½è®¿é—®
}

void do_trans_cue(const unique_ptr<cat> &c)//å¼•ç”¨ä¸æ¶‰åŠæ‰€æœ‰æƒè½¬ç§»
{
//const  ä¿®é¥°çš„æ˜¯ç‹¬å æŒ‡é’ˆ  ä»»ç„¶å¯ä»¥ä¿®æ”¹å€¼
    c->set()
        //ä¸å¯ä»¥è°ƒç”¨ c.reset() æƒ…ç©ºæŒ‡é’ˆ
}

unique_ptr retern_()
{
    unique_ptr<cat>  c=make_unique<cat>("c");
    return c;
}
int main()
{
	unique_ptr<cat>  a=make_unique<cat>("a");
    //1.å€¼ä¼ é€’
    do_trans_val(a); // é”™è¿™é‡Œæ—¢ç„¶ä½œä¸ºå·¦å€¼ä¼ å‚  æŠ¥é”™ä¼šæ‹·è´
    do_trans_val(std::move(a))//åªèƒ½é€šè¿‡moveçš„æ ¼å¼å°†ç‹¬å æŒ‡é’ˆç§»åŠ¨ç»™å¦ä¸€ä¸ªå¯¹è±¡  ä»¥åå°±ä¸èƒ½å†è®¿é—®aäº†å› ä¸ºå·²ç»è¢«ç§»åŠ¨
     //2.å¼•ç”¨  ä¿®æ”¹å€¼
    do_trans_cue(a);//ä½œä¸ºå¼•ç”¨  å¹¶ä¸ä¼šè®¾åŠæ‹·è´ï¼Œ  åé¢è¿˜å¯ä»¥è®¿é—®
    //3.ä½œä¸ºè¿”å›å€¼  é“¾å¼å¼•ç”¨
    retern_->info();
    
    a.get()//è¿”å›çš„æ˜¯æŒ‡å‘å†…å­˜çš„åœ°å€
    &a è¿”å›çš„æ˜¯ç‹¬å æŒ‡é’ˆçš„åœ°å€ã€‚
}
```





#### 4. è®¡æ•°æŒ‡é’ˆ shared_ptr

å…±äº«æŒ‡é’ˆï¼Œè®¡æ•°å€¼é˜µï¼ˆå¯ä»¥copyï¼‰

èµ‹å€¼çš„æ˜¯æŒ‡é’ˆ  ï¼Œå¤šä¸ªå¯¹è±¡æŒ‡å‘åŒä¸€å—åœ°å€ ï¼ˆé‚£ä¸æ˜¯æµ…æ‹·è´å—  ä½†æ˜¯é‡Šæ”¾ååªæ˜¯è®¡æ•°å€¼.get_count--ï¼Œå¹¶ä¸ä¼šæœ‰é‡æŒ‡é’ˆå‡ºç° ï¼‰  

ğŸŸ© å³ä½¿å¤šä¸ª `shared_ptr` æŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œ**åªæœ‰æœ€åä¸€ä¸ªä¼š delete å®ƒ**ã€‚

âœ… 3. å†…å­˜é‡Šæ”¾æ˜¯å¼•ç”¨è®¡æ•°ç®¡ç†çš„ï¼ˆéæµ…æ‹·è´ï¼‰

```c++
std::shared_ptr<Cat> p1 = std::make_shared<Cat>("mimi");  // count=1
std::shared_ptr<Cat> p2 = p1;                             // count=2
p1.reset();                                               // count=1
p2.reset();                                               // count=0 â†’ é‡Šæ”¾å†…å­˜

```

æ¯æ¬¡ `.reset()` æˆ–ä½œç”¨åŸŸç»“æŸï¼Œå¼•ç”¨è®¡æ•° `--`ï¼Œå½“è®¡æ•°ä¸º 0 æ—¶æ‰ delete å†…å­˜ã€‚

//å¦‚æœæ”¹å˜a  bä¹Ÿä¼šå˜  æ”¹å˜b  aä¹Ÿä¼šå˜

![image-20250714145535816](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714145535816.png)

![image-20250714145607096](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714145607096.png)



```c++
shared_ptr<int> a=make_shared<int>(10);
a.use_count();//è·å–è®¡æ•°å€¼  1


shared_ptr<int> b=a; //cpoy
a.use_count();//è·å–è®¡æ•°å€¼  2
b.use_count();//è·å–è®¡æ•°å€¼  2 
//å¦‚æœæ”¹å˜a  bä¹Ÿä¼šå˜  æ”¹å˜b  aä¹Ÿä¼šå˜

```



![image-20250714150654221](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714150654221.png)





è‡ªå®šä¹‰ç±»å‹

```c++
//æ•°æ®æ°¸è¿œåªæœ‰ä¸€å¥—   åªæœ‰æœ€åçš„è®¡æ•°å€¼ä¸º0æ‰ä¼šé”€æ¯

shared_ptr<cat> cat=make_shared<cat>("cat");
cat.get_count();
shared_ptr<cat> cat2=cat;
shared_ptr<cat> cat3=cat;

cat.reset();
cout<<cat.get_count();



```





#### 5. shared_pträ¸å‡½æ•°

![image-20250714151140267](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714151140267.png)

1ã€‚å‚æ•°

â€‹	å¯ä»¥ç›´æ¥ä¼ å€¼ valeu  ï¼ˆå‡ºäº†å‡½æ•°  å°±--   å±€éƒ¨ä½œç”¨åŸŸç»“æŸ   ä½†æ˜¯åœ¨å‡½æ•°é‡Œæ”¹å˜å€¼è‚¯å®šä¹Ÿä¼šå˜ å…±äº«å†…å­˜ï¼‰

â€‹	ref

2.å‡½æ•°è¿”å›å€¼



- `at_p` æ˜¯ä¸€ä¸ªå±€éƒ¨ `shared_ptr`ï¼Œå¼•ç”¨è®¡æ•° = 1ã€‚
- `return` çš„æ—¶å€™ï¼Œ**cat_p æ‰€ç®¡ç†çš„èµ„æºçš„å¼•ç”¨è®¡æ•°ä¼šè¢«â€œè½¬äº¤â€ç»™å¤–éƒ¨**ï¼Œå¼•ç”¨è®¡æ•°ä»ç„¶ä¿æŒåœ¨ 1ï¼ˆæœªå˜ä¸º 2ï¼‰ã€‚
- ç”±äºæ˜¯è¿”å›å€¼ä¼˜åŒ–ï¼ˆRVOï¼‰æˆ– move è¯­ä¹‰ï¼Œæ‰€ä»¥**æ²¡æœ‰å¢åŠ å¼•ç”¨è®¡æ•°**ã€‚

```c++
std::shared_ptr<Cat> get_shared_ptr()
{
    std::shared_ptr<Cat> cat_p = std::make_shared<Cat>("local cat");
    return cat_p;
}



```

```c++
std::shared_ptr<Cat> c_p = get_shared_ptr();  // ç¬¬ä¸€æ¬¡ get_shared_ptr()
c_p->cat_info();  // è°ƒç”¨ cat_info()

get_shared_ptr()->cat_info();  // ç¬¬äºŒæ¬¡ get_shared_ptr()
cout << "------ yz ------" << endl;

```

å› ä¸ºä½ è°ƒç”¨äº† **`get_shared_ptr()` ä¸¤æ¬¡**ï¼Œæ¯æ¬¡éƒ½æ„é€ äº†ä¸€ä¸ªæ–°çš„ `Cat("local cat")` å¯¹è±¡ã€‚

æ¯ä¸ªå¯¹è±¡éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œ**åˆ†åˆ«æ„é€ ã€åˆ†åˆ«é”€æ¯**ã€‚

#### 6. shared_ptrå’Œunique_ptrçš„è½¬åŒ–

å°†unique_ptr  è½¬åŒ–share_ptr

![image-20250714152753571](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714152753571.png)

 ![image-20250714152919576](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714152919576.png)



![image-20250714153054603](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714153054603.png)

![image-20250714153228509](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714153228509.png)

#### 7. weak_ptræ˜¯shared_ptrçš„è¡¥å……

å¾ªç¯ä»¥æ¥é—®é¢˜

å¼±å¼•ç”¨

![image-20250714153320299](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714153320299.png)



![image-20250714153419804](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714153419804.png)



![image-20250714153452818](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714153452818.png)

æˆ‘ä¸ç†è§£   æ²¡æ‡‚ä¸ºä»€ä¹ˆä¼šé”æ­»

ChatGPT said:

å¤ªå¥½äº†ï¼Œä½ é—®å¾—éå¸¸å…³é”®ï¼Œæˆ‘ä»¬è¿™å°±ç”¨æœ€é€šä¿—çš„è¯­è¨€å’Œä¸€æ­¥æ­¥ä»£ç æ¥çœ‹æ¸…æ¥š â€”â€” **ä¸ºä»€ä¹ˆ `shared_ptr` çš„å¾ªç¯å¼•ç”¨ä¼šå¯¼è‡´â€œé”æ­»â€ï¼ˆå†…å­˜æ°¸è¿œä¸é‡Šæ”¾ï¼‰**ã€‚

ğŸ§  **å…ˆç†è§£ `shared_ptr` çš„æ ¸å¿ƒæœºåˆ¶ï¼šå¼•ç”¨è®¡æ•°**

```
cppCopyEditstd::shared_ptr<Cat> p1 = std::make_shared<Cat>("mimi");
std::shared_ptr<Cat> p2 = p1;  // å¼•ç”¨è®¡æ•° +1
```

ç°åœ¨è¿™å— `Cat` å¯¹è±¡çš„å¼•ç”¨è®¡æ•°æ˜¯ 2ï¼Œåªæœ‰å½“è®¡æ•°å‡ä¸º 0 æ—¶ï¼Œ`Cat` æ‰ä¼šè¢«ææ„å’Œé‡Šæ”¾



```
struct B;  // å‰å‘å£°æ˜

struct A {
    std::shared_ptr<B> b_ptr;
    ~A() { std::cout << "A destroyed\n"; }
};

struct B {
    std::shared_ptr<A> a_ptr;
    ~B() { std::cout << "B destroyed\n"; }
};

int main() {
    std::shared_ptr<A> a = std::make_shared<A>();  // Aå¼•ç”¨è®¡æ•° = 1
    std::shared_ptr<B> b = std::make_shared<B>();  // Bå¼•ç”¨è®¡æ•° = 1

    a->b_ptr = b;  // Bå¼•ç”¨è®¡æ•° = 2ï¼ˆa æ‹¥æœ‰ bï¼‰
    b->a_ptr = a;  // Aå¼•ç”¨è®¡æ•° = 2ï¼ˆb æ‹¥æœ‰ aï¼‰

    // main() ç»“æŸï¼Œa å’Œ b ç¦»å¼€ä½œç”¨åŸŸï¼Œè®¡æ•° -1
    // ä½†æ˜¯ a->b_ptr å’Œ b->a_ptr ä»å­˜åœ¨ï¼Œå¼•ç”¨è®¡æ•°å„ä¸º 1ï¼
}

```

ğŸ”„ å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

| å¯¹è±¡ | è¢«è°æŒæœ‰               | å¼•ç”¨è®¡æ•° |
| ---- | ---------------------- | -------- |
| `a`  | `main()` å’Œ `b->a_ptr` | 2        |
| `b`  | `main()` å’Œ `a->b_ptr` | 2        |



- `main()` ç»“æŸåï¼Œ`a` å’Œ `b` çš„å¼•ç”¨è®¡æ•°å„å‡ 1
- ä½† `a->b_ptr` å’Œ `b->a_ptr` è¿˜æ´»ç€ â†’ è®¡æ•°ä»ç„¶æ˜¯ 1

ğŸ’¥ **æ‰€ä»¥ï¼š`A` å’Œ `B` å¯¹è±¡éƒ½â€œé”åœ¨å¯¹æ–¹æ‰‹é‡Œâ€ â†’ æ²¡äººèƒ½é‡Šæ”¾å®ƒä»¬ï¼Œææ„å‡½æ•°ä¹Ÿä¸ä¼šè°ƒç”¨ï¼**



```c
#include <iostream>
#include <memory>

struct B;  // å‰å‘å£°æ˜

struct A {
    std::shared_ptr<B> b_ptr;
    ~A() { std::cout << "A destroyed\n"; }
};

struct B {
    std::weak_ptr<A> a_ptr;  // â—å…³é”®ï¼šä¸å‚ä¸å¼•ç”¨è®¡æ•°
    ~B() { std::cout << "B destroyed\n"; }
};

int main() {
    std::shared_ptr<A> a = std::make_shared<A>();  // A: use_count = 1
    std::shared_ptr<B> b = std::make_shared<B>();  // B: use_count = 1

    a->b_ptr = b;            // B: use_count = 2ï¼ˆa->b_ptr åŠ 1ï¼‰
    b->a_ptr = a;            // A: use_count = 1  ä¸å˜ï¼ˆa_ptr æ˜¯ weakï¼‰

    // ç¦»å¼€ä½œç”¨åŸŸï¼Œa å’Œ b è¢«é”€æ¯
}

```

âœ… ç¬¬ä¸‰æ­¥ï¼šmain() ç¦»å¼€ä½œç”¨åŸŸï¼ˆå¼€å§‹é‡Šæ”¾ï¼‰

1. `main()` ä¸­çš„ `shared_ptr<A> a` è¢«é”€æ¯ï¼Œ`A` çš„å¼•ç”¨è®¡æ•° -1 â†’ 0
   - è§¦å‘ `A` çš„ææ„å‡½æ•°ï¼Œé‡Œé¢çš„ `b_ptr` è¢«é”€æ¯
2. `b_ptr` æ˜¯ `shared_ptr<B>`ï¼Œå®ƒæ˜¯ `B` çš„ç¬¬ 2 ä¸ªå¼•ç”¨ï¼Œç°åœ¨ä¹Ÿè¢«é”€æ¯
   - `B` çš„å¼•ç”¨è®¡æ•° -1 â†’ ä» 2 å˜æˆ 1
3. `main()` ä¸­çš„ `shared_ptr<B> b` ç¦»å¼€ä½œç”¨åŸŸ
   - `B` çš„å¼•ç”¨è®¡æ•°å† -1 â†’ å˜æˆ 0

âœ… æ­¤æ—¶ï¼š**å¼•ç”¨è®¡æ•° = 0 â†’ è‡ªåŠ¨ææ„ B**





```c++
shared_ptr<cat> s=make_shared<cat>("cc")
weak_ptr<c> w(s);

s.get_count();//1
w.get_count();//1  ä¸ä¼šåŠ 1 ä¸å¯ä»¥ç”¨->  * 
shared_ptr s2=w.lock();
s.get_count();//2
w.get_count();//2  

```

![image-20250714160018551](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714160018551.png)



![image-20250714160315252](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714160315252.png)

æœ€ä¸‹é¢çš„æ”¹æˆweak_ptrå°±å¥½äº†   weak_ptr=shared_ptræ˜¯å¯ä»¥çš„



![image-20250714160333234](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714160333234.png)

##### 1. waker_ptrè§£å†³äº†ä»€ä¹ˆé—®é¢˜

å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œ

ä¸¤ä¸ªæˆ–å¤šä¸ªå¯¹è±¡ä¸­äº’ç›¸æ‹¥æœ‰å¯¹æ–¹çš„shared_ptræ—¶ï¼Œä¼šå‡ºç°è®¡æ•°å€¼ä¸ä¸º0ï¼Œ å†…å­˜æ³„æ¼ï¼Œå¯¹è±¡æ²¡æœ‰è¢«é‡Šæ”¾

![image-20250714210304156](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714210304156.png)



å¯ä»¥ä½¿ç”¨è£¸æŒ‡é’ˆè§£å†³ï¼Œä½†æ˜¯æ—¶åˆ»è¦å…³æ³¨æ˜¯å¦å¯¹è±¡è¢«é‡Šæ”¾

![image-20250714210439796](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714210439796.png)

![image-20250714210452124](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714210452124.png)

##### 2. weaker_ptrçš„åº•å±‚åŸç†

è®¡æ•°å€¼å¹¶ä¸ä¼šâ€”++ï¼›æ²¡æœ‰* å’Œ->

![image-20250714210547058](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714210547058.png)

å…±äº«æ§åˆ¶å—å’Œå¼•ç”¨è®¡æ•°æœºåˆ¶ï¼š

1.   Muse_count è®°å½•shared_ptrçš„å¼•ç”¨è®¡æ•°ï¼Œç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ
2. M_weak_countè®°å½•weak_ptrçš„å¼•ç”¨è®¡æ•°+Muse_count!=0?1:0,ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
3. åˆ›å»ºweak_ptræ—¶ï¼ŒæŒ‡å‘ä¸ä¹‹å…³è”çš„shared_ptrç›¸åŒçš„æ§åˆ¶å—å¹¶æºè‡ªé€’å¢M_weak_countï¼›
4. ææ„æ—¶æºè‡ªé€’å‡
5. weak_pträ¸æ“ä½œM_use_countï¼Œæ•…ä¸å½±å“å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ

![image-20250714211235579](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714211235579.png)

 







##### 3. weak_ptrå’Œshared_ptrçš„åŒºåˆ«

shared_ptr  å¤šä¸ªå¯¹è±¡å…±äº«ä¸€ä¸ªèµ„æºï¼Œç»´æŠ¤ä¸€ä¸ªè®¡æ•°å€¼,get_counterï¼Œæœ€åä¸€ä¸ªå¯¹è±¡é”€æ¯æ—¶è°ƒç”¨ä¸€æ¬¡delet å…·æœ‰*ï¼Œ-ã€‹åŠŸèƒ½ï¼›



weak_ptrå¯ä»¥è½¬åŒ–ä¸ºshared_ptr(å¼ºè½¬æˆ–è€…  .lock())

![image-20250714211439052](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714211439052.png)

##### 4.å¦‚ä½•ä½¿ç”¨weak_ptr

ä¸¤ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªä½¿ç”¨weak_ptr  å¦ä¸€ä¸ªshared_ptr;   

lock





### 2. llamaba è¡¨è¾¾å¼  function   lambda bindä¹‹é—´çš„å…³ç³»

![image-20250714175250289](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714175250289.png)



function ç±»æ¨¡æ¿

lambda è¡¨è¾¾å¼

bind  å‡½æ•°é€‚é…å™¨

#### 1.function  ç±»æ¨¡æ¿  C++11 

void (*fun)(void)  å‡½æ•°æŒ‡é’ˆ

æœ‰å¾ˆå¤šä¸åŒçš„å‡½æ•°å¯¹è±¡

ä»¿å‡½æ•°  llambda  bind  äº§ç”Ÿçš„å‡½æ•°å¯¹è±¡  ç”¨ä¸€ä¸ªç±»å‹çº¦æŸ  std::functionæ˜¯ç”¨æ¥æè¿°å‡½æ•°å¯¹è±¡çš„

â€‹	functionæ˜¯ä¸€ä¸ªæŠ½è±¡äº†å‡½æ•°å‚æ•°å’Œå‡½æ•°è¿”å›å€¼çš„ç±»æ¨¡æ¿ï¼›

- æŠ½è±¡ï¼š**æŠŠä»»æ„å‡½æ•°åŒ…è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥ä¿å­˜ ä¼ é€’ å¤åˆ¶**

â€‹	   åŠ¨æ€ç»‘å®šï¼Œåªéœ€ä¿®æ”¹è¯¥å¯¹è±¡ï¼ˆèµ‹å€¼ä¸åŒçš„functionå¯¹è±¡ï¼‰ï¼Œå®ç°ç±»ä¼¼å¤šæ€çš„æ•ˆæœ

##### 1. ç”¨é€”ï¼šä¿å­˜æ™®é€šå‡½æ•°ã€ç±»é™æ€æˆå‘˜å‡½æ•°static

âœ… ç±»çš„é™æ€æˆå‘˜å‡½æ•°å’Œç±»çš„æ™®é€šæˆå‘˜å‡½æ•°çš„åŒºåˆ«

ğŸ§  æ€»ä½“åŒºåˆ«ä¸€å¥è¯æ€»ç»“ï¼š

> **æ™®é€šæˆå‘˜å‡½æ•°** ä¾èµ–å¯¹è±¡è°ƒç”¨ï¼Œèƒ½è®¿é—®ç±»çš„å®ä¾‹å˜é‡ï¼›
>  **é™æ€æˆå‘˜å‡½æ•°** å±äºç±»æœ¬èº«ï¼Œä¸ä¾èµ–å¯¹è±¡ï¼Œä¹Ÿ**ä¸èƒ½è®¿é—®å®ä¾‹å˜é‡**ã€‚

```c++
class MyClass {
public:
    int value;                    // å®ä¾‹å˜é‡
    static int count;            // é™æ€å˜é‡

    void normalFunc() {
        std::cout << "value = " << value << std::endl;    // âœ…å¯ä»¥è®¿é—®å®ä¾‹æˆå‘˜
        std::cout << "count = " << count << std::endl;    // âœ…ä¹Ÿå¯ä»¥è®¿é—®é™æ€æˆå‘˜
    }

    static void staticFunc() {
        // std::cout << "value = " << value << std::endl; // âŒé”™è¯¯ï¼Œä¸èƒ½è®¿é—®å®ä¾‹å˜é‡
        std::cout << "count = " << count << std::endl;    // âœ…å¯ä»¥è®¿é—®é™æ€æˆå‘˜
    }
};

int MyClass::count = 0;

int main() {
    MyClass obj;
    obj.value = 42;
    MyClass::count = 10;

    obj.normalFunc();      // âœ… éœ€è¦å¯¹è±¡è°ƒç”¨
    MyClass::staticFunc(); // âœ… ä¸éœ€è¦å¯¹è±¡ï¼Œå¯ä»¥ç”¨ç±»åè°ƒç”¨
}

```



> ![image-20250714171007080](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714171007080.png)

â€‹	![image-20250714171023262](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714171023262.png)

![image-20250714171040036](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714171040036.png)

```c++
function<void(int)> f_hello=hello;
f_hello(1);
function<void(int)> f_hello_addr=&hello;
f_hello_addr(2);
function<void(int)>  f3=&StaticFunc::hello;



```



![image-20250714171455548](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714171455548.png)

##### 2. ä¿å­˜ä»¿å‡½æ•° é—­åŒ…ï¼ˆå¯ä»¥æœ‰çŠ¶æ€çš„å‡½æ•°  æ¯”å¦‚æ“ä½œi å¹‚ä¸ç­‰çš„æ“ä½œï¼‰

ä»¿å‡½æ•°ï¼šé‡è½½ï¼ˆï¼‰æ˜¯ä¸€ä¸ªé‡è½½äº†ï¼ˆï¼‰çš„ç±»

ç‰¹å¾ï¼š å¯ä»¥æœ‰çŠ¶æ€ï¼Œé€šè¿‡æˆå‘˜å˜é‡å­˜å‚¨çŠ¶æ€

â€‹	    æœ‰çŠ¶æ€çš„å‡½æ•°å¯¹è±¡æˆä¸ºé—­åŒ…

![image-20250714175212773](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714175212773.png)

![image-20250714171418938](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714171418938.png)

```c
function(void<int>) f4=Hello();//ä»¿å‡½æ•°  å‡½æ•°å¯¹è±¡
f4(4);  //4
f4(4);  //8
function(void<int,int>) f5=Hello();//æ„é€ å‡½æ•° ç”Ÿæˆä»¿å‡½æ•°å¯¹è±¡  æ ¹æ®å‚æ•°æ‰¾åˆ°é‡è½½ç¬¦



```

##### 3.æ™®é€šç±»æˆå‘˜å‡½æ•°

æˆå‘˜å‡½æ•°çš„å°è£…éœ€è¦åˆ›å»ºä¸€ä¸ªè¯¥ç±»çš„å®ä¾‹  æ‰€ä»¥éœ€è¦ç±»æŒ‡é’ˆå’Œå‚æ•°ç±»å‹   ï¼Œè¿™ä¸€ç‚¹å’Œé™æ€æˆå‘˜å‡½æ•°åŒºåˆ«ï¼›

```c
function<void(CHello*,int)>    h6=&CHELLO::hello;
Chello c;
h6(&c,7);
```

![image-20250714173242389](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714173242389.png)





##### 4.ä¿å­˜llambdaè¡¨è¾¾å¼

æ˜¯ä»€ä¹ˆï¼šè¯­æ³•å¡˜->æ–¹ä¾¿åˆ›å»ºåŒ¿åå‡½æ•°å¯¹è±¡çš„**è¯­æ³•å¡˜**

æ„æˆï¼š [æ•è·åˆ—è¡¨ å¤–éƒ¨å˜é‡]ï¼ˆå‚æ•°åˆ—è¡¨ï¼‰-> void è¿”å›å€¼{  å‡½æ•°ä½“}

â€‹		[]  æ•è·åˆ—è¡¨ ï¼š  æŒ‡å®šå‡½æ•°å†…éƒ¨å¯ä»¥è®¿é—®çš„å¤–éƒ¨å˜é‡  

â€‹			æœ¬è´¨æ˜¯ï¼šå¤–éƒ¨å˜é‡å°†è½¬å˜ä¸ºç±»çš„æˆå‘˜å˜é‡

â€‹		ï¼ˆï¼‰å‚æ•°åˆ—è¡¨ï¼š

â€‹		->  è¿”å›å€¼  ï¼šå¯ä»¥çœç•¥  å› ä¸ºæœ‰ç±»å‹æ¨å¯¼

â€‹		{} å‡½æ•°ä½“ï¼š

åŸç†ï¼šç¼–è¯‘çš„æ—¶å€™å°†lambdaè½¬åŒ–ä¸ºå‡½æ•°å¯¹è±¡

â€‹	  æ ¹æ®å‚æ•°åˆ—è¡¨é‡è½½operator()  å¦‚ä¸‹  (ä¸‹é¢çš„&  å¾—å»æ‰  æ˜¯å€¼æ•è·)

![image-20250714174854836](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714174854836.png)

ç¼–è¯‘å™¨ç¼–è¯‘çš„æ—¶å€™ä¼šå±•å¼€å¦‚ä¸‹ï¼š

![image-20250714174821233](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714174821233.png)

![image-20250714174940525](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714174940525.png)

 



âœ…å€¼è¡¥æˆ–  ä¸å¯ä»¥ä¿®æ”¹å¤–éƒ¨å˜é‡  è¦ä¿®æ”¹çš„è¯éœ€è¦åŠ mutable     int i=0;    [i] (int count ) mutable->void{ i++;  //å‡½æ•°è°ƒç”¨ä¹‹åå¹¶ä¸ä¼šä¿®æ”¹å¤–éƒ¨çš„içš„å€¼   åªæ˜¯å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå€¼  é—­åŒ…}

```c++
int i=0;
auto h7=[i](int  count){
i++;
    cout<<i<<count;    //é—­åŒ…
}
h7(8); //å†…éƒ¨i=1  å¤–éƒ¨i=0;
h7(8)//å†…éƒ¨i=2   å¤–éƒ¨i=0;
```





âœ…  å¼•ç”¨æ•è·    //æƒ³è¦ä¿®æ”¹å¤–éƒ¨å˜é‡   å¯è¯»å¯å†™

[&i] () {}

{ //å¤–éƒ¨çš„å€¼ä¹Ÿä¼šä¿®æ”¹}

![image-20250714175150634](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714175150634.png)



##### 5. ä¿å­˜bindè¿”å›çš„å‡½æ•°å¯¹è±¡

![image-20250714181600582](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714181600582.png)

bindå‡½æ•°é€‚é…å™¨ï¼šç”¨æ¥é€šè¿‡**ç»‘å®šå‡½æ•°ä»¥åŠå‡½æ•°å‚æ•°**çš„æ–¹å¼ç”Ÿæˆå‡½æ•°å¯¹è±¡ï¼›ç”Ÿæˆ				é—­åŒ…çš„

â€‹			     æä¾›å ä½ç¬¦ï¼›å®ç°çµæ´»çš„å‚æ•°ç»‘å®šï¼›



```c++
//ç»‘å®šæ™®é€šå‡½æ•°
auto f9=bind(&hello,9)// å°†å‚æ•°å’Œå‡½æ•°ç»‘å®šå¥½
f9();

//ç»‘å®šæˆå‘˜å‡½æ•°  æœ‰å®ä¾‹
auto f10=bind(&Chello::hello,&c,9)ï¼›
f10();

//å ä½ç¬¦
auto f10=bind(&Chello::hello,&c,placeholders::_1)ï¼›
f10(1000);
```

ç¼–è¯‘æ—¶å±•å¼€

ç»‘å®šæ™®é€šå‡½æ•°

![image-20250714180648925](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714180648925.png)

ç»‘å®šç±»æˆå‘˜å‡½æ•°



![image-20250714181341806](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714181341806.png)



##### æ€»ç»“



### 3. è‡ªåŠ¨ç±»å‹æ¨å¯¼auto ã€decltype

![image-20250714202754495](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714202754495.png)



#### 1. autoï¼ˆå°±æ˜¯ä¸ªèµ‹å€¼çš„è¿ç®—ï¼‰

![image-20250714201017193](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714201017193.png)

 æ¨åˆ°å˜é‡ç±»å‹

åŸç†ï¼šc++å¼ºç±»å‹è¯­è¨€  ï¼Œç¼–è¯‘å™¨æ ¹æ®å¼ºåˆ¶ç»™å˜é‡åˆå§‹åŒ–å€¼è¿›è¡Œç±»å‹æ¨å¯¼

è§„åˆ™ï¼š

 	1. auto a=10 å¿…é¡»åˆå§‹åŒ–
 	2. æ²¡æœ‰cvè¯­ä¹‰  const  volital ;   const int &a=10;  auto b=a
 	3. ä¿ç•™å¼•ç”¨æˆ–è€…cvè¯­ä¹‰å¯ä»¥ç”¨auto &
 	4.    ä¸å¯ä»¥æ¨åˆ°æ•°ç»„ç±»å‹  å›æ¨å¯¼å‡ºæŒ‡é’ˆ  int a[]={}; auto b=a;
 	5. å®šä¹‰å¤šä¸ªå˜é‡å¿…é¡»ä¸ºåŒä¸€ç±»å‹
 	6. ä¸‡èƒ½å¼•ç”¨  auto && æ ¹æ®åˆå§‹å€¼çš„å±æ€§åˆ¤æ–­æ˜¯å·¦å€¼å¼•ç”¨è¿˜æ˜¯å³å€¼å¼•ç”¨

åº”ç”¨ï¼š

åŒ¿åå‡½æ•°è¿”å›å€¼

æ¨¡æ¿å‡½æ•°

å®¹å™¨æ—¶

![image-20250714202224048](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714202224048.png)



#### 2. decltype

ç”¨äºæ¨åˆ°è¡¨è¾¾å¼ç±»å‹ï¼Œç¼–è¯‘å™¨ä¹‹åˆ†æè¡¨è¾¾å¼ç±»å‹è€Œä¸å‚ä¸è¿ç®—

exp:

â€‹	æ˜¯è¡¨è¾¾å¼ æ¨åˆ°è¡¨è¾¾å¼ç±»å‹

â€‹	å‡½æ•°è¿”å›å€¼ç±»å‹

â€‹	å·¦å€¼-ã€‹å·¦å€¼å¼•ç”¨

![image-20250714202244653](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714202244653.png)

![image-20250714202340206](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714202340206.png)

![image-20250714202438135](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714202438135.png)

è¿”å›å·¦å€¼çš„å¼•ç”¨ï¼š

![image-20250714202609299](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714202609299.png)

![image-20250714202653587](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714202653587.png)





### 4. finalã€overwrteï¼ˆvirtualï¼‰ å…³é”®å­—

ä¸ºä»€ä¹ˆå¼•å…¥ï¼š

â€‹	ï¼ˆ1ï¼‰ è™šå‡½æ•°å¤å†™æ—¶äº§ç”Ÿçš„é—®é¢˜ï¼š

â€‹		1. ä¸èƒ½é˜»æ­¢æŸä¸€ä¸ªè™šå‡½æ•°è¿›ä¸€æ­¥è¢«é‡å†™ï¼Œ

â€‹		2. æœ¬æ„æƒ³å†™ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œé”™è¯¯é‡å†™åŸºç±»è™šå‡½æ•°ï¼ˆå­ç±»virtualå…³é”®å­—å¯ä»¥çœç•¥ï¼‰

â€‹		3. ç”±äºç­¾åä¸ä¸€è‡´ï¼Œé€ æˆäº†åœ¨å­ç±»é‡æ–°æ„å»ºäº†è™šå‡½æ•°ï¼ˆå‚æ•°ä¸ªæ•°  ç±»å‹...  ï¼‰æœ¬æ„æ˜¯é‡å†™

â€‹	ï¼ˆ2ï¼‰ ç±»ç»§æ‰¿æ—¶äº§ç”Ÿçš„é—®é¢˜ï¼š

1. ä¸èƒ½é˜»æ­¢æŸä¸ªç±»è¿›ä¸€æ­¥æ´¾ç”Ÿ

   





#### 1. final

æŒ‡å®šæŸä¸ªè™šå‡½æ•°ä¸èƒ½å†æ´¾ç”Ÿç±»ä¸­è¢«è¦†ç›–ã€æŸç»™ç±»ä¸èƒ½æ´¾ç”Ÿ

![image-20250714204512547](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714204512547.png)



![image-20250714204601597](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714204601597.png)



![image-20250714204704289](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714204704289.png)









#### 2.overwrite

æŒ‡å®šå­ç±»çš„ä¸€ä¸ªè™šå‡½æ•°å¤å†™åŸºç±»çš„è™šå‡½æ•°

ä¿è¯é‡å†™å‡½æ•°å’ŒåŸºç±»å‡½æ•°å…·æœ‰ç›¸åŒçš„ç­¾å

![image-20250714205027954](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714205027954.png)



![image-20250714204258789](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714204258789.png)





#### æ€»ç»“

![image-20250714204803328](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714204803328.png)



### 5.å·¦å€¼å¼•ç”¨  å³å€¼å¼•ç”¨

å·¦å€¼å¼•ç”¨ä¸å³å€¼å¼•ç”¨çš„åŒºåˆ«ï¼Ÿ  å³å€¼å¼•ç”¨çš„æ„ä¹‰

#### 1. å·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨å®šä¹‰

å·¦å€¼ï¼šå…·æœ‰åï¼Œå¯å¯»å€ï¼Œå¯ä»¥åœ¨ç­‰å·å·¦è¾¹

â€‹           ä¸¾ä¾‹ï¼šå˜é‡å

â€‹			è¿”å›å·¦å€¼å¼•ç”¨çš„å‡½æ•°è°ƒç”¨

â€‹			å‰ç½®è‡ªå¢ï¼Œå‰ç½®è‡ªå‡ 

â€‹			èµ‹å€¼è¿ç®—ï¼Œå¤åˆèµ‹å€¼è¿ç®—i+=10

â€‹			è§£å¼•ç”¨è¡¨è¾¾å¼ *a=

â€‹			![image-20250714213533461](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714213533461.png)



å³å€¼ï¼šåªèƒ½æ”¾åœ¨ç­‰å·å³è¾¹ï¼Œä¸å…·å  ä¸èƒ½å–åœ°å€

â€‹	çº¯å³å€¼ï¼š

â€‹		å­—é¢å€¼

â€‹		è¿”å›éå¼•ç”¨å¯¹è±¡

â€‹		åç½®è‡ªå¢ï¼Œè‡ªå‡

â€‹		ç®—æœ¯è¡¨è¾¾å¼

â€‹		é€»è¾‘è¡¨è¾¾å¼

â€‹	å°†äº¡å€¼ï¼š

â€‹		c++11æ–°å¼•å…¥çš„ä¸å³å€¼å¼•ç”¨ç›¸å…³çš„å€¼ç±»å‹

â€‹		ç”¨æ¥è§¦å‘ç§»åŠ¨æ„é€ æˆ–è€…ç§»åŠ¨èµ‹å€¼æ„é€ ï¼Œè¿›è¡Œèµ„æºè½¬ç§»ï¼Œä¹‹åå°†äº¡å€¼è°ƒç”¨ææ„

â€‹		é€šè¿‡std::move\

â€‹		![image-20250714214044660](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714214044660.png)

![image-20250714214323724](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714214323724.png)![image-20250714214354075](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714214354075.png)











#### 2. å·¦å€¼å¼•ç”¨ä¸å³å€¼å¼•ç”¨çš„åŒºåˆ«



![image-20250714214605096](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714214605096.png)

åŠŸèƒ½å·®å¼‚ï¼šå·¦å€¼å¼•ç”¨é¿å…å¯¹è±¡çš„æ‹·è´ï¼ˆä¼ å‚  å‡½æ•°è¿”å›å€¼ï¼‰

â€‹		  å³å€¼å¼•ç”¨ï¼ˆå®Œç¾è½¬å‘  ç§»åŠ¨è¯­ä¹‰ï¼‰



constå·¦å€¼çš„å¼•ç”¨èƒ½æŒ‡å‘å³å€¼ï¼Œå±€é™æ˜¯ä¸èƒ½ä¿®æ”¹ ï¼ˆå³å€¼ä¸èƒ½ä¿®æ”¹ï¼‰è¦è§£å†³è¿™ä¸ªé—®é¢˜ å¼•å…¥å³å€¼å¼•ç”¨

å³å€¼å¼•ç”¨é€šè¿‡std::moveï¼ˆï¼‰è½¬åŒ–ä¸ºå·¦å€¼

![image-20250714214916288](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714214916288.png)

![image-20250714214932422](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714214932422.png)

ç§»åŠ¨è¯­ä¹‰è§£å†³æ·±æ‹·è´é—®é¢˜  ï¼ˆ ç§»åŠ¨åæºèµ„æºä¸ºnullï¼‰

![image-20250714215206101](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714215206101.png)

![image-20250714215328376](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714215328376.png)



![image-20250714215723790](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714215723790.png)



ç§»åŠ¨è¯­ä¹‰  é¿å…å¤šæ¬¡æ‹·è´èµ„æº  

#### 3.å®ç°å®Œç¾è½¬å‘

![image-20250714215857833](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714215857833.png)

å‡½æ•°æ¨¡æ¿å¯ä»¥å°†è‡ªå·±çš„å‚æ•°å®Œç¾çš„è½¬å‘ç»™å†…éƒ¨è°ƒç”¨çš„å…¶ä»–å‡½æ•°

å®Œç¾æ˜¯æŒ‡ï¼š

![image-20250714220045661](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714220045661.png)



![image-20250714220604903](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714220604903.png)

![image-20250714220652324](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250714220652324.png)





### 6.è±å½¢ç»§æ‰¿

ä»€ä¹ˆæ˜¯è±å½¢ç»§æ‰¿   æ€ä¹ˆè§£å†³è±å½¢ç»§æ‰¿ 

C++ç‹¬æœ‰ï¼ˆå¤šé‡ç»§æ‰¿ç‰¹æ€§ï¼‰

â€‹	å®šä¹‰ï¼šä¸€ä¸ªå­ç±»å¯ä»¥ç»§æ‰¿å¤šä¸ªçˆ¶ç±»ï¼Œå¤šä¸ªçˆ¶ç±»å¯ä»¥ç»§æ‰¿ç›¸åŒçš„çˆ¶ç±»

â€‹	é—®é¢˜ï¼šAä¼šè¢«æ„é€ ä¸¤æ¬¡ï¼Œæµªè´¹å­˜å‚¨ç©ºé—´ é€ æˆäºŒä¹‰æ€§

![image-20250715093747848](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715093747848.png)

![image-20250715093907336](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715093907336.png)

æœ‰ä¸¤ä¸ªnumber,è¯´æ˜æ„é€ äº†ä¸¤ä¸ªA

æ€ä¹ˆè§£å†³è±å½¢ç»§æ‰¿ï¼š

è™šç»§æ‰¿ï¼šå­ç±»åªç»§æ‰¿ä¸€æ¬¡çˆ¶ç±»çš„çˆ¶ç±»  virtual å…³é”®å­—

![image-20250715094046601](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715094046601.png)

![image-20250715094123220](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715094123220.png)

è™šç»§æ‰¿åº•å±‚å®ç°åŸç†ï¼š  g++ -fdump-class-hierarchy   *.cpp   gcc8.0å‰

â€‹					g++ -fdump-lang-class   *.cpp    gcc8.0å

![image-20250715094434765](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715094434765.png)



åŸç†ï¼š  åˆ©ç”¨è™šè¡¨åç§»å®ç°è™šç»§æ‰¿	çˆ¶ç±»çš„vptréƒ½æœ‰åˆ°å…±åŒåŸºç±»çš„åç§»é‡ä»è€Œè®©å­ç±»å¤šç»§æ‰¿æ—¶æŒ‡å‘åŒä¸€ä¸ªçˆ¶ç±»çš„çˆ¶ç±»ã€‚ï¼ˆVTable  å¯ä»¥ä½¿B1 B2éƒ½æŒ‡å‘åŒä¸€ä¸ªAï¼‰

è™šç»§æ‰¿ä¼šä¸ºAä»ç„¶ç”Ÿæˆä¸€ä¸ªè™šå‡½æ•°è¡¨ï¼ŒB1å’ŒB2éƒ½ä¼šæŒ‡å‘åŒä¸€ä¸ªè™šå‡½æ•°è¡¨ï¼Œç±»Aå’ŒAçš„è™šè¡¨ä¸€ä¸€ç»‘å®šã€‚

![image-20250715095249783](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715095249783.png)



![image-20250715095310382](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715095310382.png)

![image-20250715095347738](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715095347738.png)



![image-20250715095804997](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715095804997.png)



### 7. é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹æ€§

å°è£…  ç»§æ‰¿  å¤šæ€

#### 1.å°è£…

éšè—å®ç°ç»†èŠ‚   å®ç°æ¨¡å—åŒ–åŠŸèƒ½ï¼ˆæä¾›ç»Ÿä¸€çš„æ¥å£  å¤–éƒ¨è®¿é—®å†…éƒ¨èµ„æºï¼‰

ç‰¹æ€§ï¼šè®¿é—®æƒé™

â€‹	public:å¯¹æ‰€æœ‰å¯¹è±¡å¼€æ”¾

â€‹	protected:åªå¯¹å­ç±»å¯¹è±¡å¼€æ”¾

â€‹	private:åªå¯¹è‡ªå·±å¼€æ”¾  é€šè¿‡å‹å…ƒç±»æ‰“ç ´é™å®š friend class B

![image-20250715100312960](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715100312960.png)

å±æ€§ï¼š



æ–¹æ³•ï¼š

#### 2.ç»§æ‰¿

å®šä¹‰ï¼šæ— éœ€è¦ä¿®æ”¹åŸæœ‰ç±»ï¼Œé€šè¿‡ç»§æ‰¿å®ç°åŠŸèƒ½æ‰©å±•

ç‰¹æ€§ï¼šåŸºç±»æˆå‘˜åœ¨å­ç±»ä¸­çš„æœ€é«˜æƒé™

â€‹	public:åŸ  public  \protectedä¸å˜

â€‹	protected:åŸæ¥publicå˜æˆprotected ,åŸæ¥çš„protectedä¸å˜

â€‹	private:åŸ  public  \protectedå˜æˆprivate.

![image-20250715100926716](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715100926716.png)



usingä¿®æ”¹æƒé™:åŸºç±»æˆå‘˜åœ¨å­ç±»ä¸­çš„æƒé™

public:

â€‹	using A::C;

![image-20250715101137337](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715101137337.png)



å¤šç»§æ‰¿

æ¥å£ç»§æ‰¿

#### 3. å¤šæ€

å®šä¹‰ï¼šä¸€ä¸ªæ¥å£å¤šç§å½¢æ€ï¼š

â€‹	é™æ€å¤šæ€ï¼šå‡½æ•°é‡è½½ å‡½æ•°åç›¸åŒï¼ˆå‚æ•°ä¸åŒï¼‰ ç¼–è¯‘æœŸç¡®å®š

â€‹	åŠ¨æ€å¤šæ€ ï¼š  è™šå‡½æ•°é‡å†™å®ç°ï¼Œ  åŸºç±»çš„æŒ‡é’ˆ=å­ç±»çš„å¯¹è±¡   Anm * a= cat;

### 8. ç®€è¿°å¤šæ€å®ç°åŸç†

#### 1. é™æ€å¤šæ€ï¼š

å‡½æ•°é‡è½½ï¼šç¼–è¯‘æœŸç¡®å®šçš„ï¼Œå…è®¸åœ¨åŒæ„ä½œç”¨åŸŸä¸­å£°æ˜å¤šä¸ªåŠŸèƒ½ç±»ä¼¼çš„åŒåå‡½æ•°ï¼Œè¿™äº›å‡½æ•°å‚æ•°åˆ—è¡¨ä¸åŒï¼ˆå‚æ•°ä¸ªæ•°ï¼Œç±»å‹ï¼Œé¡ºåºï¼‰

æ³¨æ„ï¼šæ²¡æœ‰è¿”å›å€¼ã€‚

åŸç†ï¼š

å‡½æ•°åä¿®é¥°ï¼š

ç¼–è¯‘è¿‡ç¨‹ï¼š 

1. é¢„ç¼–è¯‘ ï¼šæŠŠå¤´æ–‡ä»¶ä¸­çš„å‡½æ•°å£°æ˜æ‹·è´åˆ°æºæ–‡ä»¶ä¸­ï¼Œé¿å…ç¼–è¯‘è¿‡ç¨‹çš„è¯­æ³•åˆ†ææ‰¾ä¸åˆ°å‡½æ•°å®šä¹‰ã€‚

2. ç¼–è¯‘ï¼šè¯­æ³•åˆ†æï¼ŒåŒæ—¶ç¬¦å·æ±‡æ€»ç”Ÿæˆç¬¦å·è¡¨ï¼ˆå‡½æ•°åï¼‰

3. æ±‡ç¼–ï¼š ç”Ÿæˆå‡½æ•°å-ã€‹å‡½æ•°åœ°å€çš„æ˜ å°„æ–¹ä¾¿é€šè¿‡å‡½æ•°åæ‰¾åˆ°å‡½æ•°ä½ç½®ï¼Œä»è€Œæ‰§è¡Œã€‚

4. è¿æ¥ï¼šå°†å¤šä¸ªæ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨æ±‡æ€»åˆå¹¶ï¼Œ	

![image-20250715102523619](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715102523619.png)



æ„æ€å°±æ˜¯è¯´åœ¨ç¼–è¯‘é˜¶æ®µä¸ºä¸åŒçš„å‡½æ•°é‡è½½ç”Ÿæˆä¸åŒçš„ç¬¦å·åŒºåˆ†ã€‚åœ¨æ±‡ç¼–é˜¶æ®µæ˜ å°„å‡½æ•°åå’Œå…·ä½“çš„å‡½æ•°åœ°å€ã€‚



1A  3sum   E  dd

ç±»å­—æ•°   å‡½æ•°åå­—æ•°   å‚æ•°åˆ—è¡¨é¦–å­—æ¯

 

objdump -t *.o   æŸ¥çœ‹ç¬¦å·è¡¨            â€”â€”ZN+ç±»é•¿åº¦â€”+ç±»å+å‡½æ•°é•¿åº¦å‡½æ•°å+E+å‚æ•°åˆ—è¡¨ç±»å‹çš„é¦–å­—æ¯

![image-20250715103314776](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715103314776.png)



#### 2. åŠ¨æ€å¤šæ€ï¼š è™šå‡½æ•°é‡å†™

è¿è¡Œæ—¶ç¡®å®š

åœ¨åŸºç±»å‡½æ•°å‰åŠ ä¸Švirtualå…³é”®å­—ï¼Œåœ¨æ´¾ç”Ÿç±»é‡å†™è¯¥å‡½æ•°

è¿è¡Œæ—¶å°†ä¼šæ ¹æ®å¯¹è±¡çš„ç±»å‹æ¥è°ƒç”¨ç›¸åº”çš„å‡½æ•°

å¦‚æœç±»å‹æ˜¯åŸºç±»ï¼Œè°ƒç”¨åŸºç±»çš„å‡½æ•°

å¦‚æœå¯¹è±¡ç±»å‹æ˜¯æ´¾ç”Ÿç±»è°ƒç”¨æ´¾ç”Ÿç±»å‡½æ•°



åŸç†ï¼š

â€‹	æ—©ç»‘å®šï¼šç¼–è¯‘å™¨å°±ç¡®å®šäº†å¯¹è±¡è°ƒç”¨çš„å‡½æ•°çš„åœ°å€

â€‹	æ™šç»‘å®šï¼š 

â€‹	çœ‹ç±»ä½¿ç”¨äº†virtualå‡½æ•°ä¼šä¸ºç±»ç”Ÿæˆè™šå‡½æ•°è¡¨-ã€‹ä¸€ç»´æ•°ç»„å­˜æ”¾ç€è™šå‡½æ•°çš„åœ°å€ï¼Œç±»å¯¹è±¡æ„é€ æ—¶ä¼šåˆå§‹åŒ–æŒ‡å‘è™šè¡¨çš„æŒ‡é’ˆï¼Œvptr,

â€‹	è™šå‡½æ•°è¡¨æŒ‡é’ˆvptråœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–

è™šå‡½æ•°è¡¨æŒ‡é’ˆï¼švptr

åœ¨ç±»å¯¹è±¡çš„å‰8ä¸ªå­—èŠ‚ æ˜¯è™šå‡½æ•°è¡¨æŒ‡é’ˆ

![image-20250715104340177](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715104340177.png)

![image-20250715104734596](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715104734596.png)

âœ… æ˜¯çš„ â€”â€” **ç¡®å®æœ‰ä¸¤ä¸ªè™šå‡½æ•°è¡¨ï¼ˆvtableï¼‰**

å½“å­ç±» **é‡å†™ï¼ˆoverrideï¼‰** åŸºç±»çš„è™šå‡½æ•°æ—¶ï¼Œç¼–è¯‘å™¨ä¼šä¸ºå­ç±»ç”Ÿæˆä¸€ä¸ª**æ–°çš„è™šå‡½æ•°è¡¨**ã€‚è¿™ä¸¤ä¸ªè¡¨åˆ†åˆ«å±äºï¼š

- `Base` çš„è™šå‡½æ•°è¡¨ï¼šæŒ‡å‘ `Base::func`
- `Drive` çš„è™šå‡½æ•°è¡¨ï¼šæŒ‡å‘ `Drive::func`

ğŸ§  ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªè™šå‡½æ•°è¡¨ï¼Ÿ

å› ä¸º**åŠ¨æ€ç»‘å®š**çš„æœºåˆ¶æ˜¯é€šè¿‡å¯¹è±¡ä¸­çš„ **vptrï¼ˆè™šå‡½æ•°è¡¨æŒ‡é’ˆï¼‰** æ¥å®ç°çš„ã€‚

çœ‹ä¸‹é¢çš„åœºæ™¯ï¼š

```
cppCopyEditBase* p1 = new Base();
Base* p2 = new Drive();  // å‘ä¸Šè½¬å‹
```

æ­¤æ—¶ï¼š

- `p1` æŒ‡å‘çš„å¯¹è±¡çš„ `vptr` æŒ‡å‘çš„æ˜¯ `Base` çš„ vtable â‡’ ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯ `Base::func`
- `p2` æŒ‡å‘çš„å¯¹è±¡çš„ `vptr` æŒ‡å‘çš„æ˜¯ `Drive` çš„ vtable â‡’ ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯ `Drive::func`

å› æ­¤è°ƒç”¨ï¼š

```
cppCopyEditp1->func(); // è°ƒç”¨ Base::func
p2->func(); // è°ƒç”¨ Drive::func
```

å³ä½¿ `p2` æ˜¯ `Base*` ç±»å‹ï¼Œä»ç„¶ä¼šé€šè¿‡å®ƒçš„ `vptr` æ‰¾åˆ° `Drive::func`ï¼Œè¿™å°±æ˜¯**å¤šæ€æ€§**çš„åŸºç¡€ã€‚

ğŸ”¬ å†…å­˜ç¤ºæ„å›¾ï¼ˆç®€åŒ–ï¼‰

```
cppCopyEditclass Base {
    virtual void func();
};

class Drive : public Base {
    void func() override;
};
```

åˆ›å»ºå¯¹è±¡åï¼š

```
cppCopyEditBaseå¯¹è±¡å†…å­˜å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ vptr â”€â”€â”¼â”€â”€â–º [ &Base::func ]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Driveå¯¹è±¡å†…å­˜å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ vptr â”€â”€â”¼â”€â”€â–º [ &Drive::func ]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ğŸ§© vtable å®é™…é•¿ä»€ä¹ˆæ ·ï¼Ÿ

é€šå¸¸å®ƒæ˜¯ä¸ªå‡½æ•°æŒ‡é’ˆæ•°ç»„ï¼ˆä¼ªä»£ç ï¼‰ï¼š

```
cppCopyEdit// Base çš„ vtable
Base_vtable = {
    &Base::func
};

// Drive çš„ vtable
Drive_vtable = {
    &Drive::func
};
```

âœ… æ€»ç»“

| é—®é¢˜                                 | å›ç­”                                                    |
| ------------------------------------ | ------------------------------------------------------- |
| å­ç±»é‡å†™è™šå‡½æ•°ä¼šç”Ÿæˆæ–°çš„è™šå‡½æ•°è¡¨å—ï¼Ÿ | âœ… ä¼šã€‚æ¯ä¸ªç±»æœ‰è‡ªå·±çš„ vtableã€‚                           |
| å¦‚ä½•åˆ¤æ–­è°ƒç”¨åŸºç±»è¿˜æ˜¯å­ç±»å‡½æ•°ï¼Ÿ       | é€šè¿‡å¯¹è±¡å†…çš„ vptr æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘å½“å‰ç±»å¯¹åº”çš„ vtableã€‚     |
| ä¸ºå•¥ä¸¤ä¸ªå¯¹è±¡è®¿é—®çš„æ˜¯ `[0]`ï¼Ÿ         | å› ä¸º `[0]` æ˜¯ç¬¬ä¸€ä¸ªè™šå‡½æ•°çš„ä½ç½®ï¼Œä½† vtable æœ¬èº«ä¸ä¸€æ ·ã€‚ |

### 9.ç»§æ‰¿ä¸‹çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°é¡ºåº

ç»§æ‰¿ä¸‹ï¼šæ„é€ å‡½æ•°ä¾ç…§ä»¥æ¥è¿ï¼Œä»ä¸Šå¾€ä¸‹æ„é€ 

ææ„ï¼šæŒ‰ç…§ä¾èµ–é“¾ä»ä¸‹å¾€ä¸Šææ„

å•ç»§æ‰¿ï¼š

1. å…ˆæ„é€ çˆ¶ç±»Base-ã€‹å­ç±»Driver   ææ„å­ç±»-ã€‹çˆ¶ç±»

2. çˆ¶ç±»Baseæœ‰æˆå‘˜BASE1ï¼š

â€‹	å…ˆæ„é€ BASE1->BASE->DRIVER

â€‹	ææ„ï¼šdriver->base->base1

3. çˆ¶ç±»Baseæœ‰æˆå‘˜BASE1,driveræœ‰æˆå‘˜DRIVER1(å…ˆæœ‰çˆ¸çˆ¸-ã€‹ å…ˆæœ‰å™¨å®˜  å±æ€§ -ã€‹ å†æœ‰è‡ªå·±)

   â€‹	å…ˆæ„é€ BASE1->BASE->DRIVER1->DRIVER

   â€‹	ææ„ï¼šDRIVER1->driver->base->base1



å¤šç»§æ‰¿ï¼š

å…ˆçˆ¶äº²åœ¨å™¨å®˜åœ¨è‡ªå·±ï¼ˆé¡ºåºæ‰§è¡Œï¼‰

![image-20250715111306618](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715111306618.png)





### 10. è™šå‡½æ•°è¡¨å’Œè™šå‡½æ•°è¡¨æŒ‡é’ˆ

è™šå‡½æ•°è¡¨å’Œè™šå‡½æ•°è¡¨æŒ‡é’ˆçš„åˆ›å»ºæ—¶æœºï¼š

è™šå‡½æ•°è¡¨ï¼š

â€‹	å†…å®¹åœ¨ç¼–è¯‘æœŸç”Ÿæˆ    

â€‹        å…¨å±€æ•°æ®åŒºçš„åªè¯»æ•°æ®æ®µ.rodata 

â€‹	è™šå‡½æ•°è¡¨å­˜æ”¾è™šå‡½æ•°çš„åœ°å€çš„æ•°ç»„

â€‹	ç¼–è¯‘æœŸå‘ç°virtualå…³é”®å­—

è™šå‡½æ•°è¡¨æŒ‡é’ˆï¼š

â€‹	å½“ä¸ºç±»æ„å»ºå¯¹è±¡çš„æ—¶å€™ï¼ˆæ„é€ å‡½æ•°/é»˜è®¤æ„é€ å‡½æ•°ï¼‰ï¼Œç¼–è¯‘å™¨ä¼šæŠŠvptrç»™ç±»çš„å¯¹è±¡ï¼Œå­˜æ”¾åœ¨å‰å…«å­—èŠ‚ä¸­ã€‚

â€‹	å¦‚æœç±»æ²¡æœ‰æ„é€ å‡½æ•° ç¼–è¯‘å™¨è‡ªåŠ¨ä¸ºç±»ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ï¼Œç›®çš„æ˜¯ä¸ºç±»å¯¹è±¡åˆå§‹åŒ–vptr

â€‹	ç»§æ‰¿ä¸‹è™šå‡½æ•°è¡¨æŒ‡é’ˆçš„èµ‹å€¼è¿‡ç¨‹ï¼švptrå…ˆ=åŸºç±»è™šå‡½æ•°è¡¨åœ°å€ï¼ˆåŸºç±»æ„é€ å‡½æ•°ï¼‰ï¼Œç„¶åvptr=å­ç±»çš„è™šå‡½æ•°è¡¨åœ°å€ï¼ˆå­ç±»æ„é€ å‡½æ•°ï¼‰

![image-20250715114306844](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715114306844.png)



èƒŒæ™¯ï¼š ç”¨äºå®ç°å¤šæ€  ï¼ˆé™æ€å¤šæ€ å½¢å‚è¿”å›å€¼ä¸ä¸€æ ·  å‡½æ•°åä¸€æ ·  åœ¨ç¼–è¯‘çš„æ—¶å€™ç¡®å®šï¼‰

 ï¼ˆåŠ¨æ€å¤šæ€ è™šå‡½æ•° ç»§æ‰¿çš„æ—¶å€™å¯ä»¥é‡å†™åŸºç±»çš„è™šå‡½æ•° è¿è¡Œæ—¶æ‰ç¡®å®šï¼‰

è™šå‡½æ•°è¡¨åˆ›å»ºæ—¶æœºï¼š

1.ä»€ä¹ˆæ—¶å€™ç”Ÿæˆçš„ï¼Ÿï¼ˆç¼–è¯‘çš„æ—¶å€™ç”Ÿæˆçš„  virtualå…³é”®å­—ä¿®é¥°çš„å‡½æ•°ï¼‰

2.å­˜åœ¨å“ªé‡Œï¼Ÿ  ç¼–è¯‘ä¸ºå¯æ‰§è¡Œç¨‹åºï¼ˆå­˜åœ¨ç£ç›˜é‡Œé¢ï¼‰ è¿è¡Œæ—¶ï¼ˆå†…å­˜ï¼‰![img](file:///C:\Users\jkx-pig\AppData\Local\Temp\ksohtml30668\wps1.jpg)![img](file:///C:\Users\jkx-pig\AppData\Local\Temp\ksohtml30668\wps2.jpg)![img](file:///C:\Users\jkx-pig\AppData\Local\Temp\ksohtml30668\wps3.jpg)![img](file:///C:\Users\jkx-pig\AppData\Local\Temp\ksohtml30668\wps4.jpg)![img](file:///C:\Users\jkx-pig\AppData\Local\Temp\ksohtml30668\wps5.jpg)![img](file:///C:\Users\jkx-pig\AppData\Local\Temp\ksohtml30668\wps6.jpg)![img](file:///C:\Users\jkx-pig\AppData\Local\Temp\ksohtml30668\wps7.jpg)



è™šå‡½æ•°è¡¨æŒ‡é’ˆçš„åˆ›å»ºæ—¶æœºï¼šç±»å¯¹è±¡æ„é€ çš„æ—¶å€™ vptr ï¼ŒæŠŠç±»çš„è™šå‡½æ•°è¡¨åœ°å€èµ‹å€¼ç»™vptr(ç±»çš„å¯¹è±¡çš„å‰å…«ä¸ªå­—èŠ‚æŒ‡å‘è™šå‡½æ•°è¡¨çš„åœ°å€)

![img](file:///C:\Users\jkx-pig\AppData\Local\Temp\ksohtml30668\wps8.jpg) 

ç»§æ‰¿

Bç»§æ‰¿açš„æ—¶å€™ï¼ŒBè‡ªå·±æ²¡æœ‰è™šå‡½æ•°æ­¤æ—¶ä¼šåœ¨ç£ç›˜çš„åªè¯»ä»£ç æ®µå¤åˆ¶ä¸€ä¸ªAçš„è™šå‡½æ•°è¡¨ã€‚å¦‚æœBè‡ªå·±å†™äº†ä¸€ä¸ªè™šå‡½æ•°funcå’ŒAä¸€æ ·ï¼Œæ˜¯æ¥ç€å¤åˆ¶Açš„è™šå‡½æ•°è¡¨å¹¶æŠŠå¯¹åº”çš„è™šå‡½æ•°é¡¹çš„åœ°å€æŒ‡å‘è‡ªå·±çš„å®ç°å—ã€‚è¿˜æ˜¯é‡æ–°åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„è™šå‡½æ•°è¡¨ã€‚ã€

![img](file:///C:\Users\jkx-pig\AppData\Local\Temp\ksohtml30668\wps9.jpg)

ï¼ˆ3ï¼‰ç»§æ‰¿æƒ…å†µä¸‹  è™šå‡½æ•°è¡¨æŒ‡é’ˆçš„èµ‹å€¼è¿‡ç¨‹ï¼Ÿ

![img](file:///C:\Users\jkx-pig\AppData\Local\Temp\ksohtml30668\wps10.jpg) 





### 11. è™šææ„å‡½æ•°çš„ä½œç”¨

âœ… ç»“è®ºï¼ˆé€šä¿—ä¸€ç‚¹è®²ï¼‰ï¼š

> **åªè¦ä½ å¸Œæœ›å­ç±»èƒ½â€œæ”¹å†™â€ï¼ˆoverrideï¼‰åŸºç±»çš„æŸä¸ªå‡½æ•°ï¼Œå¹¶åœ¨è¿è¡Œæ—¶â€œæ­£ç¡®åœ°è°ƒç”¨å®ƒâ€â€”â€”å°±è¦åœ¨åŸºç±»ä¸­ç»™è¿™ä¸ªå‡½æ•°åŠ ä¸Š `virtual`ã€‚**



è§£å†³ä»€ä¹ˆé—®é¢˜ï¼šåŸºç±»å¯¹è±¡æŒ‡é’ˆ=å­ç±»å¯¹è±¡æŒ‡é’ˆï¼ˆåœ¨è°ƒç”¨ææ„æ—¶ å­ç±»å¯¹è±¡çš„ææ„å‡½æ•°å¾—ä¸åˆ°è°ƒç”¨ï¼‰

ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ï¼šè®¾è®¡æŸä¸ªç±»çš„æ—¶å€™ä¸ä¸€å®šæ˜¯åŸºç±»ï¼Œå¦‚æœè¯¥ç±»æ˜¯åŸºç±»ï¼Œæˆ‘ä»¬åº”è¯¥æ‰‹åŠ¨å°†åŸºç±»çš„ææ„å‡½æ•°è®¾è®¡ä¸ºè™šææ„ã€‚

è®¾ç½®è™šææ„å‡½æ•°æ˜¯æœ‰ä»£ä»·çš„ï¼Œç¼–è¯‘å™¨ä¼šä¸ºç±»ç”Ÿæˆè™šå‡½æ•°è¡¨ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰è™šå‡½æ•°è¡¨æŒ‡é’ˆï¼Œå¢å¤§äº†èµ„æºæ¶ˆè€—

![image-20250715115204088](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715115204088.png)![image-20250715115504216](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715115504216.png)

ä½œç”¨ï¼šç»§æ‰¿ä¸‹ ä¸ºäº†ä½¿å­ç±»çš„ææ„å‡½æ•°èƒ½æ­£å¸¸è°ƒç”¨ï¼Œéœ€è¦åŸºç±»çš„ææ„è®¾ç½®ä¸ºè™šææ„ã€‚

â€‹	![image-20250715120043340](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715120043340.png)

å½“ç„¶å¯ä»¥ï¼Œå’±ä»¬æ¥**é€šä¿—+å½¢è±¡åœ°è§£é‡Šä¸€ä¸‹**è¿™å¥ä»£ç åœ¨å¹²å˜›ï¼š









ğŸŒ° å…ˆæ¥ä¸ªæ¯”å–»ï¼š

æŠŠ `Base*` çœ‹æˆæ˜¯ä¸€ä¸ª**â€œåŠ¨ç‰©â€ç±»å‹çš„æŒ‡é’ˆ**ï¼Œä½ æœ‰å¾ˆå¤šåŠ¨ç‰©ï¼šç‹—ã€çŒ«ã€é¸Ÿâ€¦â€¦

ä½ å†™äº†ä¸ªåŸºç±» `Animal`ï¼Œç„¶åè®© `Dog` å’Œ `Cat` éƒ½ç»§æ‰¿å®ƒï¼š

```c++
cppCopyEditclass Animal {
public:
    virtual void speak() { std::cout << "Animalå«" << std::endl; }
    virtual ~Animal() {}
};

class Dog : public Animal {
public:
    void speak() override { std::cout << "ç‹—æ±ªæ±ª" << std::endl; }
};

class Cat : public Animal {
public:
    void speak() override { std::cout << "çŒ«å–µå–µ" << std::endl; }
};
```

ğŸ§  æ­£å¸¸ä½ ä¼šè¿™æ ·å†™ï¼š

```
cppCopyEditDog* d = new Dog();
Cat* c = new Cat();
d->speak();  // ç‹—æ±ªæ±ª
c->speak();  // çŒ«å–µå–µ
```

è¿™å½“ç„¶æ²¡é—®é¢˜ï¼Œä½†æƒ³è±¡ä½ æœ‰å¾ˆå¤šåŠ¨ç‰©ï¼Œæ¯”å¦‚ 100 ç§ï¼Œè¦ä¸€ä¸ªä¸€ä¸ªå†™å¤ªéº»çƒ¦äº†ï¼

ğŸ¯ ç°åœ¨çš„ä»£ç æ˜¯è¿™ä¹ˆåšçš„ï¼š

```
cppCopyEditstd::vector<Animal*> zoo;        // åˆ›å»ºä¸€ä¸ªâ€œåŠ¨ç‰©å›­â€
zoo.push_back(new Dog());        // åŠ ä¸€åªç‹—è¿›å»ï¼ˆè‡ªåŠ¨è½¬æˆ Animal*ï¼‰
zoo.push_back(new Cat());        // åŠ ä¸€åªçŒ«è¿›å»ï¼ˆè‡ªåŠ¨è½¬æˆ Animal*ï¼‰

for (Animal* a : zoo)
    a->speak();   // è°ƒç”¨å¤šæ€ï¼šè‡ªåŠ¨æ ¹æ®å®é™…ç±»å‹è¯´è¯
```

ğŸŸ¢ è¾“å‡ºæ˜¯ï¼š

```
CopyEditç‹—æ±ªæ±ª
çŒ«å–µå–µ
```

ğŸ§  å›åˆ°ä½ åŸæ¥çš„ä»£ç 

```
cppCopyEditstd::vector<Base*> objs;
objs.push_back(new Drive());
objs.push_back(new AnotherDrive());
```

ç¿»è¯‘æˆäººè¯å°±æ˜¯ï¼š

> åˆ›å»ºä¸€ä¸ªâ€œåŸºç±»æŒ‡é’ˆçš„å®¹å™¨â€ï¼ˆåƒåŠ¨ç‰©å›­ï¼‰ï¼Œç„¶åå¾€é‡Œé¢ä¸¢è¿›äº†ä¸¤ä¸ªå­ç±»å¯¹è±¡ï¼ˆDrive å’Œ AnotherDriveï¼‰ã€‚è™½ç„¶ä½ ç”¨çš„æ˜¯ `Base*` ç±»å‹ï¼Œä½†ç¨‹åº**èƒ½è‡ªåŠ¨è¯†åˆ«æ¯ä¸ªå¯¹è±¡çš„å®é™…ç±»å‹**ï¼Œè¿™å°±æ˜¯**å¤šæ€çš„é­”åŠ›**ã€‚

ğŸ§¹ æœ€ååˆ«å¿˜äº†æ¸…ç†ï¼

```
cppCopyEditfor (Base* p : objs)
    delete p;  // å¦‚æœBaseçš„ææ„å‡½æ•°ä¸æ˜¯virtualï¼Œå°±ä¸ä¼šæ¸…é™¤æ‰å­ç±»çš„å†…å®¹
```

æ‰€ä»¥ï¼š

âœ… **æ€»ç»“ä¸€å¥è¯é€šä¿—ç‰ˆï¼š**

> ä½ ç”¨ `Base*` æŠŠå­ç±»å¯¹è±¡ç»Ÿä¸€è£…èµ·æ¥ï¼Œå°±åƒç”¨â€œåŠ¨ç‰©æŒ‡é’ˆâ€ç»Ÿä¸€è£…çŒ«ç‹—ç‹®å­ï¼Œç„¶åé è™šå‡½æ•°å’Œå¤šæ€è®©å®ƒä»¬å„è‡ªæ­£ç¡®åœ°â€œå‘å‡ºè‡ªå·±çš„å£°éŸ³â€ï¼Œæ–¹ä¾¿ç®¡ç†ä¹Ÿçµæ´»æ‰©å±•ã€‚





### 12. åŠ¨æ€åº“å’Œé™æ€åº“çš„åŒºåˆ«

1. ç”Ÿæˆæ–¹å¼ï¼š

2. è¿æ¥æ–¹å¼ï¼š

   1. é™æ€é“¾æ¥  ï¼šæŠŠé™æ€åº“ç¼–è¯‘è¿›ç›®æ ‡æ–‡ä»¶

   2. åŠ¨æ€é“¾æ¥ ï¼šæ²¡æœ‰æŠŠåŠ¨æ€åº“ç¼–è¯‘è¿›æ–‡ä»¶

      â€‹		 ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åŠ è½½ 

      â€‹		åªåšè¯­æ³•æ£€æŸ¥

3. ç©ºé—´å ç”¨ï¼š

   1. é™æ€åº“å ç”¨ç©ºé—´å¤§ï¼Œå­˜åœ¨å¤šä¸ªå‰¯æœ¬
   2. åŠ¨æ€åº“å ç”¨ç©ºé—´å°ï¼Œåªå­˜åœ¨ä¸€ä¸ªå‰¯æœ¬å…±äº«

4. ä½¿ç”¨æ–¹å¼ï¼š

   1. é™æ€åº“æ‰€åœ¨ç¨‹åºæ˜¯ç›´æ¥è¿è¡Œ
   2. åŠ¨æ€åº“æ‰€åœ¨ç¨‹åºæ˜¯åŠ¨æ€åŠ è½½çš„ï¼Œ   ç¨‹åºç¯å¢ƒéœ€è¦åˆ¶å®šåŠ¨æ€åº“æŸ¥æ‰¾è·¯å¾„   LD_LIBBRARY_PATH

5. æ‰§è¡Œé€Ÿåº¦ï¼š

   1. é™æ€åº“æ‰§è¡Œé€Ÿåº¦å¿«
   2. åŠ¨æ€åº“æ‰§è¡Œé€Ÿåº¦æ…¢

6. åº“æ–‡ä»¶å‘ç”Ÿå˜æ›´

   1. æ¥å£æ”¹å˜ï¼ˆå‚æ•°ä¸ªæ•°  ç±»å‹ç­‰ç­‰ï¼‰ éƒ½éœ€è¦é‡æ–°ç¼–è¯‘
   2. æ¥å£å®ç°æ”¹å˜ ï¼š é™æ€åº“å’Œ.cæ–‡ä»¶éƒ½éœ€é‡æ–°ç¼–è¯‘        åªéœ€é‡æ–°ç¼–è¯‘åŠ¨æ€åº“

![image-20250715144322206](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715144322206.png)



#### Cmakeä¸­çš„åŠ¨æ€åº“å’Œé™æ€åº“











### 13.  Cmake  è¯­æ³•  



åœ¨build  ç›®å½•  cmake   ç„¶åmake 

  #### 01.  set()   file()/aux_source_directory  add_excutable()

åŸºç¡€

æ„å»ºä¸€ä¸ª buildç›®å½•  è¿›å…¥åˆ°buileç›®å½•ï¼Œæ‰§è¡Œcmake .. *(è¿™ä¸ª..è·¯å¾„æ˜¯CMakeLists.txtæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•)*

![image-20250715145635290](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715145635290.png)

```cmake
CMakeLists.txt
#é¡¹ç›®å
project(test)
#æŒ‡å®šCmakeçš„æœ€ä½ç‰ˆæœ¬
cmake_minimum_required(VERSION 3.0)

set(CMAKE_CXX_STANDARD 11)

#è®¾ç½®å˜é‡
set(SOR a.cpp  b.cpp  c.cpp)
#æ–‡ä»¶å¤ªå¤š ä¸èƒ½ä¸€ä¸ªä¸€ä¸ªéƒ½å†™å‡ºæ¥  é€šè¿‡ä¸¤ç§æ–‡ä»¶æœç´¢çš„æ–¹å¼
aux_source_directory(${PROJECT_SOURCE_DIR} SOR) #PROJECT_SOURCE_DIRæ˜¯cmake .. çš„åœ°å€ï¼Œæœç´¢æ‰€æœ‰çš„.cpp .c .h ä¸èƒ½é€’å½’

file(GLOB SRC ${CMAKE_CURRENT_SOURCE_DIR}/*.cpp) # åœ¨ç›®å½•ä¸‹é€’å½’æœç´¢ï¼Œ  CMAKE_CURRENT_SOURCE_DIRï¼ˆæœç´¢æŒ‡å®šçš„.cpp é€’å½’ï¼‰æ˜¯CMakeList.txt æ–‡ä»¶æ‰€åœ¨ç›®å½•

#è®¾ç½®è¾“å‡ºè·¯å¾„ å®å®šä¹‰
set(EXECUTABLE_OUTPUT_PATH ${CMAKE_CURRENT_SOURCE_DIR}) 
add_executable(test &{SRC})


```

âœ… æ€»ç»“ä¸€å¥è¯ï¼š

> CMake ä¸éœ€è¦ `.h` æ–‡ä»¶å»å‚ä¸ç¼–è¯‘ï¼Œåªè¦ `.cpp` æ–‡ä»¶å¼•ç”¨åˆ°äº†æ­£ç¡®çš„ `.h`ï¼Œç¼–è¯‘å™¨å°±èƒ½è‡ªåŠ¨æ‰¾åˆ°å¹¶ä½¿ç”¨ã€‚ä½ æ²¡å†™ `.h` ä¹Ÿèƒ½ç¼–è¯‘æˆåŠŸï¼Œæ˜¯å®Œå…¨åˆç†çš„ã€‚





#### 02  include   src    build  

æºæ–‡ä»¶å’Œå¤´æ–‡ä»¶åˆ†å¼€äº†   è¦å‘Šè¯‰ç¼–è¯‘å™¨å¤´æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®  è¦ä¸æ‰¾ä¸åˆ°  

add_drictories(&{CMAKE_CURRENT_SOURCE_DIR}/include)

![image-20250715150543720](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250715150543720.png)

```cmake
 project(test)
cmake_minimum_requiredVERSION 3.0()
set(CMAKE_CXX_STANDARD  11)

file(GLOB SRC ${CMAKE_CURRENT_SOURCE_DIR}/sec/*.cpp)
# è®¾ç½®å¤´æ–‡ä»¶æœç´¢è·¯å¾„.h
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)  #ç­‰åŒäºç»™ç¼–è¯‘å™¨åŠ äº†å‚æ•°ï¼š-I/path/to/your/project/include
#æ·»åŠ åº“  static  share
#add_library(calc SHARED ${SRC})

set(EXECUTABLE  ${CMAKE_CURRENT_SOURCE_DIR} )
add_executable(text &{SRC})

```



```cmake

# cmake æ—¶æ„å»ºä¸€ä¸ªbuildç›®å½•ï¼ˆä¿å­˜cmakeç”Ÿæˆçš„ä¸­é—´äº§ç‰©ï¼‰ cmake ..(è¿™ä¸ª..è·¯å¾„æ˜¯CMakeLists.txtæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•)
#é¡¹ç›®å ä¸å†™å¯ä¸å¯ä»¥
project(test)
#æŒ‡å®šcmakeç‰ˆæœ¬  é«˜äº3.0
cmake_minimum_required(VERSION 3.0)

#è®¾ç½®å˜é‡
#set(SOR add.cpp div.cpp mult.cpp sub.cpp main.cpp)
#æ–‡ä»¶æœç´¢çš„ä¸¤ç§æ–¹å¼
#aux_source_directory(${PROJECT_SOURCE_DIR} SOR)  #   PROJECT_SOURCE_DIRï¼ˆæœç´¢æ‰€æœ‰çš„.cpp .c .hæ–‡ä»¶ ä¸èƒ½é€’å½’ï¼‰æ˜¯cmake åçš„åœ°å€

#[[æ³¨æ„  1.fileåªæ˜¯è¯´æŠŠè·¯å¾„åˆ—è¡¨ç»™SOR   ä½†æ˜¯å¹¶æ²¡æœ‰ç»™ç¼–è¯‘å™¨ï¼Œ.héœ€è¦ç»™ç¼–è¯‘å™¨ç¼–è¯‘å™¨æ‰çŸ¥é“å»å“ªé‡Œå¯»æ‰¾
file(GLOB SOR ${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp)
file(GLOB SOR_H ${CMAKE_CURRENT_SOURCE_DIR}/include/*.h) 
set(SOR ${SOR} ${SOR_H})  # åˆå¹¶åˆ—è¡¨
è™½ç„¶ä½ æŠŠå¤´æ–‡ä»¶è·¯å¾„æ”¾å…¥äº† SOR å˜é‡
ä½† CMake ä¸ä¼šè‡ªåŠ¨ æŠŠè¿™äº›è·¯å¾„åŠ å…¥ç¼–è¯‘å™¨çš„å¤´æ–‡ä»¶æœç´¢è·¯å¾„
ç¼–è¯‘å™¨ä»ç„¶ä¸çŸ¥é“å»å“ªé‡Œæ‰¾ head.h

]]
file(GLOB SOR ${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp)  #   CMAKE_CURRENT_SOURCE_DIRï¼ˆæœç´¢æŒ‡å®šçš„.cpp é€’å½’ï¼‰æ˜¯CMakeList.txt æ–‡ä»¶æ‰€åœ¨ç›®å½•
# è®¾ç½®å¤´æ–‡ä»¶æœç´¢è·¯å¾„
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include) 


#è®¾ç½®è¾“å‡ºè·¯å¾„ å®å®šä¹‰
set(EXECUTABLE_OUTPUT_PATH  ${PROJECT_SOURCE_DIR})  #PROJECT_SOURCE_DIRå®æ˜¯cmake åé¢è·Ÿçš„è·¯å¾„ 
#ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶
add_executable(test ${SOR})

```



#### 03 é™æ€åº“  åŠ¨æ€åº“  



æ€»ä½“æµç¨‹  ä¸€æ ·çš„

add_library()  //ç”Ÿæˆåº“

link_directories()  //å‘Šè¯‰åº“çš„ä½ç½®

add_executable() //ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶

target_link_libraries(test  cale) //  å‘Šè¯‰æŸä¸ªå¯æ‰§è¡Œæ–‡ä»¶é“¾æ¥å“ªä¸ªåº“



```cmake
project(test)
    
cmake_minimum_required(VERSION 3.0)
set(CMAKE_CXX_STANDARD 11)
    
    
file(GLOB SRC ${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)
#åº“çš„è¾“å‡ºè·¯å¾„
#  é™æ€åº“å’ŒåŠ¨æ€åº“éƒ½å¯ä»¥ä½¿ç”¨ LIBRARY_OUTPUT_PATH é’ˆå¯¹åŠ¨æ€åº“å…·æœ‰å¯æ‰§è¡Œæƒé™è¿˜å¯ä»¥ä½¿ç”¨EXECUTABLE_OUTPUT_PATH
set(LIBRARY_OUTPUT_PATH ${CMAKE_CURRENT_SOURCE_DIR})

#æ·»åŠ é™æ€åº“ 
add_library(cale_a STATIC ${SRC})

#æ·»åŠ åŠ¨æ€åº“
add_library(cale_s SHARED ${SRC})


link_directories(${CMAKE_CURRENT_SOURCE_DIR}/lib1)# å‘Šè¯‰é™æ€åº“çš„æ–‡ä»¶ä½ç½®
add_executable(test1 ${SRC})  
target_link_libraries(test1 cale_a)  #å¿…é¡»åœ¨add_execurableåé¢æ˜¯ç»™æŸä¸ªâ€œå·²ç»å­˜åœ¨çš„ç›®æ ‡â€ï¼ˆtargetï¼‰è®¾ç½®é“¾æ¥åº“å±æ€§ã€‚

# æœ‰äº†åº“è¦å‘å¸ƒç»™ä½¿ç”¨è€…  åŠ¨æ€åº“å’Œé™æ€åº“éƒ½æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ .cppæ˜¯æ–‡æœ¬çš„æ ¼å¼  æ‰€ä»¥å‘å¸ƒçš„æ—¶å€™è¿˜è¦æœ‰includeä¸­çš„.hæ–‡ä»¶

#æµ‹è¯•åˆ›å»ºå‡ºæ¥çš„é™æ€åº“å’ŒåŠ¨æ€åº“èƒ½ä¸èƒ½ç”¨  éœ€è¦å…ˆå‘å¸ƒ åº“å’Œå¤´æ–‡ä»¶
# #åŠ¨æ€åº“çš„é“¾æ¥
link_directories(${CMAKE_CURRENT_SOURCE_DIR}/lib2)
add_executable(test2 ${SRC})
target_link_libraries(test2  cale) #è¿™é‡Œç»™å‡ºåŠ¨æ€åº“çš„é“¾æ¥  TARGET
    
```

æ˜¯çš„ï¼Œâœ… **`target_link_libraries(test1 cale_a)` å¿…é¡»åœ¨ `add_executable(test1 ...)` ä¹‹åæ‰§è¡Œ**ï¼Œè¿™æ˜¯ **CMake çš„è¯­æ³•è§„å®š**ï¼Œä¸æ˜¯å»ºè®®ï¼Œè€Œæ˜¯ç¡¬æ€§è§„åˆ™ã€‚

ğŸ“Œ åŸå› è§£é‡Šï¼ˆä¸€å®šè¦åœ¨åé¢ï¼‰

CMake çš„è®¾è®¡é€»è¾‘æ˜¯ï¼š

> `target_link_libraries()` æ˜¯ç»™æŸä¸ªâ€œå·²ç»å­˜åœ¨çš„ç›®æ ‡â€ï¼ˆtargetï¼‰è®¾ç½®é“¾æ¥åº“å±æ€§ã€‚

æ‰€ä»¥ä½ å¿…é¡» **å…ˆåˆ›å»ºè¿™ä¸ªç›®æ ‡**ï¼ˆä¸ç®¡æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ `add_executable()`ï¼Œè¿˜æ˜¯åº“ `add_library()`ï¼‰ï¼ŒCMake æ‰å…è®¸ä½ å¯¹å®ƒè®¾ç½®é“¾æ¥ä¿¡æ¯ã€‚

#### 05  message

æ‰“å°æ¶ˆæ¯çš„

```cmake
#æ‰“å°æ¶ˆæ¯
cmake_minimum_required(VERSION 3.0)
project(message)
set(CMAKE_CXX_STANDARD 11)


file(GLOB  SRC ${CMAKE_CURRENT_SOURCE_DIR}/*.cpp)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)
message( "xxxxxxxxxxxxxx")
link_directories(${CMAKE_CURRENT_SOURCE_DIR}/lib2)
message(STATUS "11111xxxxxxxxxxxxxx")
add_executable(test ${SRC})
#è¾“å‡ºå˜é‡
message(${SRC})
message(STATUS "11111xxxxxxxxxxxxxx")
```



#### 06 list 

```
#[[å­—ç¬¦ä¸²çš„æ“ä½œ    
listï¼ˆAPPEND src  item1  item2  ... )   
list(REMOVE_ITEM src  item1  item2  ...)   
è·å–é•¿åº¦list(LENGTH src  output_var)  
è·å–å…ƒç´ list(GET SRC -1 output_var)
                list(JOIN src  sep  output_var)
                list(find  src  item  output_var)
                list(insert src index item1 item2 ...)
æ’å…¥å¤´           list(prepend src item1 item2 ...)
å¼¹å‡ºæœ€åä¸€ä¸ªå…ƒç´   list(POP_BACK src output_var)
å¼¹å‡ºå¤´           list(POP_FRONT src output_var)
ç§»é™¤åˆ—è¡¨ä¸­é‡å¤å…ƒç´  list(REMOVE_DUPLICATES src)
å°†æŒ‡å®šç´¢å¼•åˆ é™¤    list(REMOVE_AT src index)
åˆ—è¡¨åè½¬         list(REVERSE src)
åˆ—è¡¨æ’åº         list(SORT src comparator)
]]
#listçš„å…¶ä»–æ“ä½œ   
```



```cmake
cmake_minimum_required(VERSION 3.0)
project(test)
set(CMAKE_CXX_STANDARD 11)

message("===========é…ç½®å¼€å§‹============")
file(GLOB SRC ${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp)
file(GLOB APP ${CMAKE_CURRENT_SOURCE_DIR}/src/main.cpp)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)
#åˆ é™¤ç»å¯¹è·¯å¾„
list(REMOVE_ITEM SRC ${APP}) 
message("SRC:${SRC}")
message("APP:${APP}")
message("===========é…ç½®å®Œæˆ============")

#åˆ›å»ºåŠ¨æ€åº“
message("===========åˆ›å»ºåŠ¨æ€åº“============")
set(LIBRARY_OUTPUT_PATH  ${CMAKE_CURRENT_SOURCE_DIR}/lib_so)
add_library(calc SHARED ${SRC})
message("===========åˆ›å»ºåŠ¨æ€åº“å®Œæˆ============")

link_directories(${LIBRARY_OUTPUT_PATH})
set(EXECUTABLE_OUTPUT_PATH ${CMAKE_CURRENT_SOURCE_DIR})
add_executable(test ${APP})
target_link_libraries(test calc)

```

#### 07 å®å®šä¹‰  

*#è¿›è¡Œå®å®šä¹‰  è‡ªå®šä¹‰ å¸®æˆ‘ä»¬æŠŠç¨‹åºæ‰§è¡ŒæœŸé—´éœ€è¦çš„å®å®šä¹‰å‡ºæ¥  add_definitions(-Då®)*

å¾ˆå¥½ï¼æˆ‘ä»¬æ¥è¯¦ç»†è®²æ¸…æ¥š CMake ä¸­çš„ï¼š

> âœ… `add_definitions(-DDEBUG)` çš„å«ä¹‰ã€ä½œç”¨ã€ä½¿ç”¨æ—¶æœºï¼Œä»¥åŠç°ä»£æ›¿ä»£æ–¹å¼ã€‚

âœ… ä¸€å¥è¯è¯´æ˜ï¼š

```
cmake


CopyEdit
add_definitions(-DDEBUG)
```

è¡¨ç¤ºï¼š

> **ç»™æ‰€æœ‰åç»­çš„æºæ–‡ä»¶æ·»åŠ ä¸€ä¸ªé¢„å¤„ç†å®å®šä¹‰ `DEBUG`ï¼Œç­‰æ•ˆäºåœ¨ç¼–è¯‘æ—¶åŠ ä¸Š `-DDEBUG`ã€‚**

âœ… å®ƒç­‰ä»·äºæ‰‹åŠ¨ g++ å‘½ä»¤çš„å†™æ³•ï¼š

```
bash


CopyEdit
g++ -DDEBUG main.cpp -o main
```

è¿™æ ·åœ¨ C++ æºæ–‡ä»¶é‡Œä½ å°±å¯ä»¥ç”¨ï¼š

```
cppCopyEdit#ifdef DEBUG
    std::cout << "Debugging info..." << std::endl;
#endif
```

```Cmake
add_difinition(-DDEBUG)

cmake_minimum_required(VERSION 3.0)
project(test)
set(CMAKE_CXX_STANDARD 11)

message("===========é…ç½®å¼€å§‹============")
file(GLOB SRC ${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp)
file(GLOB APP ${CMAKE_CURRENT_SOURCE_DIR}/src/main.cpp)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)
#åˆ é™¤ç»å¯¹è·¯å¾„
list(REMOVE_ITEM SRC ${APP}) 
message("SRC:${SRC}")
message("APP:${APP}")
message("===========é…ç½®å®Œæˆ============")

#åˆ›å»ºåŠ¨æ€åº“
message("===========åˆ›å»ºåŠ¨æ€åº“============")
set(LIBRARY_OUTPUT_PATH  ${CMAKE_CURRENT_SOURCE_DIR}/lib_so)
add_library(calc SHARED ${SRC})
message("===========åˆ›å»ºåŠ¨æ€åº“å®Œæˆ============")

link_directories(${LIBRARY_OUTPUT_PATH})
set(EXECUTABLE_OUTPUT_PATH ${CMAKE_CURRENT_SOURCE_DIR})
add_executable(test ${APP})
target_link_libraries(test calc)

```

#### 08 çˆ¶å­å…³ç³»çš„å¤æ‚ç›®å½•

*[add_subdirectory(lib)  çˆ¶å­å…³ç³»çš„å¤æ‚ç›®å½•  å­ç›®å½•ä¹ŸåŒ…å«cmakelists.txt* 

*å­ç›®å½•å¯ä»¥ä½¿ç”¨çˆ¶ç›®å½•çš„å˜é‡ï¼ˆå…¨å±€å˜é‡ï¼‰   çˆ¶ç›®å½•ä¸å¯ä»¥ä½¿ç”¨å­ç›®å½•ï¼ˆå±€éƒ¨ï¼‰* 

*]]*

```cmake
add_definitions(-DDEBUG)
cmake_minimum_required(VERSION 3.0)
project(test)
set(CMAKE_CXX_STANDARD 11)

message("===========é…ç½®å¼€å§‹============")
file(GLOB SRC ${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp)
file(GLOB APP ${CMAKE_CURRENT_SOURCE_DIR}/src/main.cpp)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)
#åˆ é™¤ç»å¯¹è·¯å¾„
list(REMOVE_ITEM SRC ${APP}) 
message("SRC:${SRC}")
message("APP:${APP}")
message("===========é…ç½®å®Œæˆ============")

#åˆ›å»ºåŠ¨æ€åº“
message("===========åˆ›å»ºåŠ¨æ€åº“============")
set(LIBRARY_OUTPUT_PATH  ${CMAKE_CURRENT_SOURCE_DIR}/lib_so)
add_library(calc SHARED ${SRC})
message("===========åˆ›å»ºåŠ¨æ€åº“å®Œæˆ============")

link_directories(${LIBRARY_OUTPUT_PATH})
set(EXECUTABLE_OUTPUT_PATH ${CMAKE_CURRENT_SOURCE_DIR})
add_executable(test ${APP})
target_link_libraries(test calc)

```





å¾ˆå¥½ï¼Œè¿™æ¬¡æˆ‘ä»¬è®² CMake ä¸­çš„ä¸€ä¸ªé‡è¦å‘½ä»¤ï¼š

> âœ… `add_subdirectory` â€”â€” ç”¨äº**å°†å­ç›®å½•åŠ å…¥å½“å‰æ„å»ºç³»ç»Ÿ**ï¼Œæ”¯æŒé€’å½’æ„å»ºå¤šä¸ªæ¨¡å—æˆ–ç»„ä»¶ã€‚





âœ… ä¸€å¥è¯ç†è§£

```
cmake


CopyEdit
add_subdirectory(src)
```

è¡¨ç¤ºï¼š

> â€œè¯·è¿›å…¥ `src/` ç›®å½•ï¼ŒåŠ è½½å®ƒçš„ `CMakeLists.txt` å¹¶æŠŠå®ƒå½“ä½œå½“å‰é¡¹ç›®çš„ä¸€éƒ¨åˆ†æ¥ä¸€èµ·æ„å»ºã€‚â€

ğŸ“˜ å®ƒçš„ä½œç”¨ï¼š

| åŠŸèƒ½                         | è¯´æ˜                                           |
| ---------------------------- | ---------------------------------------------- |
| ğŸ”¨ **æ¨¡å—åŒ–ç®¡ç†æºç **         | æ¯ä¸ªæ¨¡å—æˆ–ç»„ä»¶ç‹¬ç«‹æ”¾åœ¨å­ç›®å½•ä¸­ï¼Œä¾¿äºç»´æŠ¤å’Œåˆ†å·¥ |
| ğŸ” **é€’å½’æ„å»º**               | ä¼šé€’å½’è°ƒç”¨å­ç›®å½•ä¸‹çš„ `CMakeLists.txt` æ–‡ä»¶     |
| ğŸ”— **æ”¯æŒ target å…±äº«ä¸ä¾èµ–** | ä¸»ç›®å½•å¯ä»¥é“¾æ¥å­ç›®å½•ä¸­ç”Ÿæˆçš„åº“æˆ–ç›®æ ‡           |

âœ… ç¤ºä¾‹åœºæ™¯

ä½ çš„å·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼š

```
csharpCopyEditproject/
â”œâ”€â”€ CMakeLists.txt          # é¡¶å±‚
â”œâ”€â”€ main.cpp
â”œâ”€â”€ math/
â”‚   â”œâ”€â”€ CMakeLists.txt      # å­ç›®å½•
â”‚   â”œâ”€â”€ add.cpp
â”‚   â””â”€â”€ add.h
```

é¡¶å±‚ `CMakeLists.txt`

```
cmakeCopyEditcmake_minimum_required(VERSION 3.10)
project(MyProject)

add_subdirectory(math)  # åŠ å…¥ math å­ç›®å½•

add_executable(main main.cpp)
target_link_libraries(main mathlib)  # é“¾æ¥å­ç›®å½•é‡Œçš„åº“
```

å­ç›®å½• `math/CMakeLists.txt`

```
cmakeCopyEditadd_library(mathlib add.cpp)
target_include_directories(mathlib PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})
```

main.cpp`

```
cppCopyEdit#include "add.h"
#include <iostream>

int main() {
    std::cout << add(2, 3) << std::endl;
    return 0;
}
```

âœ… æ‰§è¡Œç»“æœï¼š

- CMake ä¼šé€’å½’è¿›å…¥ `math/` ç›®å½•
- ç¼–è¯‘ `mathlib` é™æ€åº“
- ä¸»ç¨‹åº `main` é“¾æ¥è¿™ä¸ªåº“
- ä¸€èµ·æ„å»ºå®Œæˆï¼Œç›®æ ‡å¯ç”¨
- 



### 14 .STL å®¹å™¨  

https://www.nowcoder.com/discuss/724532234882940928

åµŒå…¥å¼å…«è‚¡2ã€‘C++ï¼šSTLå®¹ç®—æ³•

é»‘é©¬ç¨‹åºå‘˜ PDF    

[]: 

[]()

#### 1. STLå¸¸è§å®¹å™¨åŠå…¶å†…éƒ¨å®ç°çš„æ•°æ®ç»“æ„

åºå· åç§° æè¿° å­˜å‚¨ç»“æ„ å¸¸ç”¨æ–¹æ³•å’Œæ“ä½œ

 äºŒã€å“ªäº› STL å®¹å™¨çš„æ“ä½œ**å¿…é¡»**æˆ–**æ¨è**ä½¿ç”¨è¿­ä»£å™¨ï¼Ÿ



âœ…stringçš„æ“ä½œæ˜¯åŸºäºä¸‹æ ‡çš„è¿­ä»£å™¨ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ä¸¥æ ¼

æ¥è¯´stringå¹¶ä¸å±äºå®¹å™¨ï¼Œä¸€èˆ¬å®¹å™¨æ¥éƒ½æ˜¯ä»¥è¿­ä»£å™¨

ä¸ºåŸºå‡†è®¿é—®å…ƒç´ çš„ inset   erase



| å®¹å™¨ç±»å‹                               | æ˜¯å¦æ”¯æŒéšæœºè®¿é—® | æ˜¯å¦æ¨èä½¿ç”¨è¿­ä»£å™¨    | åŸå›                                         |
| -------------------------------------- | ---------------- | --------------------- | ------------------------------------------- |
| `std::vector`                          | âœ… æ˜¯             | âŒï¼ˆå¯ä»¥ç”¨ä¸‹æ ‡ï¼‰       | å› ä¸ºå®ƒåƒæ•°ç»„ä¸€æ ·                            |
| `std::string`                          | âœ… æ˜¯             | âŒï¼ˆå¸¸ç”¨ä¸‹æ ‡ï¼‰         | åŒä¸Š                                        |
| `std::deque`                           | âœ… æ˜¯             | âŒï¼ˆä¸‹æ ‡æˆ–è¿­ä»£å™¨çš†å¯ï¼‰ | æ”¯æŒéšæœºè®¿é—®                                |
| `std::list`                            | âŒ å¦             | âœ… å¿…é¡»ç”¨è¿­ä»£å™¨        | ä¸æ”¯æŒ `operator[]`                         |
| `std::forward_list`                    | âŒ å¦             | âœ… å¿…é¡»ç”¨è¿­ä»£å™¨        | åªèƒ½å‰å‘éå†                                |
| `std::set` / `std::multiset`           | âŒ å¦             | âœ… å¿…é¡»ç”¨è¿­ä»£å™¨        | æ— ä¸‹æ ‡è®¿é—®                                  |
| `std::map` / `std::multimap`           | âŒ å¦             | âœ… å¿…é¡»ç”¨è¿­ä»£å™¨        | æ— ä¸‹æ ‡è®¿é—®ï¼Œ`[]`åªèƒ½ç”¨äº `map<K, V>` çš„å†™å…¥ |
| `std::unordered_map` / `unordered_set` | âŒ å¦             | âœ…ï¼ˆå¤šä½¿ç”¨è¿­ä»£å™¨ï¼‰     | ä¸æ”¯æŒæœ‰åºä½ç½®                              |



éå¸¸æ£’çš„é—®é¢˜ï¼

ä½ é—®çš„æ˜¯ï¼š

> `std::string::insert` ä¸ºä»€ä¹ˆå¯ä»¥ç”¨ä¸‹æ ‡è€Œä¸æ˜¯åƒ `vector` ä¸€æ ·å¿…é¡»ç”¨è¿­ä»£å™¨ï¼Ÿæ˜¯ä¸æ˜¯å…¶å®ä¹Ÿå¯ä»¥ç”¨è¿­ä»£å™¨ï¼Ÿ

ç­”æ¡ˆæ˜¯ï¼š

> âœ… **`std::string::insert` æ—¢å¯ä»¥ç”¨ä¸‹æ ‡ï¼Œä¹Ÿå¯ä»¥ç”¨è¿­ä»£å™¨ï¼**

ğŸ”¹ ä¸€ã€`std::string::insert` çš„ä¸¤ç§æ¥å£å½¢å¼

`std::string` æ˜¯ STL ä¸­å°‘æ•°æä¾›**ä¸‹æ ‡å¼æ’å…¥**å’Œ**è¿­ä»£å™¨å¼æ’å…¥**ä¸¤ç§æ–¹å¼çš„å®¹å™¨ã€‚

âœ… å½¢å¼ 1ï¼šä¸‹æ ‡æ’å…¥

```
cppCopyEditstd::string s = "hello";
s.insert(2, "XX");  // æ’å…¥åˆ°ç¬¬2ä¸ªä½ç½®ï¼Œå˜æˆ heXXllo
```

âœ… å½¢å¼ 2ï¼šè¿­ä»£å™¨æ’å…¥ï¼ˆåƒ vector ä¸€æ ·ï¼‰

```
cppCopyEditstd::string s = "hello";
s.insert(s.begin() + 2, 'X');  // æ’åœ¨ç¬¬2ä¸ªä½ç½®
```

æˆ–è€…æ’å…¥ä¸€æ®µï¼š

```
cppCopyEditstd::string s = "hello";
std::string t = "XX";
s.insert(s.begin() + 2, t.begin(), t.end());  // heXXllo
```

ğŸ”¹ äºŒã€ä¸ºä»€ä¹ˆ `string` æä¾›ä¸‹æ ‡æ¥å£ï¼Œè€Œ `vector` æ²¡æœ‰ï¼Ÿ

âœ… åŸå›  1ï¼šå­—ç¬¦ä¸²æ“ä½œâ€œä»¥ä½ç½®ä¸ºæ ¸å¿ƒâ€

- å­—ç¬¦ä¸² API ä¼ ç»Ÿä¸Šéƒ½å›´ç»•â€œç¬¬å‡ ä¸ªå­—ç¬¦â€å±•å¼€ï¼Œæ¯”å¦‚ï¼š
  - `insert(pos, str)`
  - `substr(pos, len)`
  - `replace(pos, len, str)`
- æ‰€ä»¥æä¾›ä¸‹æ ‡ç‰ˆæœ¬ï¼Œ**ç¬¦åˆç›´è§‰ã€å¸¸ç”¨ã€ç®€æ´**ã€‚

âœ… åŸå›  2ï¼š`string` æ˜¯ä¸“é—¨ä¸ºå­—ç¬¦å¤„ç†è€Œä¼˜åŒ–çš„ç±»ï¼Œä¸æ˜¯çº¯é€šç”¨å®¹å™¨

- å®ƒæ˜¯ STL çš„ `basic_string<char>`ï¼Œä½†ä¹Ÿè¢«â€œå½“ä½œå­—ç¬¦æ•°ç»„â€æ¥å¯¹å¾…ï¼›
- æä¾›äº†é¢å¤–çš„ä¾¿æ·æ¥å£ï¼Œæ˜¯**ç‰¹ä¾‹**ï¼Œä¸æ˜¯ä¸€èˆ¬ STL å®¹å™¨éƒ½è¿™æ ·ã€‚

ğŸ”¹ ä¸‰ã€å¯¹æ¯”ï¼š`string` vs `vector` çš„ insert æ¥å£

| å®¹å™¨          | æ”¯æŒä¸‹æ ‡æ’å…¥ | æ”¯æŒè¿­ä»£å™¨æ’å…¥ | åŸå› è¯´æ˜                             |
| ------------- | ------------ | -------------- | ------------------------------------ |
| `std::vector` | âŒ ä¸æ”¯æŒ     | âœ… æ”¯æŒ         | æ³›å‹å®¹å™¨ï¼Œä¸æä¾›æŒ‰ä¸‹æ ‡æ’å…¥çš„è¯­ä¹‰     |
| `std::string` | âœ… æ”¯æŒ       | âœ… æ”¯æŒ         | å› ä¸ºå®ƒæ˜¯å­—ç¬¦ä¸²ï¼Œæœ‰å†å²ä¹ æƒ¯å’Œç‰¹æ®Šå¤„ç† |





| åºå· | åç§°           | æè¿°                   | å­˜å‚¨ç»“æ„                       | å¸¸ç”¨æ–¹æ³•å’Œæ“ä½œ                                               |
| ---- | -------------- | ---------------------- | ------------------------------ | ------------------------------------------------------------ |
| 0    | string         |                        | char*                          | å¢ï¼šs.insert, s.append   åˆ ï¼šs.erase   æ”¹ï¼šæ˜¯ã€‚replace(),s.assing(),æŸ¥ï¼šfind()   ,å…¶ä»–s.substr(),s.size(),at(),[] |
| 1    | vector         | åŠ¨æ€åˆ†é…çš„æ•°ç»„         | é¡ºåºæ•°ç»„ï¼ˆarrayï¼‰              | `v.push_back()`, `v.pop_back()`, `v.insert()`, `v.erase()`, `v.capacity()`, `v.size()`, `v.at(idx)`, `v.front()`, `v.back()  ,v.reserve(),v.swap() ,v.resize()ï¼Œv.assgin(),v.empty()ï¼Œ` |
| 5    | deque          | åŒç«¯é˜Ÿåˆ—,åŒç«¯æ•°ç»„      | åˆ†æ®µè¿ç»­ï¼ˆå¤šä¸ª `vector` è¿ç»­ï¼‰ | `d.push_back()`, `d.push_front()`, `d.pop_back()`, `d.pop_front()`, `d.insert()`, `d.erase()  ,d.assgin()/d.empty()/d.size()/d.resize()/å®¹å™¨æ²¡æœ‰å®¹é‡çš„æ¦‚å¿µï¼Œã€‚at(),[],/ d.front()/d.back()/sort()` |
| *    | ****           | ***                    | ****                           | **ä¸‹é¢æ˜¯ééšæœºè®¿é—®çš„å®¹å™¨  ä¸å¯ä»¥éšå³æ’å…¥åˆ é™¤æ²¡æœ‰at  []**     |
| 2    | list           | åŒå‘é“¾è¡¨               | ç¦»æ•£                           | `lt.push_back()`, `lt.push_front()`, `lt.insert()`, `lt.erase()`, `lt.sort()`, `lt.merge()`, `lt.splice()  ï¼Œassgin()  swap()  size()  empty  resize(),  remove(),clear(),reverse(), ` |
| 3    | stack          | æ ˆ                     | ç”¨ `list` æˆ– `deque` å®ç°0     | `push()`, `pop()`, `top()  empty(),size(),`ï¼Œ                |
| 4    | queue          | é˜Ÿåˆ—(ä¸å…è®¸æœ‰éå†è¡Œä¸º) | ç”¨ `list` æˆ– `deque` å®ç°      | `push()`, `pop()`, `front()`, `back()  empty()  size()`  ï¼Œ  |
| 6    | priority_queue | ä¼˜å…ˆçº§é˜Ÿåˆ—             | `vector`                       | `push()`, `pop()`, `top()`                                   |
| ***  | *******        | ********               | ******                         | **********************æ²¡æœ‰push  pop                          |
| 7    | set            | é›†åˆï¼ˆæœ‰åºä¸é‡å¤ï¼‰     | çº¢é»‘æ ‘ï¼ˆå¼±å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼‰     | `insert()  clear() ` , `erase()`, `find()`, `count()`, `clear()  size()  empty() swap() ` |
| 8    | multiset       | é›†åˆï¼ˆæœ‰åºå¯é‡å¤ï¼‰     | çº¢é»‘æ ‘                         | `insert()`, `erase()`, `find()`, `count()`, `clear()`        |
| 9    | unordered_set  | é›†åˆï¼ˆæ— åºä¸é‡å¤ï¼‰     | å“ˆå¸Œè¡¨                         | `insert()`, `erase()`, `find()`, `count()`, `clear()`        |
| 10   | map            | é”®å€¼å¯¹ï¼ˆæœ‰åºä¸é‡å¤ï¼‰   | çº¢é»‘æ ‘                         | `insert() clear()` , `erase()`, `find()`, `count()`, `clear() size() empty() swap() ` |
| 11   | multimap       | é”®å€¼å¯¹ï¼ˆæœ‰åºå¯é‡å¤ï¼‰   | çº¢é»‘æ ‘                         | `insert()`, `erase()`, `find()`, `count()`, `clear()`        |
| 12   | unordered_map  | é”®å€¼å¯¹ï¼ˆæ— åºä¸é‡å¤ï¼‰   | å“ˆå¸Œè¡¨                         | `insert()`, `erase()`, `find()`, `count()`, `clear()`        |
| 13   | hash_map       | å“ˆå¸Œè¡¨ï¼ˆç±»ä¼¼ `map`ï¼‰   | å“ˆå¸Œè¡¨                         | `insert()`, `erase()`, `find()`, `count()`, `clear()`        |

#### 2. dequeåº•å±‚æ•°æ®ç»“æ„

![image-20250716100529563](assets/image-20250716100529563.png)

`deque` åº•å±‚å®ç°é€šå¸¸æ˜¯åˆ†æ®µè¿ç»­çš„å†…å­˜ç»“æ„ï¼Œå³ç”±å¤šä¸ª `vector` ç»„æˆï¼Œå…è®¸é«˜æ•ˆçš„ä»ä¸¤ç«¯è¿›è¡Œå…ƒç´ çš„æ’å…¥å’Œåˆ é™¤ã€‚

âœ… **deque****ä¸****vector****åŒºåˆ«ï¼š**

vectorå¯¹äºå¤´éƒ¨çš„æ’å…¥åˆ é™¤æ•ˆç‡ä½ï¼Œæ•°æ®é‡è¶Šå¤§ï¼Œæ•ˆç‡è¶Šä½

dequeç›¸å¯¹è€Œè¨€ï¼Œå¯¹å¤´éƒ¨çš„æ’å…¥åˆ é™¤é€Ÿåº¦å›æ¯”vectorå¿«

vectorè®¿é—®å…ƒç´ æ—¶çš„é€Ÿåº¦ä¼šæ¯”dequeå¿«,è¿™å’Œä¸¤è€…å†…éƒ¨å®ç°æœ‰å…³





âœ… dequeå†…éƒ¨å·¥ä½œåŸç†:

dequeå†…éƒ¨æœ‰ä¸ª**ä¸­æ§å™¨**ï¼Œç»´æŠ¤æ¯æ®µç¼“å†²åŒºä¸­çš„å†…å®¹ï¼Œç¼“å†²åŒºä¸­å­˜æ”¾çœŸå®æ•°æ®

ä¸­æ§å™¨ç»´æŠ¤çš„æ˜¯æ¯ä¸ªç¼“å†²åŒºçš„åœ°å€ï¼Œä½¿å¾—ä½¿ç”¨dequeæ—¶åƒä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´



![image-20250716100442831](assets/image-20250716100442831.png)

#### list  å®¹å™¨

**åŠŸèƒ½ï¼š**å°†æ•°æ®è¿›è¡Œé“¾å¼å­˜å‚¨

**é“¾è¡¨**ï¼ˆlistï¼‰æ˜¯ä¸€ç§ç‰©ç†å­˜å‚¨å•å…ƒä¸Šéè¿ç»­çš„å­˜å‚¨ç»“æ„ï¼Œæ•°æ®å…ƒç´ çš„é€»è¾‘é¡ºåºæ˜¯é€šè¿‡é“¾è¡¨ä¸­çš„æŒ‡é’ˆé“¾æ¥å®ç°çš„

ç»“ç‚¹çš„ç»„æˆï¼šä¸€ä¸ªæ˜¯å­˜å‚¨æ•°æ®å…ƒç´ çš„**æ•°æ®åŸŸ**ï¼Œå¦ä¸€ä¸ªæ˜¯å­˜å‚¨ä¸‹ä¸€ä¸ªç»“ç‚¹åœ°å€çš„**æŒ‡é’ˆåŸŸ**

![image-20250716102138570](assets/image-20250716102138570.png)

ç”±äºé“¾è¡¨çš„å­˜å‚¨æ–¹å¼å¹¶ä¸æ˜¯è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤é“¾è¡¨listä¸­çš„è¿­ä»£å™¨åªæ”¯æŒå‰ç§»å’Œåç§»ï¼Œå±äº**åŒå‘è¿­ä»£å™¨**

âœ… listçš„ä¼˜ç‚¹ï¼š

é‡‡ç”¨åŠ¨æ€å­˜å‚¨åˆ†é…ï¼Œä¸ä¼šé€ æˆå†…å­˜æµªè´¹å’Œæº¢å‡º

é“¾è¡¨æ‰§è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œååˆ†æ–¹ä¾¿ï¼Œä¿®æ”¹æŒ‡é’ˆå³å¯ï¼Œä¸éœ€è¦ç§»åŠ¨å¤§é‡å…ƒç´ 

âœ…listçš„ç¼ºç‚¹ï¼š

é“¾è¡¨çµæ´»ï¼Œä½†æ˜¯ç©ºé—´(æŒ‡é’ˆåŸŸ) å’Œ æ—¶é—´ï¼ˆéå†ï¼‰é¢å¤–è€—è´¹è¾ƒå¤§

Listæœ‰ä¸€ä¸ªé‡è¦çš„æ€§è´¨ï¼Œæ’å…¥æ“ä½œå’Œåˆ é™¤æ“ä½œéƒ½ä¸ä¼šé€ æˆåŸæœ‰listè¿­ä»£å™¨çš„å¤±æ•ˆï¼Œè¿™åœ¨vectoræ˜¯ä¸æˆç«‹çš„ã€‚



> âœ… **`std::list` çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯ï¼šæ’å…¥æˆ–åˆ é™¤ä¸ä¼šä½¿åŸæœ‰çš„è¿­ä»£å™¨å¤±æ•ˆï¼ˆé™¤éåˆ é™¤çš„æ˜¯è¯¥è¿­ä»£å™¨æ‰€æŒ‡çš„å…ƒç´ æœ¬èº«ï¼‰**

é‚£æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šï¼š**ä¸ºä»€ä¹ˆ list å¯ä»¥è¿™ä¹ˆå¹²ï¼Ÿå…¶ä»–å®¹å™¨ï¼ˆå¦‚ vectorã€setã€mapï¼‰ä¸ºä»€ä¹ˆä¸è¡Œï¼Ÿ**

ğŸ”¹ ä¸€ã€å…ˆæ¥çœ‹ `std::list` ä¸ºä»€ä¹ˆä¸å¤±æ•ˆï¼Ÿ

âœ… æœ¬è´¨åŸå› ï¼š`list` æ˜¯é“¾è¡¨ï¼ˆé€šå¸¸æ˜¯åŒå‘é“¾è¡¨ï¼‰

- æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå­˜åœ¨å †ä¸Šï¼›
- èŠ‚ç‚¹ä¹‹é—´é€šè¿‡æŒ‡é’ˆé“¾æ¥ï¼›
- æ’å…¥/åˆ é™¤èŠ‚ç‚¹ï¼Œä¸ä¼šç§»åŠ¨å…¶å®ƒèŠ‚ç‚¹çš„åœ°å€ï¼›
- æ‰€ä»¥ä¹‹å‰è¿”å›çš„è¿­ä»£å™¨ï¼ˆå…¶å®å°±æ˜¯èŠ‚ç‚¹æŒ‡é’ˆï¼‰ä¾ç„¶æœ‰æ•ˆï¼

```
cppCopyEditstd::list<int> lst = {1, 2, 3};
auto it = std::next(lst.begin());  // æŒ‡å‘ 2
lst.insert(lst.begin(), 0);        // æ’å…¥ 0
std::cout << *it;                  // ä»ç„¶æ˜¯ 2ï¼Œæœ‰æ•ˆ
```

ğŸ”¹ äºŒã€å†æ¥çœ‹ vector ä¸ºä»€ä¹ˆä¼šå¤±æ•ˆï¼Ÿ

âŒ åŸå› ï¼š`vector` æ˜¯**è¿ç»­æ•°ç»„**

- æ’å…¥/åˆ é™¤å…ƒç´ ä¼šé€ æˆåç»­å…ƒç´ ç§»åŠ¨ï¼ˆé‡æ’ï¼‰ï¼›
- æœ‰æ—¶è¿˜ä¼šå¯¼è‡´æ•´ä¸ªæ•°ç»„é‡æ–°åˆ†é…åˆ°æ–°çš„å†…å­˜å—ï¼ˆå°¤å…¶æ˜¯æ’å…¥å¯¼è‡´å®¹é‡ä¸è¶³æ—¶ï¼‰ï¼›
- æ‰€ä»¥æ—§çš„è¿­ä»£å™¨ï¼ˆæœ¬è´¨æ˜¯æŒ‡å‘æ—§å†…å­˜åœ°å€çš„æŒ‡é’ˆï¼‰ä¼šå¤±æ•ˆï¼

```
cppCopyEditstd::vector<int> v = {1, 2, 3};
auto it = v.begin();
v.insert(v.begin(), 0);  // æ’å…¥ä¼šå¯¼è‡´å…ƒç´ å³ç§»ï¼Œit å¤±æ•ˆ
std::cout << *it;        // âŒ æœªå®šä¹‰è¡Œä¸ºï¼
```

ğŸ”¹ ä¸‰ã€å…¶ä»–å®¹å™¨çš„è¿­ä»£å™¨å¤±æ•ˆè§„åˆ™

æˆ‘ä»¬ç”¨è¡¨æ ¼æ€»ç»“ä¸€ä¸‹å„ç§å®¹å™¨çš„è¿­ä»£å™¨å¤±æ•ˆè¡Œä¸ºï¼š

| å®¹å™¨ç±»å‹                          | æ’å…¥æ˜¯å¦ä¼šå¯¼è‡´è¿­ä»£å™¨å¤±æ•ˆï¼Ÿ       | åˆ é™¤æ˜¯å¦ä¼šå¯¼è‡´è¿­ä»£å™¨å¤±æ•ˆï¼Ÿ       | è¯´æ˜                           |
| --------------------------------- | -------------------------------- | -------------------------------- | ------------------------------ |
| `vector`                          | âœ… ä¼šï¼ˆå°¤å…¶æ˜¯æ’å…¥ä¸­é—´æˆ– reallocï¼‰ | âœ… ä¼šï¼ˆåˆ é™¤ç‚¹åæ‰€æœ‰å…ƒç´ å³ç§»ï¼‰     | æ•°ç»„ç»“æ„                       |
| `deque`                           | âœ… æœ‰æ¦‚ç‡å¤±æ•ˆï¼ˆç‰¹åˆ«æ˜¯é¦–å°¾æ’å…¥ï¼‰   | âœ… æœ‰æ¦‚ç‡å¤±æ•ˆ                     | åˆ†æ®µè¿ç»­å†…å­˜                   |
| `list`                            | âŒ ä¸ä¼šå¤±æ•ˆï¼ˆé™¤éåˆ é™¤è¯¥å…ƒç´ ï¼‰     | âŒ ä¸ä¼šå¤±æ•ˆï¼ˆé™¤éåˆ é™¤è¯¥å…ƒç´ ï¼‰     | é“¾è¡¨                           |
| `forward_list`                    | âŒ ä¸ä¼šå¤±æ•ˆï¼ˆé™¤éåˆ é™¤è¯¥å…ƒç´ ï¼‰     | âŒ ä¸ä¼šå¤±æ•ˆï¼ˆé™¤éåˆ é™¤è¯¥å…ƒç´ ï¼‰     | å•å‘é“¾è¡¨                       |
| `set` / `map`                     | âœ… æ’å…¥é€šå¸¸ä¸å¤±æ•ˆ                 | âœ… åˆ é™¤è¯¥å…ƒç´ ä¼šå¤±æ•ˆï¼Œå…¶ä»–ä¸å—å½±å“ | çº¢é»‘æ ‘ï¼Œç»“æ„ç¨³å®šä½†å…ƒç´ å¯å˜æ€§å·® |
| `unordered_set` / `unordered_map` | âœ… æ’å…¥å¯èƒ½ä¼šå¯¼è‡´è¿­ä»£å™¨å¤±æ•ˆ       | âœ… åˆ é™¤è¯¥å…ƒç´ ä¼šå¤±æ•ˆ               | å“ˆå¸Œè¡¨ï¼Œbucket å¯èƒ½é‡æ’        |

ğŸ”¹ å››ã€è¡¥å……è¯´æ˜ï¼šä¸ºä»€ä¹ˆå®¹å™¨ä¸ç»Ÿä¸€ï¼Ÿ

å› ä¸ºæ¯ç§å®¹å™¨çš„åº•å±‚ç»“æ„ä¸åŒï¼Œè¿­ä»£å™¨å®è´¨ä¹Ÿæ˜¯**å¯¹ç»“æ„çš„å°è£…**ï¼š

| å®¹å™¨            | åº•å±‚ç»“æ„ | è¿­ä»£å™¨å®è´¨            |
| --------------- | -------- | --------------------- |
| `vector`        | è¿ç»­å†…å­˜ | åŸå§‹æŒ‡é’ˆ `T*`         |
| `list`          | åŒå‘é“¾è¡¨ | æŒ‡å‘èŠ‚ç‚¹çš„å°è£…æŒ‡é’ˆ    |
| `set/map`       | çº¢é»‘æ ‘   | åŒ…å«æŒ‡é’ˆ + æ ‘ç»“æ„ä¿¡æ¯ |
| `unordered_map` | å“ˆå¸Œè¡¨   | åŒ…æ‹¬ bucket ä¿¡æ¯      |



å› æ­¤ï¼š**è¿­ä»£å™¨èƒ½ä¸èƒ½ä¿ç•™ï¼Œä¸ç»“æ„æ˜¯å¦ç¨³å®šå¯†åˆ‡ç›¸å…³**ã€‚

ğŸ”¹ äº”ã€é¢è¯•å¿…å¤‡æ€»ç»“å£è¯€

> æ’åˆ æ— å¿§å±é“¾è¡¨ï¼Œæ•°ç»„å˜åŠ¨è¯·å°å¿ƒï¼›
>  æ ‘ç±»ç»“æ„çœ‹å…ƒç´ ï¼Œå“ˆå¸Œè£…æ¡¶ä¹Ÿè°¨æ…ã€‚



#### set/multiset  å®¹å™¨

**ç®€ä»‹ï¼š**

æ‰€æœ‰å…ƒç´ éƒ½ä¼šåœ¨æ’å…¥æ—¶è‡ªåŠ¨è¢«æ’åº

**æœ¬è´¨ï¼š**

set/multisetå±äº**å…³è”å¼å®¹å™¨**ï¼Œåº•å±‚ç»“æ„æ˜¯ç”¨**äºŒå‰æ ‘**å®ç°ã€‚

**set****å’Œ****multiset****åŒºåˆ«**ï¼š

setä¸å…è®¸å®¹å™¨ä¸­æœ‰é‡å¤çš„å…ƒç´ 

multisetå…è®¸å®¹å™¨ä¸­æœ‰é‡å¤çš„å…ƒç´ 

setå®¹å™¨æ’å…¥æ•°æ®æ—¶ç”¨insert

setå®¹å™¨æ’å…¥æ•°æ®çš„æ•°æ®ä¼šè‡ªåŠ¨æ’åº



**åŒºåˆ«ï¼š**

setä¸å¯ä»¥æ’å…¥é‡å¤æ•°æ®ï¼Œè€Œmultisetå¯ä»¥

setæ’å…¥æ•°æ®çš„åŒæ—¶ä¼šè¿”å›æ’å…¥ç»“æœï¼Œè¡¨ç¤ºæ’å…¥æ˜¯å¦æˆåŠŸ

multisetä¸ä¼šæ£€æµ‹æ•°æ®ï¼Œå› æ­¤å¯ä»¥æ’å…¥é‡å¤æ•°æ®





ä¸‰ã€çº¢é»‘æ ‘ vs å“ˆå¸Œè¡¨ï¼šå¯¹æ¯”æ€»ç»“

| ç‰¹æ€§       | çº¢é»‘æ ‘             | å“ˆå¸Œè¡¨                    |
| ---------- | ------------------ | ------------------------- |
| æŸ¥æ‰¾æ•ˆç‡   | O(log n)           | å¹³å‡ O(1)ï¼Œæœ€å O(n)      |
| æœ‰åºæ€§     | âœ…ï¼ˆæ”¯æŒèŒƒå›´æŸ¥æ‰¾ï¼‰  | âŒï¼ˆæ— åºï¼‰                 |
| å†…å­˜åˆ©ç”¨   | é«˜ï¼ˆæ— æ‰©å®¹ï¼‰       | å¯èƒ½æœ‰å¤§é‡ç©ºæ§½æˆ–é“¾è¡¨      |
| æ‰©å±•æ€§     | ä¸éœ€è¦æ‰©å®¹         | å®¹é‡éœ€æ‰‹åŠ¨æ‰©å®¹/è‡ªåŠ¨æ‰©å®¹   |
| å¹¶å‘å‹å¥½æ€§ | ç›¸å¯¹è¾ƒéš¾           | Java æœ‰ ConcurrentHashMap |
| å¸¸ç”¨ç”¨é€”   | æœ‰åºæ˜ å°„ï¼ŒåŒºé—´æŸ¥è¯¢ | å¿«é€ŸæŸ¥æ‰¾ï¼Œé”®å€¼ç¼“å­˜        |

#### å¯¹ç»„ pair

pair<type, type> p = make_pair( value1, value2 );



#### map/multimapå®¹å™¨

**ç®€ä»‹ï¼š**

mapä¸­æ‰€æœ‰å…ƒç´ éƒ½æ˜¯pair

pairä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºkeyï¼ˆé”®å€¼ï¼‰ï¼Œèµ·åˆ°ç´¢å¼•ä½œç”¨ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºvalueï¼ˆå®å€¼ï¼‰

æ‰€æœ‰å…ƒç´ éƒ½ä¼šæ ¹æ®å…ƒç´ çš„é”®å€¼è‡ªåŠ¨æ’åº

**æœ¬è´¨ï¼š**

map/multimapå±äº**å…³è”å¼å®¹å™¨**ï¼Œåº•å±‚ç»“æ„æ˜¯ç”¨äºŒå‰æ ‘å®ç°ã€‚

**ä¼˜ç‚¹ï¼š**

å¯ä»¥æ ¹æ®keyå€¼å¿«é€Ÿæ‰¾åˆ°valueå€¼

mapå’Œmultimap**åŒºåˆ«**ï¼š

mapä¸å…è®¸å®¹å™¨ä¸­æœ‰é‡å¤keyå€¼å…ƒç´ 

multimapå…è®¸å®¹å™¨ä¸­æœ‰é‡å¤keyå€¼å…ƒç´ 









#### 3. çº¢é»‘æ ‘

çº¢é»‘æ ‘æ˜¯ä¸€ç§éä¸¥æ ¼å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå…·æœ‰è‡ªåŠ¨æ’åºçš„åŠŸèƒ½ã€‚æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸€ä¸ªé¢œè‰²ï¼ˆçº¢æˆ–é»‘ï¼‰ï¼Œå¹¶ä¸”é€šè¿‡è°ƒæ•´æ ‘çš„ç»“æ„ä¿æŒç‰¹å®šçš„å¹³è¡¡æ¡ä»¶ï¼Œä»è€Œä¿è¯æœ€åæƒ…å†µä¸‹çš„æŸ¥æ‰¾æ•ˆç‡ã€‚

### 15.STL å¸¸è§ç®—æ³•

ä¸»è¦æœ‰ä¸‰ä¸ªå¤´æ–‡ä»¶  <algorithm> <functional> <numeric> ç»„æˆ

<algorithm>æ˜¯æ‰€æœ‰å¤´æ–‡ä»¶ä¸­æœ€å¤§çš„ï¼ŒèŒƒå›´æ¶‰åŠ æ¯”è¾ƒè¿ç®—æŸ¥æ‰¾ã€ éå†ã€ èµ‹å€¼ã€ ä¿®æ”¹ã€ç­‰ç­‰ã€‚

<numeric> ä½“ç§¯å¾ˆå°ï¼ŒåªåŒ…æ‹¬å‡ ä¸ªåœ¨åºåˆ—ä¸Šé¢è¿›è¡Œç®€å•æ•°å­¦è¿ç®—çš„æ¨¡æ¿å‡½æ•°

<functional> å®šä¹‰äº†ä¸€äº›æ¨¡æ¿ç±»,ç”¨ä»¥å£°æ˜å‡½æ•°å¯¹è±¡



#### å‡½æ•°å¯¹è±¡

æ¦‚å¿µï¼š  é‡è½½äº†ï¼ˆï¼‰æ“ä½œç¬¦çš„ç±»ï¼Œå…¶å¯¹è±¡æˆä¸ºå‡½æ•°å¯¹è±¡

â€‹		å‡½æ•°å¯¹è±¡ä½¿ç”¨é‡è½½çš„()æ—¶ï¼Œè¡Œä¸ºç±»ä¼¼å‡½æ•°ï¼Œæ‰€ä»¥ç§°ä¸ºä»¿å‡½æ•°ã€‚

æœ¬è´¨ï¼š

â€‹	å‡½æ•°å¯¹è±¡ï¼ˆä»¿å‡½æ•°ï¼‰ æ˜¯ä¸€ä¸ªç±»   ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚

**4.1.2** **å‡½æ•°å¯¹è±¡ä½¿ç”¨**

**ç‰¹ç‚¹ï¼š**

å‡½æ•°å¯¹è±¡åœ¨ä½¿ç”¨æ—¶ï¼Œå¯ä»¥åƒæ™®é€šå‡½æ•°é‚£æ ·è°ƒç”¨, å¯ä»¥æœ‰å‚æ•°ï¼Œå¯ä»¥æœ‰è¿”å›å€¼

å‡½æ•°å¯¹è±¡è¶…å‡ºæ™®é€šå‡½æ•°çš„æ¦‚å¿µï¼Œå‡½æ•°å¯¹è±¡å¯ä»¥æœ‰è‡ªå·±çš„çŠ¶æ€

å‡½æ•°å¯¹è±¡å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’

#### è°“è¯

æ¦‚å¿µï¼š  è¿”å›boolç±»å‹çš„ä»¿å‡½æ•°ç§°ä¸ºè°“è¯  

â€‹		ä¸€å…ƒè°“è¯

â€‹		äºŒå…ƒè°“è¯

#### å†…å»ºå‡½æ•°å¯¹è±¡

STLå†…å»ºäº†ä¸€ä¸‹å‡½æ•°å¯¹è±¡   functional

â€‹	ç®—æ•°ä»¿å‡½æ•°

â€‹	å…³ç³»ä»¿å‡½æ•°

â€‹	é€»è¾‘ä»¿å‡½æ•°

ç”¨æ³•ï¼š

è¿™äº›ä»¿å‡½æ•°æ‰€äº§ç”Ÿçš„å¯¹è±¡ï¼Œç”¨æ³•å’Œä¸€èˆ¬å‡½æ•°å®Œå…¨ç›¸åŒ

ä½¿ç”¨å†…å»ºå‡½æ•°å¯¹è±¡ï¼Œéœ€è¦å¼•å…¥å¤´æ–‡ä»¶ #include<functional>

1. ç®—æ•°ä»¿å‡½æ•°

   plus<T>

   minus()

   multiplies()

   divides()

   modulus()

   negate()

   template<class T> T plus<T> //åŠ æ³•ä»¿å‡½æ•°

   template<class T> T minus<T> //å‡æ³•ä»¿å‡½æ•°

   template<class T> T multiplies<T> //ä¹˜æ³•ä»¿å‡½æ•°

   template<class T> T divides<T> //é™¤æ³•ä»¿å‡½æ•°

   template<class T> T modulus<T> //å–æ¨¡ä»¿å‡½æ•°

   template<class T> T negate<T> //å–åä»¿å‡½æ•°

2. å…³ç³»ä»¿å‡½æ•°

   template<class T> bool equal_to<T> //ç­‰äº

   template<class T> bool not_equal_to<T> //ä¸ç­‰äº

   template<class T> bool greater<T> //å¤§äº

   template<class T> bool greater_equal<T> //å¤§äºç­‰äº

   template<class T> bool less<T> //å°äº

   template<class T> bool less_equal<T> //å°äºç­‰äº

3. é€»è¾‘ä»¿å‡½æ•°

   



#### 4. å¸¸è§æ’åºç®—æ³•

ç®—æ³•ä¸»è¦æ˜¯ç”±å¤´æ–‡ä»¶ <algorithm> <functional> <numeric> ç»„æˆã€‚

<algorithm> æ˜¯æ‰€æœ‰STLå¤´æ–‡ä»¶ä¸­æœ€å¤§çš„ä¸€ä¸ªï¼ŒèŒƒå›´æ¶‰åŠåˆ°æ¯”è¾ƒã€ äº¤æ¢ã€æŸ¥æ‰¾ã€éå†æ“ä½œã€å¤åˆ¶ã€ä¿®æ”¹ç­‰ç­‰

<numeric> ä½“ç§¯å¾ˆå°ï¼ŒåªåŒ…æ‹¬å‡ ä¸ªåœ¨åºåˆ—ä¸Šé¢è¿›è¡Œç®€å•æ•°å­¦è¿ç®—çš„æ¨¡æ¿å‡½æ•°

<functional> å®šä¹‰äº†ä¸€äº›æ¨¡æ¿ç±»,ç”¨ä»¥å£°æ˜å‡½æ•°å¯¹è±¡ã€‚

##### 1.å¸¸ç”¨éå†ç®—æ³•

for_each

```c++

    for_each(iterator beg, iterator end, _func);
// éå†ç®—æ³• éå†å®¹å™¨å…ƒç´ 
// beg å¼€å§‹è¿­ä»£å™¨
// end ç»“æŸè¿­ä»£å™¨
// _func å‡½æ•°æˆ–è€…å‡½æ•°å¯¹è±¡

```

![image-20250716150636242](assets/image-20250716150636242.png)



transform 

æ¬è¿å®¹å™¨åˆ°å¦ä¸€ä¸ªå®¹å™¨ä¸­

```c++
transform(iter1 beg ,iter1 end,iter2 beg,fun )
    
transform(iterator beg1, iterator end1, iterator beg2, _func);
//beg1 æºå®¹å™¨å¼€å§‹è¿­ä»£å™¨
//end1 æºå®¹å™¨ç»“æŸè¿­ä»£å™¨
//beg2 ç›®æ ‡å®¹å™¨å¼€å§‹è¿­ä»£å™¨
//_func å‡½æ•°æˆ–è€…å‡½æ•°å¯¹è±¡

```





##### 2. å¸¸ç”¨æŸ¥æ‰¾ç®—æ³•

find //æŸ¥æ‰¾å…ƒç´ 

find_if //æŒ‰æ¡ä»¶æŸ¥æ‰¾å…ƒç´ 

adjacent_find //æŸ¥æ‰¾ç›¸é‚»é‡å¤å…ƒç´ 

binary_search //äºŒåˆ†æŸ¥æ‰¾æ³•

count //ç»Ÿè®¡å…ƒç´ ä¸ªæ•°

count_if //æŒ‰æ¡ä»¶ç»Ÿè®¡å…ƒç´ ä¸ªæ•°



```c++
find (beg,end,elm)
    vector<int>::iterator it = find(v.begin(), v.end(), 5);
// æŒ‰å€¼æŸ¥æ‰¾å…ƒç´ ï¼Œæ‰¾åˆ°è¿”å›æŒ‡å®šä½ç½®è¿­ä»£å™¨ï¼Œæ‰¾ä¸åˆ°è¿”å›ç»“æŸè¿­ä»£å™¨ä½ç½®
// beg å¼€å§‹è¿­ä»£å™¨
// end ç»“æŸè¿­ä»£å™¨
// value æŸ¥æ‰¾çš„å…ƒç´     
```

```c++
find_if()  // åªè¿”å›ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ ä½ç½®ï¼ˆè¿­ä»£å™¨ï¼‰ã€‚
find_if(iterator beg, iterator end, _Pred);
// æŒ‰å€¼æŸ¥æ‰¾å…ƒç´ ï¼Œæ‰¾åˆ°è¿”å›æŒ‡å®šä½ç½®è¿­ä»£å™¨ï¼Œæ‰¾ä¸åˆ°è¿”å›ç»“æŸè¿­ä»£å™¨ä½ç½®
// beg å¼€å§‹è¿­ä»£å™¨
// end ç»“æŸè¿­ä»£å™¨
// _Pred å‡½æ•°æˆ–è€…è°“è¯ï¼ˆè¿”å›boolç±»å‹çš„ä»¿å‡½æ•°ï¼‰
```

```c++
count
count(iterator beg, iterator end, value);
// ç»Ÿè®¡å…ƒç´ å‡ºç°æ¬¡æ•°
// beg å¼€å§‹è¿­ä»£å™¨
// end ç»“æŸè¿­ä»£å™¨
// value ç»Ÿè®¡çš„å…ƒç´ 
```

```c++
count_if
count_if(iterator beg, iterator end, _Pred);
// æŒ‰æ¡ä»¶ç»Ÿè®¡å…ƒç´ å‡ºç°æ¬¡æ•°
// beg å¼€å§‹è¿­ä»£å™¨
// end ç»“æŸè¿­ä»£å™¨
// _Pred è°“è¯
```





##### 3.å¸¸ç”¨æ’åºç®—æ³•

sort //å¯¹å®¹å™¨å†…å…ƒç´ è¿›è¡Œæ’åº

random_shuffle //æ´—ç‰Œ æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ éšæœºè°ƒæ•´æ¬¡åº

merge // å®¹å™¨å…ƒç´ åˆå¹¶ï¼Œå¹¶å­˜å‚¨åˆ°å¦ä¸€å®¹å™¨ä¸­

reverse // åè½¬æŒ‡å®šèŒƒå›´çš„å…ƒç´ 



```c++
sort(iterator beg, iterator end, _Pred);
// æŒ‰å€¼æŸ¥æ‰¾å…ƒç´ ï¼Œæ‰¾åˆ°è¿”å›æŒ‡å®šä½ç½®è¿­ä»£å™¨ï¼Œæ‰¾ä¸åˆ°è¿”å›ç»“æŸè¿­ä»£å™¨ä½ç½®
// beg å¼€å§‹è¿­ä»£å™¨
// end ç»“æŸè¿­ä»£å™¨
// _Pred è°“è¯

```



```c++
merge
merge(iterator beg1, iterator end1, iterator beg2, iterator end2, iterator dest);
// å®¹å™¨å…ƒç´ åˆå¹¶ï¼Œå¹¶å­˜å‚¨åˆ°å¦ä¸€å®¹å™¨ä¸­
// æ³¨æ„: ä¸¤ä¸ªå®¹å™¨å¿…é¡»æ˜¯æœ‰åºçš„
// beg1 å®¹å™¨1å¼€å§‹è¿­ä»£å™¨ // end1 å®¹å™¨1ç»“æŸè¿­ä»£å™¨ // beg2 å®¹å™¨2å¼€å§‹è¿­ä»£å™¨ // end2 å®¹å™¨2ç»“æŸè¿­ä»£å™¨ //
dest ç›®æ ‡å®¹å™¨å¼€å§‹è¿­ä»£å™¨
```



```c++
reverse(iterator beg, iterator end);
// åè½¬æŒ‡å®šèŒƒå›´çš„å…ƒç´ 
// beg å¼€å§‹è¿­ä»£å™¨
// end ç»“æŸè¿­ä»£å™¨
```



##### 4.å¸¸ç”¨æ‹·è´å’Œæ›¿æ¢ç®—æ³•

copy // å®¹å™¨å†…æŒ‡å®šèŒƒå›´çš„å…ƒç´ æ‹·è´åˆ°å¦ä¸€å®¹å™¨ä¸­

replace // å°†å®¹å™¨å†…æŒ‡å®šèŒƒå›´çš„æ—§å…ƒç´ ä¿®æ”¹ä¸ºæ–°å…ƒç´ 

replace_if // å®¹å™¨å†…æŒ‡å®šèŒƒå›´æ»¡è¶³æ¡ä»¶çš„å…ƒç´ æ›¿æ¢ä¸ºæ–°å…ƒç´ 

swap // äº’æ¢ä¸¤ä¸ªå®¹å™¨çš„å…ƒç´ 

```c++
copy(iterator beg, iterator end, iterator dest);
// æŒ‰å€¼æŸ¥æ‰¾å…ƒç´ ï¼Œæ‰¾åˆ°è¿”å›æŒ‡å®šä½ç½®è¿­ä»£å™¨ï¼Œæ‰¾ä¸åˆ°è¿”å›ç»“æŸè¿­ä»£å™¨ä½ç½®
// beg å¼€å§‹è¿­ä»£å™¨
// end ç»“æŸè¿­ä»£å™¨
// dest ç›®æ ‡èµ·å§‹è¿­ä»£å™¨
```

```c++
replace(iterator beg, iterator end, oldvalue, newvalue);
// å°†åŒºé—´å†…æ—§å…ƒç´  æ›¿æ¢æˆ æ–°å…ƒç´ 
// beg å¼€å§‹è¿­ä»£å™¨
// end ç»“æŸè¿­ä»£å™¨
// oldvalue æ—§å…ƒç´ 
// newvalue æ–°å…ƒç´ 
```

```c++
replace_if(iterator beg, iterator end, _pred, newvalue);
// æŒ‰æ¡ä»¶æ›¿æ¢å…ƒç´ ï¼Œæ»¡è¶³æ¡ä»¶çš„æ›¿æ¢æˆæŒ‡å®šå…ƒç´ 
// beg å¼€å§‹è¿­ä»£å™¨
// end ç»“æŸè¿­ä»£å™¨
// _pred è°“è¯
// newvalue æ›¿æ¢çš„æ–°å…ƒç´ 
```

```c++
swap(container c1, container c2);
// äº’æ¢ä¸¤ä¸ªå®¹å™¨çš„å…ƒç´ 
// c1å®¹å™¨1
// c2å®¹å™¨2
```





##### 5. å¸¸ç”¨ç®—æœ¯ç”Ÿæˆç®—æ³• \#include <numeric>

**æ€»ç»“ï¼š**accumulateä½¿ç”¨æ—¶å¤´æ–‡ä»¶æ³¨æ„æ˜¯ numericï¼Œè¿™ä¸ªç®—æ³•å¾ˆå®ç”¨





accumulate // è®¡ç®—å®¹å™¨å…ƒç´ ç´¯è®¡æ€»å’Œ

fill // å‘å®¹å™¨ä¸­æ·»åŠ å…ƒç´ 

```c++
accumulate()
accumulate(iterator beg, iterator end, value);
// è®¡ç®—å®¹å™¨å…ƒç´ ç´¯è®¡æ€»å’Œ
// beg å¼€å§‹è¿­ä»£å™¨
// end ç»“æŸè¿­ä»£å™¨
// value èµ·å§‹å€¼
int total = accumulate(v.begin(), v.end(), 0);
```

```c++
fill(iterator beg, iterator end, value);
// å‘å®¹å™¨ä¸­å¡«å……å…ƒç´ 
// beg å¼€å§‹è¿­ä»£å™¨
// end ç»“æŸè¿­ä»£å™¨
// value å¡«å……çš„å€¼
```



##### 6. å¸¸ç”¨é›†åˆç®—æ³•



set_intersection // æ±‚ä¸¤ä¸ªå®¹å™¨çš„äº¤é›†

```c++

```

set_union // æ±‚ä¸¤ä¸ªå®¹å™¨çš„å¹¶é›†

set_difference // æ±‚ä¸¤ä¸ªå®¹å™¨çš„å·®é›†











##### 4.1 `sort()`

- **é€‚ç”¨å®¹å™¨**ï¼šä»…æ”¯æŒéšæœºè®¿é—®çš„å®¹å™¨ï¼Œå¦‚ `vector`ã€`deque`ã€`array`ã€‚
- **åŠŸèƒ½**ï¼šå¿«é€Ÿæ’åºã€‚

[å¤åˆ¶ä»£ç ](#)

```
bool func(``int` `a, ``int` `b) {``  ``return` `a > b; ``// é™åºæ’åˆ—``}``sort(vec.begin(), vec.end(), func); ``// å¯¹vectorè¿›è¡Œæ’åº
```

##### 4.2 `partial_sort()`

- **åŠŸèƒ½**ï¼šå¯¹éƒ¨åˆ†å…ƒç´ è¿›è¡Œæ’åºï¼Œä½¿ç”¨å †æ’åºå®ç°ã€‚
- **å‚æ•°**ï¼šæ’åºèŒƒå›´ï¼Œé»˜è®¤æ’åºå‰ `n` ä¸ªå…ƒç´ ã€‚

[å¤åˆ¶ä»£ç ](#)

```
int` `n = ``4``; ``// éœ€è¦æ’åºçš„å…ƒç´ ä¸ªæ•°``partial_sort(vec.begin(), vec.begin() + n, vec.end(), func); ``// æ’åºå‰4ä¸ªå…ƒç´ 
```

##### 4.3 `is_sorted()`

- **åŠŸèƒ½**ï¼šæ£€æŸ¥å®¹å™¨æ˜¯å¦å·²æ’åºã€‚
- **è¿”å›å€¼**ï¼šå¸ƒå°”å€¼ï¼Œ`true` è¡¨ç¤ºå·²æ’åºã€‚

[å¤åˆ¶ä»£ç ](#)

```
bool result = is_sorted(vec.begin(), vec.end(), func);
```

##### 4.4 `is_sorted_until()`

- **åŠŸèƒ½**ï¼šè¿”å›ç¬¬ä¸€ä¸ªç ´åæ’åºè§„åˆ™çš„å…ƒç´ ä½ç½®ã€‚

[å¤åˆ¶ä»£ç ](#)

```
auto it = is_sorted_until(vec.begin(), vec.end(), func);
```

#### 5. æŸ¥æ‰¾æ“ä½œ

##### 5.1 `find()`

- **åŠŸèƒ½**ï¼šæŸ¥æ‰¾æŒ‡å®šå…ƒç´ ã€‚

[å¤åˆ¶ä»£ç ](#)

```
vector<``int``> vec{``10``, ``20``, ``30``, ``40``, ``50``};``auto it = find(vec.begin(), vec.end(), ``30``); ``// æŸ¥æ‰¾30``if` `(it != vec.end()) {``  ``cout << ``"æŸ¥æ‰¾æˆåŠŸï¼š"` `<< *it;``} ``else` `{``  ``cout << ``"æŸ¥æ‰¾å¤±è´¥"``;``}
```

##### 5.2 `find_if()`

- **åŠŸèƒ½**ï¼šæ ¹æ®è‡ªå®šä¹‰è°“è¯æŸ¥æ‰¾å…ƒç´ ã€‚

[å¤åˆ¶ä»£ç ](#)

```
bool mycomp(``int` `i) {``  ``return` `(i % ``2``) == ``1``; ``// æŸ¥æ‰¾å¥‡æ•°``}``vector<``int``> myvector{``4``, ``2``, ``3``, ``1``, ``5``};``auto it = find_if(myvector.begin(), myvector.end(), mycomp);
```

#### 6. ä½¿ç”¨ `vector` é¿å…é¢‘ç¹çš„å†…å­˜é‡æ–°åˆ†é…

`vector` åœ¨æ‰©å®¹æ—¶é€šå¸¸ä¼šä»¥ 2 å€å®¹é‡å¢é•¿ï¼Œè¿™ä¼šå¯¼è‡´é¢‘ç¹çš„å†…å­˜åˆ†é…å’Œå…ƒç´ æ‹·è´ã€‚ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹ç­–ç•¥ï¼š

##### 6.1 é¢„åˆ†é…å†…å­˜

åœ¨åˆ›å»º `vector` æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `reserve()` æ–¹æ³•é¢„å…ˆåˆ†é…å†…å­˜ï¼Œä»¥å‡å°‘å¤šæ¬¡æ‰©å®¹ã€‚

##### 6.2 åˆç†é€‰æ‹©åˆå§‹å®¹é‡

æ ¹æ®æ•°æ®çš„é¢„è®¡å¤§å°é€‰æ‹©åˆé€‚çš„åˆå§‹å®¹é‡ï¼Œé¿å…ä¸å¿…è¦çš„æ‰©å®¹æ“ä½œã€‚

##### 6.3 ä¼˜åŒ–ç®—æ³•

ä½¿ç”¨æ—¶é—´å¤æ‚åº¦è¾ƒä½çš„ç®—æ³•ï¼Œé¿å…åœ¨æ•°æ®é‡å¢å¤§æ—¶é€ æˆæ€§èƒ½ç“¶é¢ˆã€‚

#### 7. `vector` çš„ `resize()` ä¸ `reserve()`

##### 7.1 `resize()`

- **åŠŸèƒ½**ï¼šè°ƒæ•´å®¹å™¨çš„å¤§å°ã€‚
- **æ•ˆæœ**ï¼šå¦‚æœ `n` å°äºå½“å‰å¤§å°ï¼Œåˆ™åˆ é™¤å°¾éƒ¨å…ƒç´ ï¼›å¦‚æœ `n` å¤§äºå½“å‰å¤§å°ï¼Œæ–°çš„å…ƒç´ ä¼šè¢«é»˜è®¤æ„é€ å¹¶æ·»åŠ åˆ°å°¾éƒ¨ã€‚

##### 7.2 `reserve()`

- **åŠŸèƒ½**ï¼šè°ƒæ•´å®¹å™¨çš„å®¹é‡ï¼Œä¸ä¼šæ”¹å˜å½“å‰å¤§å°ã€‚
- **æ•ˆæœ**ï¼šç”¨äºå‡å°‘æ‰©å®¹æ¬¡æ•°ï¼Œç¡®ä¿å®¹å™¨æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ã€‚

#### 8. `vector` æ‰©å®¹åŸç†

- **æ‰©å®¹è¿‡ç¨‹**ï¼šæ¯æ¬¡æ‰©å®¹æ—¶ï¼Œ`vector` ä¼šåˆ†é…æ–°çš„å†…å­˜å—å¹¶å°†ç°æœ‰å…ƒç´ å¤åˆ¶åˆ°æ–°å†…å­˜ä¸­ï¼Œæ—§å†…å­˜è¢«é‡Šæ”¾ã€‚
- **æ‰©å®¹ç³»æ•°**ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼Œ`vector` å®¹é‡æ¯æ¬¡ä¼šç¿»å€æˆ–å¢åŠ  1.5 å€ï¼Œè¿™å¯ä»¥å‡å°‘é¢‘ç¹çš„æ‰©å®¹ã€‚

##### 8.1 Linuxä¸­çš„å†…å­˜ç®¡ç†

åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå†…å­˜åŒºåŸŸä»¥2çš„å€æ•°æ‰©å®¹ï¼Œä»¥ä¾¿è¿›è¡Œé«˜æ•ˆçš„å†…å­˜åˆ†é…ã€‚

##### 8.2 Windowsä¸­çš„å†…å­˜ç®¡ç†

åœ¨Windowsç³»ç»Ÿä¸­ï¼Œå†…å­˜åˆ†é…é€šå¸¸ä¼šå¢åŠ 1.5å€ï¼Œä»¥ä¾¿æ›´å¥½åœ°åˆ©ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚

#### 9. è¿­ä»£å™¨

è¿­ä»£å™¨æ˜¯STLä¸­ç”¨äºè®¿é—®å®¹å™¨å…ƒç´ çš„ä¸€ç§æŠ½è±¡å·¥å…·ã€‚é€šè¿‡è¿­ä»£å™¨ï¼Œå®¹å™¨å…ƒç´ çš„è®¿é—®å…·æœ‰ä¸€è‡´çš„æ¥å£ï¼Œå¹¶ä¸”å¯ä»¥å®ç°å¤šæ€ã€‚

**æ³¨æ„**ï¼šè¿­ä»£å™¨åªèƒ½å‰è¿›ï¼Œä¸èƒ½å›é€€ã€‚

#### 10. è¿­ä»£å™¨å¤±æ•ˆçš„æƒ…å†µ

è¿­ä»£å™¨å¯èƒ½ä¼šå› ä¸ºå®¹å™¨ç»“æ„çš„ä¿®æ”¹è€Œå¤±æ•ˆã€‚ä¸åŒç±»å‹çš„å®¹å™¨å¤±æ•ˆçš„æƒ…å†µç•¥æœ‰ä¸åŒï¼š

- **æ•°ç»„å‹æ•°æ®ç»“æ„**ï¼ˆå¦‚ `vector`ï¼‰ï¼š`insert` å’Œ `erase` æ“ä½œä¼šä½¿æ’å…¥æˆ–åˆ é™¤ç‚¹ä¹‹åçš„æ‰€æœ‰è¿­ä»£å™¨å¤±æ•ˆã€‚
- **é“¾è¡¨å‹æ•°æ®ç»“æ„**ï¼ˆå¦‚ `list`ï¼‰ï¼š`erase` æ“ä½œåªä¼šä½¿æŒ‡å‘åˆ é™¤å…ƒç´ çš„è¿­ä»£å™¨å¤±æ•ˆï¼Œå…¶ä»–è¿­ä»£å™¨ä¸å—å½±å“ã€‚
- **æ ‘å‹æ•°æ®ç»“æ„**ï¼ˆå¦‚ `map`ï¼‰ï¼š`erase` æ“ä½œä¼šä½¿æŒ‡å‘åˆ é™¤å…ƒç´ çš„è¿­ä»£å™¨å¤±æ•ˆï¼Œå…¶ä»–è¿­ä»£å™¨ä¸å—å½±å“ã€‚ `insert` æ“ä½œä¸ä¼šä½¿ä»»ä½•è¿­ä»£å™¨å¤±æ•ˆã€‚



#### 4.2.1 vector listå¼‚åŒâ­â­â­â­â­

| é¡¹ç›®       | `vector`              | `list`ï¼ˆ`std::list`ï¼‰         |
| ---------- | --------------------- | ----------------------------- |
| åº•å±‚ç»“æ„   | è¿ç»­æ•°ç»„              | åŒå‘é“¾è¡¨                      |
| éšæœºè®¿é—®   | âœ… æ”¯æŒï¼ˆ`v[i]`ï¼‰      | âŒ ä¸æ”¯æŒ                      |
| æ’å…¥æ•ˆç‡   | âŒ ä¸­é—´æ’å…¥å¼€é”€å¤§      | âœ… ä»»æ„ä½ç½®æ’å…¥ O(1)           |
| åˆ é™¤æ•ˆç‡   | âŒ ä¸­é—´åˆ é™¤å¼€é”€å¤§      | âœ… ä»»æ„ä½ç½®åˆ é™¤ O(1)           |
| å†…å­˜å±€éƒ¨æ€§ | âœ… å¥½                  | âŒ å·®                          |
| ç©ºé—´å¼€é”€   | å°                    | å¤§ï¼ˆæ¯ä¸ªèŠ‚ç‚¹éœ€è¦ä¸¤ä¸ªæŒ‡é’ˆï¼‰    |
| è¿­ä»£å™¨å¤±æ•ˆ | æ’å…¥/åˆ é™¤å¯èƒ½å…¨éƒ¨å¤±æ•ˆ | æ’å…¥/åˆ é™¤ä¸ä¼šä½¿å…¶ä»–è¿­ä»£å™¨å¤±æ•ˆ |

#### 4.2.2 vectorå†…å­˜æ˜¯æ€ä¹ˆå¢é•¿çš„vectorçš„åº•å±‚å®ç°â­â­â­â­\

**åº•å±‚ç»“æ„**ï¼š`vector` ä½¿ç”¨ä¸€æ®µè¿ç»­å†…å­˜ `T* buffer` æ¥å­˜å‚¨æ•°æ®ã€‚

**å®¹é‡æ‰©å®¹æœºåˆ¶**ï¼š

- å½“ä½ æ’å…¥æ–°å…ƒç´ è¶…å‡ºå½“å‰å®¹é‡ï¼ˆ`capacity()`ï¼‰æ—¶ï¼Œä¼šè¿›è¡Œ**è‡ªåŠ¨æ‰©å®¹**ã€‚
- æ‰©å®¹ç­–ç•¥é€šå¸¸æ˜¯**2 å€å¢é•¿**ï¼ˆå®ç°ç»†èŠ‚å¯èƒ½å› ç¼–è¯‘å™¨è€Œå¼‚ï¼‰ã€‚
- æ‰©å®¹è¿‡ç¨‹åŒ…æ‹¬ï¼š
  1. åˆ†é…æ–°å†…å­˜ï¼ˆé€šå¸¸æ˜¯åŸå®¹é‡çš„ä¸¤å€ï¼‰ï¼›
  2. å°†æ—§å…ƒç´  `move` æˆ– `copy` åˆ°æ–°åœ°å€ï¼›
  3. é‡Šæ”¾æ—§å†…å­˜ã€‚

**æ³¨æ„**ï¼šæ‰©å®¹ä¼šå¯¼è‡´æŒ‡é’ˆã€å¼•ç”¨ã€è¿­ä»£å™¨**å…¨éƒ¨å¤±æ•ˆ**ï¼



#### 4.2.3 vectorå’Œdequeçš„æ¯”è¾ƒâ­â­â­â­

| ç‰¹æ€§         | `vector`                 | `deque`                  |
| ------------ | ------------------------ | ------------------------ |
| åº•å±‚ç»“æ„     | å•å—è¿ç»­æ•°ç»„             | åˆ†æ®µå†…å­˜æ•°ç»„ + ç´¢å¼•è¡¨    |
| éšæœºè®¿é—®     | âœ… å¿«é€Ÿï¼ˆ`O(1)`ï¼‰         | âœ… ä¹Ÿæ”¯æŒï¼Œä½†ç•¥æ…¢         |
| é¦–å°¾æ’å…¥æ•ˆç‡ | âŒ å¤´éƒ¨æ’å…¥æ…¢ï¼ˆO(n)ï¼‰     | âœ… å¤´å°¾æ’å…¥éƒ½æ˜¯ O(1)      |
| ä¸­é—´æ’å…¥     | âŒ æ…¢                     | âŒ ä»æ…¢                   |
| å†…å­˜ç»“æ„     | è¿ç»­å—                   | éè¿ç»­å—                 |
| é€‚åˆåœºæ™¯     | é‡è§†éšæœºè®¿é—®ã€å°¾éƒ¨æ“ä½œå¿« | éœ€è¦åŒç«¯æ’å…¥æˆ–åˆ é™¤çš„åœºæ™¯ |



#### 4.2.4ä¸ºä»€ä¹ˆstlé‡Œé¢æœ‰sortå‡½æ•°listé‡Œé¢è¿˜è¦å†å®šä¹‰ä¸€ä¸ªsortâ­â­â­

`std::sort()` åªèƒ½ä½œç”¨äº**éšæœºè®¿é—®è¿­ä»£å™¨**ï¼ˆå¦‚ `vector`, `deque`ï¼‰ã€‚

`list` çš„è¿­ä»£å™¨æ˜¯**åŒå‘è¿­ä»£å™¨**ï¼Œä¸æ”¯æŒ `it + n`ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨ `std::sort()`ã€‚

å› æ­¤ï¼Œ`std::list` æä¾›äº†æˆå‘˜å‡½æ•° `.sort()`ï¼Œä½¿ç”¨**å½’å¹¶æ’åº**ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º `O(n log n)`ï¼Œä¸éœ€è¦é¢å¤–å†…å­˜ï¼Œç¨³å®šæ’åºã€‚



#### 4.2.5 STLåº•å±‚æ•°æ®ç»“æ„å®ç°â­â­â­â­

| å®¹å™¨ | åº•å±‚å®ç°ç»“æ„ |
| ---- | ------------ |

| `vector` | åŠ¨æ€æ•°ç»„ï¼ˆè¿ç»­å†…å­˜ï¼‰ |
| -------- | -------------------- |

| `list` | åŒå‘é“¾è¡¨ |
| ------ | -------- |

| `deque` | æ®µå¼æ•°ç»„ + ä¸­å¤®æ§åˆ¶å— |
| ------- | --------------------- |

| `set/map` | å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆçº¢é»‘æ ‘ï¼‰ |
| --------- | ------------------------ |

| `unordered_*` | å“ˆå¸Œè¡¨ï¼ˆå¼€æ”¾åœ°å€æˆ–é“¾åœ°å€æ³•ï¼‰ |
| ------------- | ---------------------------- |

| `stack/queue` | é€šå¸¸æ˜¯åŸºäº `deque` å°è£… |
| ------------- | ----------------------- |

#### 4.2.6åˆ©ç”¨è¿­ä»£å™¨åˆ é™¤å…ƒç´ ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿâ­â­â­â­

ç¤ºä¾‹ï¼š

```
cppCopyEditfor (auto it = v.begin(); it != v.end(); ) {
    if (*it == val) it = v.erase(it);  // è¿”å›ä¸‹ä¸€ä¸ªæœ‰æ•ˆè¿­ä»£å™¨
    else ++it;
}
```

**æ­£ç¡®åšæ³•**ï¼šç”¨ `erase` çš„è¿”å›å€¼æ›´æ–°è¿­ä»£å™¨ï¼Œé˜²æ­¢å¤±æ•ˆã€‚

**ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ `++it`ï¼Ÿ**ï¼š`erase(it)` ä¼šè®©å½“å‰è¿­ä»£å™¨å¤±æ•ˆï¼Œç»§ç»­ä½¿ç”¨æ˜¯**æœªå®šä¹‰è¡Œä¸º**ã€‚

`list.erase(it)` åˆ é™¤å½“å‰å…ƒç´ ä¸ä¼šå½±å“å…¶ä»–è¿­ä»£å™¨ï¼Œ`vector.erase(it)` ä¼šè®©**ä¹‹åæ‰€æœ‰å…ƒç´ çš„è¿­ä»£å™¨å¤±æ•ˆ**ã€‚



#### 4.2.7 mapæ˜¯å¦‚ä½•å®ç°çš„ï¼ŒæŸ¥æ‰¾æ•ˆç‡æ˜¯å¤šå°‘â­â­â­â­â­



**åº•å±‚ç»“æ„**ï¼šçº¢é»‘æ ‘ï¼ˆself-balancing BSTï¼‰ã€‚

**ç‰¹ç‚¹**ï¼š

- è‡ªåŠ¨æŒ‰ key æ’åºï¼›
- æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾ï¼š**æ—¶é—´å¤æ‚åº¦ä¸º `O(log n)`**ï¼›
- æ¯ä¸ªèŠ‚ç‚¹åŒ…å« `<key, value>` å¯¹ï¼›
- éå†æ˜¯**æœ‰åºçš„**ã€‚

è‹¥ä¸éœ€è¦æœ‰åºè®¿é—®ï¼Œå¯ç”¨ `unordered_map`ï¼ˆå“ˆå¸Œè¡¨ï¼‰æŸ¥æ‰¾æ›´å¿«ï¼ˆå¹³å‡ `O(1)`ï¼Œæœ€å `O(n)`ï¼‰ã€‚



#### 4.2.8å‡ ç§æ¨¡æ¿æ’å…¥çš„æ—¶é—´å¤æ‚åº¦ â­â­â­â­â­

| å®¹å™¨            | æ’å…¥ä½ç½®  | æ—¶é—´å¤æ‚åº¦    | å¤‡æ³¨                    |
| --------------- | --------- | ------------- | ----------------------- |
| `vector`        | å°¾éƒ¨      | `O(1)` (æ‘Šè¿˜) | è‹¥è§¦å‘æ‰©å®¹åˆ™ä¸º `O(n)`   |
| `vector`        | ä¸­é—´/å¤´éƒ¨ | `O(n)`        | å…ƒç´ å³ç§»                |
| `list`          | ä»»æ„ä½ç½®  | `O(1)`        | ä¸åŒ…æ‹¬æŸ¥æ‰¾è¿­ä»£å™¨æ—¶é—´    |
| `deque`         | é¦–å°¾      | `O(1)`        | å†…éƒ¨åˆ†æ®µæ§åˆ¶            |
| `map/set`       | æ’å…¥      | `O(log n)`    | çº¢é»‘æ ‘ç»´æŒå¹³è¡¡          |
| `unordered_map` | æ’å…¥      | å¹³å‡ `O(1)`   | æœ€å `O(n)`ï¼ˆå“ˆå¸Œå†²çªï¼‰ |









### 16.C++å¤šçº¿ç¨‹æœºåˆ¶

#### 2. åˆ›å»ºçº¿ç¨‹

è·å¾—id

```c++
pthread_t pthread_self(void)
```

![image-20250716163210044](assets/image-20250716163210044.png)



![image-20250716163357652](assets/image-20250716163357652.png)

![image-20250716164651679](assets/image-20250716164651679.png)

![image-20250716163537373](assets/image-20250716163537373.png)

#### 3. çº¿ç¨‹é€€å‡ºï¼š

```c++
pthread_exit()//ä¸æ˜¯é‡Šæ”¾æ‹Ÿå†…å­˜ç©ºé—´
```

![image-20250716164744685](assets/image-20250716164744685.png)

```
//å¿åŸå›æ”¶

pthread_join()

```

![image-20250716165126121](assets/image-20250716165126121.png)





#### 4. joinï¼ˆï¼‰

#include<thread>

```c++
//åˆ›å»ºçº¿ç¨‹
void func(std::string str)
{
    std::cout<< <<endl;

}

int main()
{
	std::thread thread1(funcï¼Œâ€œdelloâ€);
	
	//ä¸»ç¨‹åºç­‰å¾…å­çº¿ç¨‹  å­ç°åœºè¿˜åœ¨è¿è¡Œå°±é˜»å¡ è¿è¡Œå®Œå›æ”¶
	thread1.join();
    //åˆ†ç¦»å­çº¿ç¨‹å’Œä¸»çº¿ç¨‹   detach()
    //thread1.detch()  //ä¸»çº¿ç¨‹ç»“æŸå   å­çº¿ç¨‹å¯ä»¥æŒç»­åœ¨åå°è¿è¡Œ
	

}
```



![image-20250716170733039](assets/image-20250716170733039.png)

```c++
//åˆ›å»ºçº¿ç¨‹
void func(std::string str)
{
    std::cout<< <<endl;

}

int main()
{
	std::thread thread1(funcï¼Œâ€œdelloâ€);
	
	//ä¸»ç¨‹åºç­‰å¾…å­çº¿ç¨‹  å­ç°åœºè¿˜åœ¨è¿è¡Œå°±é˜»å¡ è¿è¡Œå®Œå›æ”¶
	thread1.join();
    //åˆ†ç¦»å­çº¿ç¨‹å’Œä¸»çº¿ç¨‹   detach()
    //thread1.detch()  //ä¸»çº¿ç¨‹ç»“æŸå   å­çº¿ç¨‹å¯ä»¥æŒç»­åœ¨åå°è¿è¡Œ  ä¸€èˆ¬ä¸ä¼šä½¿ç”¨
	

}
```

#### 5. joinable

```c++
//åˆ›å»ºçº¿ç¨‹
void func(std::string str)
{
    std::cout<< <<endl;
	return ;
}

int main()
{
	std::thread thread1(funcï¼Œâ€œdelloâ€);
	
	//å…ˆåˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨joinable() 
	bool ret=thread1.joinable();
	if(ret)
    {
		thread1.join(); //æ˜¯é˜»å¡çš„  ä¸ä¼šä»»åŠ¡åˆ‡æ¢
    	}
	

}
```

![image-20250716171307601](assets/image-20250716171307601.png)



#### 6. äº’æ–¥é”  m

![image-20250716172216915](assets/image-20250716172216915.png)



#### 7. lock_guard(); 



lock_guard();  

```c++
åªæœ‰è‡ªåŠ¨åŠ é”      è‡ªåŠ¨è§£é”
```



æ„é€ å‡½æ•°è¢«è°ƒç”¨æ—¶ è¯¥äº’æ–¥é‡ä¼šè‡ªåŠ¨è¢«é”å®šï¼Œ

å½“ææ„å‡½æ•°è¢«è°ƒç”¨æ˜¯ï¼Œè¯¥äº’æ–¥é‡ä¼šè¢«è‡ªåŠ¨è§£é”

std::lock_guardå¯¹è±¡ä¸èƒ½å¤åˆ¶æˆ–ç§»åŠ¨ï¼Œå› æ­¤ä»–åªèƒ½åœ¨å±€éƒ¨ä½œç”¨åŸŸä¸­ä½¿ç”¨ã€‚

```c++
std::lock_guard<std::mutex> lg(mtx)
    //mu.lock()
    //mu.unlock()
```

å…·ä½“åˆ†æå¦‚ä¸‹ï¼š

```c++
cppCopyEditfor (int i = 0; i < 10000; i++) {
    std::lock_guard<std::mutex> lg(mtx);  // æ¯æ¬¡å¾ªç¯éƒ½ä¼šæ„é€ ä¸€ä¸ª lock_guard
    shared_data++;
}
```

- è¿™è¡Œå®šä¹‰çš„ `lg` æ˜¯ä¸€ä¸ª**å±€éƒ¨å˜é‡**ï¼Œå…¶**ç”Ÿå‘½å‘¨æœŸä»å£°æ˜ä½ç½®å¼€å§‹ï¼Œåˆ°æ‰€åœ¨çš„ä½œç”¨åŸŸæœ«å°¾ä¸ºæ­¢**ï¼›
- åœ¨è¿™é‡Œï¼Œ`lg` çš„ä½œç”¨åŸŸæ˜¯ `for` å¾ªç¯çš„èŠ±æ‹¬å· `{}`ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡è¿­ä»£æ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åè‡ªåŠ¨ææ„ï¼Œ**è‡ªåŠ¨é‡Šæ”¾é”**ï¼›
- æ¢å¥è¯è¯´ï¼š**æ¯æ¬¡ `for` å¾ªç¯è¿­ä»£éƒ½ä¼šåŠ é”ã€æ‰§è¡Œ `shared_data++`ã€ç„¶åè‡ªåŠ¨è§£é”**ã€‚



![image-20250716172913027](assets/image-20250716172913027.png) 

![image-20250716173050730](assets/image-20250716173050730.png)



#### 8. ğŸ”unique_lock(); 

```c++
äº’æ–¥é‡å°è£…ç±»ï¼š ä¸»è¦ç‰¹ç‚¹æ˜¯å¯ä»¥å¯¹äº’æ–¥é‡è¿›è¡Œæ›´åŠ é›¶èŠ±çš„ç®¡ç†ï¼ŒåŒ…æ‹¬å»¶è¿ŸåŠ é”ã€æ¡ä»¶å˜é‡ã€è¶…æ—¶ç­‰
```

```c++
for (int i = 0; i < 10000; i++) {
    std::unique_lock<std::mutex> lg(mtx); //æ·é”çš„æ—¶å€™å¯èƒ½ä¼šé˜»å¡  å¯ä»¥è®¾ç½®è¶…æ—¶
    //lg.lock()  lg(mtx,defer_lock)
    // lg.try_lock_for(std::chrono::secounds(5))è¶…æ—¶æ—¶é—´5Sé’Ÿ  æˆ‘åªç­‰å¾…ä¸€æ®µæ—¶é—´ è¶…æ—¶å°±è¿”å›
    //try_lock_untile()ä¼ ä¸€ä¸ªæ—¶é—´ç‚¹  ä¸å¸¸ç”¨
    shared_data++;
}
```





![image-20250716194802283](assets/image-20250716194802283.png)

#### 9. ğŸ”  call_onceä¸å…¶ä½¿ç”¨åœºæ™¯ï¼ˆåªèƒ½åœ¨çº¿ç¨‹é‡Œé¢ä½¿ç”¨ï¼‰

æ˜¯C++11æ ‡å‡†åº“ä¸­çš„ä»¥å“¦ä¸ªå‡½æ•°ï¼Œç”¨äºç¡®ä¿æŸä¸ªå‡½æ•°åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œ

ä¸€ä¸ªç±»  å…¨å±€åªéœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡å°±å¯ä»¥äº†ï¼Œä¸å¦‚æ—¥å¿—ï¼›-ã€‹å•ä¾‹æ¨¡å¼

```c++
//ç¦ç”¨æ‹·è´æ„é€ å’Œç­‰äºå·
Class Log
{
public:
Log(const Log&log)=delet
   Log  &operator =(const Log&log)=delet

    static log& GetInstance()
{
    //Static Log log;//å…¨å±€é™æ€log
    
    std::call_once(once,init)//ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªè°ƒç”¨
    return log
}

    static void init()
    {
        if(!log)log=newLog;
    }
    
    private:
    static std::once_flage once;c  
}



```



![image-20250716200940932](assets/image-20250716200940932.png)

å•ä¾‹æ¨¡å¼ å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨åŒä¸€ä¸ªå…¨å±€å‡½æ•°  åŒä¸€ä¸ªé‡Œé¢çš„å˜é‡ï¼Œå¯èƒ½ä¼šæœ‰å¤šæ¬¡åˆ›å»ºï¼Œ



![image-20250716201123208](assets/image-20250716201123208.png)

![image-20250716201624345](assets/image-20250716201624345.png)





âœ…   call_onceä¸äº’æ–¥é”çš„åŒºåˆ«

âœ… ä¸€å¥è¯åŒºåˆ«ï¼š

> `std::mutex` ç”¨æ¥**ä¿æŠ¤ä¸€æ®µä»£ç å—åœ¨å¤šä¸ªçº¿ç¨‹ä¸­äº’æ–¥æ‰§è¡Œ**ï¼Œè€Œ
>  `std::call_once` ç”¨æ¥**ç¡®ä¿æŸä¸ªå‡½æ•°åªè¢«æ‰§è¡Œä¸€æ¬¡**ï¼ˆé€šå¸¸ç”¨äºçº¿ç¨‹å®‰å…¨çš„**ä¸€æ¬¡æ€§åˆå§‹åŒ–**ï¼‰ã€‚

ğŸ§© è¯¦ç»†å¯¹æ¯”ï¼šcall_once vs mutex

| æ¯”è¾ƒé¡¹       | `std::mutex`                           | `std::call_once`                       |
| ------------ | -------------------------------------- | -------------------------------------- |
| âœ… åŠŸèƒ½       | å¤šçº¿ç¨‹äº’æ–¥æ‰§è¡ŒæŸæ®µä»£ç                  | å¤šçº¿ç¨‹ä¸‹**åªæ‰§è¡Œä¸€æ¬¡**æŸæ®µä»£ç          |
| âœ… ä½¿ç”¨æ–¹å¼   | åŠ é”ã€è§£é”ï¼ˆæ¨èç”¨ `std::lock_guard`ï¼‰ | é…åˆ `std::once_flag` ä½¿ç”¨             |
| âœ… è°ƒç”¨æ¬¡æ•°   | æ¯æ¬¡éƒ½å¯ä»¥åŠ é”                         | æ— è®ºå¤šå°‘çº¿ç¨‹è°ƒç”¨ï¼ŒæŒ‡å®šå‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ |
| âœ… é€‚ç”¨åœºæ™¯   | å¤šçº¿ç¨‹ä¿æŠ¤å…±äº«èµ„æºï¼ˆå¦‚è¯»å†™å˜é‡ï¼‰       | å•ä¾‹æ¨¡å¼ã€å»¶è¿Ÿåˆå§‹åŒ–ã€å…¨å±€å˜é‡åˆå§‹åŒ–   |
| âœ… æ€§èƒ½å¼€é”€   | ç›¸å¯¹è¾ƒå¤§ï¼ˆæ¯æ¬¡éƒ½è¦åŠ é”ï¼‰               | æ›´è½»é‡ï¼Œä»…æ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åçº¿ç¨‹ç›´æ¥è·³è¿‡   |
| âœ… çº¿ç¨‹å®‰å…¨æ€§ | éœ€è¦æ­£ç¡®ç®¡ç†é”ï¼ˆå¯èƒ½æ­»é”ï¼‰             | è‡ªåŠ¨çº¿ç¨‹å®‰å…¨                           |
| âœ… ä»£ç ç¤ºä¾‹   | `lock_guard<mutex> lock(mtx);`         | `call_once(flag, init_func);`          |

ğŸ“Œ ç¤ºä¾‹ä»£ç å¯¹æ¯”ï¼š

ğŸ”¹ `std::mutex` ç¤ºä¾‹ï¼šä¿æŠ¤èµ„æº

```
cppCopyEditstd::mutex mtx;
int shared_data = 0;

void add() {
    std::lock_guard<std::mutex> lock(mtx);
    shared_data++;  // æ‰€æœ‰çº¿ç¨‹éƒ½æ‰§è¡Œï¼Œä½†äº’æ–¥
}
```

ğŸ”¹ `std::call_once` ç¤ºä¾‹ï¼šåªæ‰§è¡Œä¸€æ¬¡åŒ–

```
cppCopyEditstd::once_flag flag;
int config = 0;

void init() {
    config = 42;  // åªåˆå§‹åŒ–ä¸€æ¬¡
}

void load() {
    std::call_once(flag, init);  // å¤šçº¿ç¨‹è°ƒç”¨ä½† init åªæ‰§è¡Œä¸€æ¬¡
}
```

âš ï¸ æ³¨æ„äº‹é¡¹

- `std::call_once` å¸¸ç”¨äºå•ä¾‹æ¨¡å¼ã€æ‡’æ±‰å¼åˆå§‹åŒ–ï¼š

  ```
  cppCopyEditstatic MySingleton& getInstance() {
      static std::once_flag flag;
      static MySingleton* instance = nullptr;
      std::call_once(flag, []() {
          instance = new MySingleton();
      });
      return *instance;
  }
  ```

- ä¸è¦ç”¨ `mutex` æ¥ä»£æ›¿ `call_once` å®ç°â€œåªæ‰§è¡Œä¸€æ¬¡â€ï¼Œä¼šå¯¼è‡´å¤šçº¿ç¨‹ä¸‹æ€§èƒ½ä½ã€é€»è¾‘å¤æ‚ã€ç”šè‡³æ­»é”ã€‚

âœ… æ€»ç»“

| ä½ æƒ³è¦çš„åŠŸèƒ½                               | ç”¨ä»€ä¹ˆï¼Ÿ      |
| ------------------------------------------ | ------------- |
| å¤šçº¿ç¨‹éƒ½èƒ½æ‰§è¡Œï¼Œä½†ä¸èƒ½åŒæ—¶æ‰§è¡ŒåŒä¸€æ®µä»£ç    | âœ… `mutex`     |
| å¤šçº¿ç¨‹åªå…è®¸æœ‰ä¸€ä¸ªæ‰§è¡Œä¸€æ¬¡ï¼ˆä¸€æ¬¡æ€§åˆå§‹åŒ–ï¼‰ | âœ… `call_once` |

####  10 . condiation_var æ¡ä»¶å˜é‡  ï¼ˆç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼‰

æœ‰ç‚¹åƒpollå”¤é†’æœºåˆ¶ï¼ˆ ç”Ÿäº§è€…å”¤é†’æ¶ˆè´¹è€…æ‰§è¡Œï¼‰

æ˜¯çš„ï¼Œ**`std::condition_variable` åœ¨ `wait(lock)` æ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾é”å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€**ï¼Œè¿™æ­£æ˜¯å®ƒçš„æ ¸å¿ƒæœºåˆ¶ã€‚

```c++
condition_variable
mutex
//åœ¨éœ€è¦ç­‰å¾…æ¡ä»¶å˜é‡çš„åœ°æ–¹
 unique_lock()
condition_variable::wait()//é˜»å¡
condition_variable::wait_for()
condition_variable::wait_until()
    
//åœ¨å…¶ä»–çº¿ç¨‹ä¸­éœ€è¦é€šçŸ¥ç­‰å¾…çš„çº¿ç¨‹ç¯å½¢   
condation_variable::notify_onec;
condation_variable::notify_all();

```



```c++
condition_variable::wait(lock,true/false)//é˜»å¡   true ä¸é˜»å¡   falseé˜»å¡ç­‰å¾…
```

  ![image-20250716204619204](assets/image-20250716204619204.png)









![image-20250716204122305](assets/image-20250716204122305.png)

![image-20250716203712036](assets/image-20250716203712036.png)

std::condition_variable cv;
std::mutex mtx;

std::unique_lock<std::mutex> lock(mtx);
cv.wait(lock);  // âœ… è‡ªåŠ¨é‡Šæ”¾é”ï¼Œç­‰å¾…æ¡ä»¶è¢«å”¤é†’åå†è‡ªåŠ¨é‡æ–°åŠ é”

```c++
std::mutex mtx;
std::condition_variable cv;
bool ready = false;

void worker() {
    std::unique_lock<std::mutex> lock(mtx);
    cv.wait(lock, [] { return ready; });  // è‡ªåŠ¨é‡Šæ”¾é”å¹¶ç­‰å¾…
    std::cout << "Worker proceeds!\n";
}

void notifier() {
    std::this_thread::sleep_for(std::chrono::seconds(1));
    {
        std::lock_guard<std::mutex> lock(mtx);
        ready = true;
    }
    cv.notify_one();  // å”¤é†’ worker
}

```

![image-20250716210707517](assets/image-20250716210707517.png)



âœ… **é—®é¢˜ 1ï¼šä¸ºä»€ä¹ˆ `for` å¾ªç¯é‡Œè¿˜æœ‰ä¸€å¯¹ `{}`ï¼Ÿ**

è¿™å¯¹èŠ±æ‹¬å·çš„ä½œç”¨æ˜¯ï¼š

> **é™å®š `std::unique_lock<std::mutex> lock(mtx);` çš„ä½œç”¨åŸŸ**ã€‚

ğŸ” åŸå› ï¼š

- `unique_lock` æ˜¯ RAII é£æ ¼çš„é”ï¼šè¿›å…¥ä½œç”¨åŸŸæ—¶åŠ é”ï¼Œç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨è§£é”ã€‚
- æ‰€ä»¥è¿™å¯¹ `{}` ä¿è¯ï¼š
  - `queue.push(i)` å’Œ `cv.notify_one()` æ—¶ï¼Œé”æ˜¯æŒæœ‰çŠ¶æ€ï¼›
  - ä¸€æ—¦ `{}` ç»“æŸï¼Œ`lock` è¢«ææ„ï¼Œ**è‡ªåŠ¨é‡Šæ”¾äº’æ–¥é”**ï¼›
  - ç„¶åå† `sleep_for(...)`ï¼Œæ­¤æ—¶é”å·²ç»é‡Šæ”¾ï¼Œæ–¹ä¾¿å…¶ä»–çº¿ç¨‹è¿è¡Œã€‚

âœ…é—®é¢˜ 2ï¼š`g_cv.notify_one()` æ˜¯ç«‹å³å”¤é†’ç­‰å¾…çº¿ç¨‹å—ï¼Ÿ**

**ä¸æ˜¯ç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ç«‹å³é€šçŸ¥**ï¼Œè¢«é€šçŸ¥çš„çº¿ç¨‹éœ€è¦**ç­‰å¾…é”é‡Šæ”¾å**æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚

ğŸ” æ‰§è¡Œæµç¨‹ç®€å›¾ï¼š

1. `Producer` çº¿ç¨‹æ‰§è¡Œåˆ° `notify_one()`ï¼Œå‘å‡ºâ€œæœ‰æ–°æ•°æ®å•¦â€çš„ä¿¡å·ï¼›
2. **æ­¤æ—¶é”è¿˜æ²¡é‡Šæ”¾**ï¼ˆè¿˜åœ¨èŠ±æ‹¬å· `{}` å†…ï¼‰ï¼›
3. ç­‰åˆ°é”éšç€ `lock` ç¦»å¼€ä½œç”¨åŸŸè¢«é‡Šæ”¾ï¼›
4. è¢«å”¤é†’çš„æ¶ˆè´¹è€…çº¿ç¨‹å°è¯•è·å¾—é”ï¼ˆæˆåŠŸåï¼‰ï¼›
5. æ‰çœŸæ­£è¿›å…¥ç»§ç»­æ‰§è¡Œï¼ˆå¦‚ `wait()` åé¢çš„é€»è¾‘ï¼‰ã€‚







notify_once()  ğŸ”§ å‘ç”Ÿäº†ä»€ä¹ˆï¼ˆåº•å±‚æµç¨‹ï¼‰ï¼š

å½“ä½ è°ƒç”¨ï¼š

```
cpp


CopyEdit
cv.notify_one();
```

èƒŒåå¤§è‡´ä¼šå‘ç”Ÿä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

1. **æ¡ä»¶å˜é‡æ£€æŸ¥æ˜¯å¦æœ‰çº¿ç¨‹åœ¨ wait() ä¸Šé˜»å¡**ï¼›
2. å¦‚æœæœ‰ï¼Œ**å”¤é†’å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹**ï¼ˆæ˜¯å“ªä¸ªçº¿ç¨‹ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦å†³å®šï¼‰ï¼›
3. è¢«å”¤é†’çš„çº¿ç¨‹ä¼šå°è¯•é‡æ–°**è·å–ä¸ `wait()` å…³è”çš„äº’æ–¥é”**ï¼›
4. å¦‚æœè·å–åˆ°é”ï¼Œçº¿ç¨‹ç»§ç»­æ‰§è¡Œ `wait()` ä¹‹åçš„ä»£ç ï¼›
5. å¦‚æœé”è¿˜è¢«åˆ«äººå ç€ï¼Œå®ƒä¼šç»§ç»­ç­‰å¾…é”é‡Šæ”¾ã€‚

#### 11.  è·¨å¹³å°çº¿ç¨‹æ±   ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹



![image-20250716212712666](assets/image-20250716212712666.png)

 emplace_back() åœ¨åŸåœ°ç›´æ¥æ„é€ ä¸€ä¸ªæ–°å˜é‡ï¼Œä¸ä¼šè¿›è¡Œ      push_back()->è¿›è¡Œæ‹·è´æ„é€ 

 

è¿™æ˜¯ä¸€ä¸ªéå¸¸ä¸“ä¸šçš„é—®é¢˜ï¼Œ**åœ¨å®ç°çº¿ç¨‹æ± æ—¶**ï¼Œä½ åˆ°åº•åº”è¯¥ç”¨ `emplace_back()` è¿˜æ˜¯ `push_back()`ï¼Œè¦çœ‹ä½ å¦‚ä½•åˆ›å»ºçº¿ç¨‹å¯¹è±¡çš„ â€”â€” **ä¸¤è€…éƒ½å¯ä»¥ç”¨ï¼Œä½†æ¨è `emplace_back()`ï¼Œæ›´é«˜æ•ˆä¹Ÿæ›´è‡ªç„¶**ã€‚

âœ… å…ˆè¯´ç»“è®ºï¼š

> åœ¨çº¿ç¨‹æ± ä¸­æ·»åŠ çº¿ç¨‹å¯¹è±¡æ—¶ï¼Œä¸€èˆ¬ä½¿ç”¨ `std::vector<std::thread>::emplace_back(...)`ï¼Œå› ä¸ºå®ƒï¼š
>
> - **ç›´æ¥åœ¨å®¹å™¨å†…éƒ¨åŸåœ°æ„é€ çº¿ç¨‹å¯¹è±¡**ï¼›
> - é¿å…äº†ä¸å¿…è¦çš„ä¸´æ—¶å¯¹è±¡æ‹·è´æˆ–ç§»åŠ¨ï¼›
> - æ›´ç¬¦åˆ C++11 çš„æ¨èå†™æ³•ã€‚

âœ… è¯¦ç»†è§£é‡Šï¼š`emplace_back` vs `push_back`

| æ–¹æ³•              | ç”¨æ³•                                       | æ˜¯å¦æ¨èåœ¨çº¿ç¨‹æ± ä¸­ç”¨    |
| ----------------- | ------------------------------------------ | ----------------------- |
| `push_back(t)`    | ä½ **å…ˆåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡**ï¼Œå†ä¼ è¿›å»         | âš ï¸ é¢å¤–æ„é€ +ç§»åŠ¨ï¼Œä¸æ¨è |
| `emplace_back(f)` | ä½ ç›´æ¥æŠŠæ„é€ çº¿ç¨‹éœ€è¦çš„å‚æ•°ä¼ è¿›å»ï¼ˆå¦‚å‡½æ•°ï¼‰ | âœ… æ¨èï¼Œé«˜æ•ˆåŸåœ°æ„é€     |

`std::queue<T>` çš„ `front()` è¿”å›çš„æ˜¯ **å·¦å€¼å¼•ç”¨ï¼ˆlvalue referenceï¼‰**ï¼Œä¹Ÿå°±æ˜¯ï¼š

```
cppCopyEditT& front();
const T& front() const;
```

âœ… æ‰€ä»¥ç­”æ¡ˆæ˜¯ï¼š**å·¦å€¼**

![image-20250716215118142](assets/image-20250716215118142.png)



```c++
#include <vector>    // ç”¨äºå­˜å‚¨çº¿ç¨‹
#include <thread>    // çº¿ç¨‹ç›¸å…³åŠŸèƒ½
#include <queue>     // ä»»åŠ¡é˜Ÿåˆ—
#include <functional> // å‡½æ•°å¯¹è±¡
#include <mutex>     // äº’æ–¥é”
#include <condition_variable> // æ¡ä»¶å˜é‡

class ThreadPool {
public:
    // æ„é€ å‡½æ•°ï¼Œåˆ›å»ºæŒ‡å®šæ•°é‡çš„å·¥ä½œçº¿ç¨‹
    ThreadPool(size_t numThreads) : stop(false) {  // stopæ ‡å¿—åˆå§‹åŒ–ä¸ºfalse
        for (size_t i = 0; i < numThreads; ++i) {  // åˆ›å»ºnumThreadsä¸ªçº¿ç¨‹
            threads.emplace_back([this] {  // æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œä»¥ä¸‹lambdaå‡½æ•°
                while (true) {  // çº¿ç¨‹æŒç»­å·¥ä½œ
                    std::function<void()> task;  // ç”¨äºå­˜å‚¨ä»é˜Ÿåˆ—å–å‡ºçš„ä»»åŠ¡

                    {  // åŠ é”åŒºåŸŸå¼€å§‹
                        std::unique_lock<std::mutex> lock(mtx);  // è·å–äº’æ–¥é”
                        
                        // ç­‰å¾…æ¡ä»¶å˜é‡é€šçŸ¥ï¼Œå½“ä»»åŠ¡é˜Ÿåˆ—ä¸ä¸ºç©ºæˆ–çº¿ç¨‹æ± åœæ­¢æ—¶ç»§ç»­
                        condition.wait(lock, [this] {
                            return !tasks.empty() || stop;
                        });

                        // å¦‚æœçº¿ç¨‹æ± å·²åœæ­¢ä¸”ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™çº¿ç¨‹é€€å‡º
                        if (stop && tasks.empty()) {
                            return;
                        }

                        // ä»ä»»åŠ¡é˜Ÿåˆ—å–å‡ºç¬¬ä¸€ä¸ªä»»åŠ¡
                        task = std::move(tasks.front());
                        tasks.pop();
                    }  // åŠ é”åŒºåŸŸç»“æŸï¼Œè‡ªåŠ¨é‡Šæ”¾é”

                    task();  // æ‰§è¡Œä»»åŠ¡
                }
            });
        }
    }

    // ææ„å‡½æ•°ï¼Œåœæ­¢æ‰€æœ‰çº¿ç¨‹
    ~ThreadPool() {
        {  // åŠ é”åŒºåŸŸå¼€å§‹
            std::unique_lock<std::mutex> lock(mtx);
            stop = true;  // è®¾ç½®åœæ­¢æ ‡å¿—
        }  // åŠ é”åŒºåŸŸç»“æŸï¼Œè‡ªåŠ¨é‡Šæ”¾é”
        
        condition.notify_all();  // é€šçŸ¥æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹
        
        // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
        for (auto& thread : threads) {
            thread.join();  // ç­‰å¾…çº¿ç¨‹ç»“æŸ
        }
    }

    // å‘çº¿ç¨‹æ± æ·»åŠ ä»»åŠ¡
    template<class F, class... Args>
    void enqueue(F&& f, Args&&... args) {
        // ä½¿ç”¨bindå°†å‡½æ•°å’Œå‚æ•°ç»‘å®šä¸ºä¸€ä¸ªæ— å‚å‡½æ•°å¯¹è±¡
        std::function<void()> task = std::bind(std::forward<F>(f), std::forward<Args>(args)...);
        
        {  // åŠ é”åŒºåŸŸå¼€å§‹
            std::unique_lock<std::mutex> lock(mtx);
            tasks.emplace(std::move(task));  // å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—
        }  // åŠ é”åŒºåŸŸç»“æŸï¼Œè‡ªåŠ¨é‡Šæ”¾é”
        
        condition.notify_one();  // é€šçŸ¥ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹æœ‰æ–°ä»»åŠ¡
    }

private:
    std::vector<std::thread> threads;  // å­˜å‚¨å·¥ä½œçº¿ç¨‹
    std::queue<std::function<void()>> tasks;  // ä»»åŠ¡é˜Ÿåˆ—
    std::mutex mtx;  // ä¿æŠ¤ä»»åŠ¡é˜Ÿåˆ—çš„äº’æ–¥é”
    std::condition_variable condition;  // ç”¨äºçº¿ç¨‹é—´é€šä¿¡çš„æ¡ä»¶å˜é‡
    bool stop;  // çº¿ç¨‹æ± åœæ­¢æ ‡å¿—
};




```





ç”¨å•ä¾‹æ¨¡å¼å’Œæ™ºèƒ½æŒ‡é’ˆå®ç°çš„çº¿ç¨‹æ± 

ä¸‹é¢æˆ‘å°†å®ç°ä¸€ä¸ªä½¿ç”¨å•ä¾‹æ¨¡å¼ã€æ™ºèƒ½æŒ‡é’ˆå’Œcall_onceçš„çº¿ç¨‹æ± ï¼Œå¹¶é€è¡Œè§£é‡Šä»£ç ï¼Œæœ€åç»™å‡ºmainå‡½æ•°çš„ä½¿ç”¨ç¤ºä¾‹ã€‚



```c++

#include <iostream>
#include <thread>  
#include <functional>  //å‡½æ•°æ¨¡æ¿  bind
#include <vector>
#include <queue>
#include <mutex>
#include <condition_variable>
#include <memory>  //unique_ptr shared_ptr
#include <chrono>  //æ—¶é—´   
using namespace std;
//æ‰‹æ’•çº¿ç¨‹æ±    
/*
ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹    
çº¿ç¨‹æ± æœ‰å¤šä¸ªåˆ›å»ºçš„çº¿ç¨‹  ç­‰å¾…ä»»åŠ¡é˜Ÿåˆ—é‡Œæœ‰ä»»åŠ¡å°±å»æ‰§è¡Œï¼Œè¿™ä¸ªæœ‰è°æ‰§è¡Œæ˜¯ä¸ç¡®å®šçš„ 
ç”Ÿäº§è€…è´Ÿè´£å‘ä»»åŠ¡é˜Ÿåˆ—é‡Œæ·»åŠ ä»»åŠ¡ï¼Œæ¶ˆè´¹è€…è´Ÿè´£ä»ä»»åŠ¡é˜Ÿåˆ—é‡Œå–ä»»åŠ¡æ‰§è¡Œ


çº¿ç¨‹æ± æ˜¯å…¨å±€å”¯ä¸€ä¸€ä¸ªunique_ptr    åªåˆå§‹åŒ–ä¸€æ¬¡once_call();ï¼Œåç»­è°ƒç”¨ä»ç„¶è¿˜æ˜¯åŒä¸€ä¸ªçº¿ç¨‹æ±  ï¼Œæ‰€ä»¥éœ€è¦ç”¨å•ä¾‹æ¨¡å¼  
*/


class ThreadPool { 
public:
    //é¦–å…ˆ  åˆ›å»ºå•ä¾‹æ¨¡å¼  ï¼ˆåœ¨å•ä¾‹æ¨¡å¼ä¸­åˆ›å»ºçº¿ç¨‹æ±  ä¿éšœåªåˆå§‹åŒ–ä¸€æ¬¡  è¿”å›åˆ›å»ºçš„çº¿ç¨‹æ± å¯¹è±¡æŒ‡é’ˆï¼‰
    // è·å–çº¿ç¨‹æ± å•ä¾‹å¯¹è±¡ï¼ˆæ‡’æ±‰å¼å•ä¾‹ï¼Œçº¿ç¨‹å®‰å…¨ï¼‰
    static ThreadPool& getInstance(size_t number_thread=4)  //staticä¿è¯å¤–éƒ¨mainå¯ä»¥è°ƒç”¨
    {
        static once_flag flag;  //once_flagæ˜¯ä¸€ä¸ªæ ‡å¿—ä½ï¼Œè¡¨ç¤ºæ˜¯å¦å·²ç»æ‰§è¡Œè¿‡æŸä¸ªæ“ä½œ
        static unique_ptr<ThreadPool> instance;  //åˆ›å»ºä¸€ä¸ªç©ºçš„  ä½¿ç”¨unique_ptrç®¡ç†ThreadPoolçš„ç”Ÿå‘½å‘¨æœŸ

        call_once(flag,[number_thread](){
            instance.reset(new ThreadPool(number_thread));  //åˆ›å»ºçº¿ç¨‹æ± å®ä¾‹ é‡Šæ”¾å½“å‰å¯¹è±¡å¹¶ç®¡ç†æ–°çš„å¯¹è±¡

        });
        return *instance;  //è¿”å›çº¿ç¨‹æ± å®ä¾‹çš„å¼•ç”¨
    }

    //ç¦ç”¨æ‹·è´æ„é€ 
    ThreadPool(const ThreadPool& )=delete;
    //ç¦ç”¨èµ‹å€¼æ„é€ 
    ThreadPool& operator=(const ThreadPool& )=delete;


    
    //ææ„å‡½æ•°
    ~ThreadPool()
    {
        {
            unique_lock<mutex> lock(m_mutex);
            stop = true;  //è®¾ç½®åœæ­¢æ ‡å¿—
        }

        cond.notify_all();  //é€šçŸ¥æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œçº¿ç¨‹æ± å³å°†åœæ­¢
        for(auto &t: threads)  //éå†çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹
        {
            if(t.joinable())  //å¦‚æœçº¿ç¨‹å¯è¿æ¥
            {
                t.join();  //ç­‰å¾…çº¿ç¨‹ç»“æŸ
            }
        }
        cout << "ThreadPool destroyed" << endl;  //è¾“å‡ºçº¿ç¨‹æ± é”€æ¯ä¿¡æ¯
    }

    //æ·»åŠ ä»»åŠ¡é˜Ÿåˆ—å‡½æ•°
    template<class T, class ...Args>
    void addtask(T&&task,Args&&...args)
    {
        function<void()> func=bind(forward<T>(task),forward<Args>(args)...);  //ä½¿ç”¨bindå°†ä»»åŠ¡å’Œå‚æ•°ç»‘å®šåˆ°ä¸€ä¸ªå‡½æ•°å¯¹è±¡ä¸Š
        {
            //åŠ é”åŒº   è¦ä¿®æ”¹ç­‰å¾…é˜Ÿåˆ—äº†
            unique_lock<mutex> lock(m_mutex);  //ä½¿ç”¨unique_lockæ¥ç®¡ç†äº’æ–¥é”çš„ç”Ÿå‘½å‘¨æœŸ
            tasks.emplace(move(func));  //å°†å‡½æ•°å¯¹è±¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­

        }
        cond.notify_one();  //é€šçŸ¥ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰æ–°ä»»åŠ¡
    }
    private:

    
    //é»˜è®¤æ„é€ å‡½æ•°  explicit çš„ä½œç”¨æ˜¯é˜²æ­¢æ„é€ å‡½æ•°æˆ–è½¬æ¢å‡½æ•°è¢«éšå¼è°ƒç”¨ï¼Œä»è€Œé¿å…æ„å¤–çš„éšå¼ç±»å‹è½¬æ¢ã€‚
    /*
        Test t1(10);  // æ­£ç¡®ï¼šæ˜¾å¼è°ƒç”¨æ„é€ å‡½æ•°
       Test t2 = 10;  // é”™è¯¯ï¼šéšå¼è°ƒç”¨è¢«ç¦æ­¢ï¼Œå› ä¸ºæ„é€ å‡½æ•°æ˜¯ explicit

    */
    explicit ThreadPool(size_t number_thread): stop(false) //åœ¨çº¿ç¨‹æ± é‡Œé¢åˆ›å»ºçº¿ç¨‹ å‡ ä¸ªçº¿ç¨‹
    {
        for(int i=0;i<number_thread;i++)
        {
            threads.emplace_back([this](){
                while(1)
                {
                    //è·å–é” 
                    unique_lock<std::mutex> lock(m_mutex);  //ä½¿ç”¨unique_lockæ¥ç®¡ç†äº’æ–¥é”çš„ç”Ÿå‘½å‘¨æœŸ
                    cond.wait(lock,[this](){
                        return !tasks.empty() || stop;  //ç­‰å¾…æ¡ä»¶å˜é‡ï¼Œç›´åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸ä¸ºç©ºæˆ–çº¿ç¨‹æ± åœæ­¢
                    });
                    if(stop && tasks.empty())  //å¦‚æœçº¿ç¨‹æ± åœæ­¢ä¸”ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œé€€å‡ºçº¿ç¨‹
                    {
                        return;
                    }
                    //ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡
                    function<void()>  task(move(tasks.front()));  //è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ std::function<void()> å¯¹è±¡ taskï¼Œå¹¶å°† tasks.front() çš„å†…å®¹ç§»åŠ¨åˆ°å®ƒä¸­ã€‚
                    tasks.pop();
                    lock.unlock();  //è§£é”äº’æ–¥é”ï¼Œå…è®¸å…¶ä»–çº¿ç¨‹è®¿é—®ä»»åŠ¡é˜Ÿåˆ—
                    //æ‰§è¡Œä»»åŠ¡
                    task();  //æ‰§è¡Œä»»åŠ¡å‡½æ•°å¯¹è±¡
                 
                }



            });
        }

    }


    mutex m_mutex;  //äº’æ–¥é”
    condition_variable cond;  //æ¡ä»¶å˜é‡
    queue<function<void()>> tasks;  //ä»»åŠ¡é˜Ÿåˆ—ï¼Œå­˜å‚¨å‡½æ•°å¯¹è±¡
    vector<thread> threads;  //çº¿ç¨‹æ± ï¼Œå­˜å‚¨å·¥ä½œçº¿ç¨‹
    bool stop;  //æ ‡å¿—çº¿ç¨‹æ± æ˜¯å¦åœæ­¢
};

// ç¤ºä¾‹ä»»åŠ¡å‡½æ•°
void func(int id) {
    std::cout << "ä»»åŠ¡ " << id << " å¼€å§‹æ‰§è¡Œï¼Œçº¿ç¨‹ID: " 
              << std::this_thread::get_id() << std::endl;

    std::this_thread::sleep_for(std::chrono::seconds(1)); // æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡

    std::cout << "ä»»åŠ¡ " << id << " å®Œæˆ" << std::endl;
}

int main() {

    ThreadPool &pool=ThreadPool::getInstance(5);//è·å–çº¿ç¨‹æ± å•ä¾‹å¯¹è±¡  åªæœ‰é¦–æ¬¡ä¼šè¢«æ„å»º
    std::this_thread::sleep_for(std::chrono::seconds(5));
    for(int i=10;i>0;i--)
    {
        pool.addtask(func,i);  //æ·»åŠ ä»»åŠ¡åˆ°çº¿ç¨‹æ± 
        std::cout << "å·²æ·»åŠ ä»»åŠ¡ " << i << std::endl;
    }

      // ä¸»çº¿ç¨‹ç­‰å¾…éƒ¨åˆ†ä»»åŠ¡å®Œæˆï¼ˆå®é™…æƒ…å†µåº”ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼‰
    std::cout << "ä¸»çº¿ç¨‹ç­‰å¾…ä»»åŠ¡å®Œæˆ..." << std::endl;
    std::this_thread::sleep_for(std::chrono::seconds(10));

  // å†æ¬¡è·å–ç›¸åŒçš„çº¿ç¨‹æ± å®ä¾‹ï¼ˆè¯æ˜å•ä¾‹æœ‰æ•ˆï¼‰
    ThreadPool& samePool = ThreadPool::getInstance();

    samePool.addtask([](){
        std::cout << "å†æ¬¡æ·»åŠ ä»»åŠ¡" << std::endl;
    });

    std::this_thread::sleep_for(std::chrono::seconds(5));
    std::cout << "ç¨‹åºç»“æŸ" << std::endl;


    return 0;
}


```

è¡Œè§£é‡Š

å•ä¾‹æ¨¡å¼å®ç°éƒ¨åˆ†

1. `static ThreadPool& getInstance(size_t numThreads = 4)` - é™æ€æ–¹æ³•è·å–å•ä¾‹å®ä¾‹
2. `static std::once_flag onceFlag` - ä¿è¯çº¿ç¨‹å®‰å…¨çš„once_flag
3. `static std::unique_ptr<ThreadPool> instance` - ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†å•ä¾‹å®ä¾‹
4. `std::call_once(onceFlag, [numThreads]() {...})` - ä¿è¯çº¿ç¨‹å®‰å…¨åœ°åˆå§‹åŒ–å•ä¾‹

çº¿ç¨‹æ± æ ¸å¿ƒéƒ¨åˆ†

1. `std::vector<std::thread> threads` - å­˜å‚¨å·¥ä½œçº¿ç¨‹çš„å®¹å™¨
2. `std::queue<std::function<void()>> tasks` - ä»»åŠ¡é˜Ÿåˆ—
3. `std::mutex mtx` - ä¿æŠ¤å…±äº«æ•°æ®çš„äº’æ–¥é”
4. `std::condition_variable condition` - çº¿ç¨‹é—´é€šä¿¡çš„æ¡ä»¶å˜é‡
5. `bool stop` - çº¿ç¨‹æ± åœæ­¢æ ‡å¿—

ä»»åŠ¡å¤„ç†é€»è¾‘

1. `threads.emplace_back([this] {...})` - åˆ›å»ºå·¥ä½œçº¿ç¨‹
2. `condition.wait(lock, [this] {...})` - ç­‰å¾…ä»»åŠ¡æˆ–åœæ­¢ä¿¡å·
3. `task = std::move(tasks.front())` - ä»é˜Ÿåˆ—è·å–ä»»åŠ¡
4. `task()` - æ‰§è¡Œä»»åŠ¡

ä»»åŠ¡æ·»åŠ é€»è¾‘

1. `auto task = std::make_shared<std::function<void()>>(...)` - ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆåŒ…è£…ä»»åŠ¡
2. `tasks.emplace([task]() { (*task)(); })` - å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—
3. `condition.notify_one()` - é€šçŸ¥ä¸€ä¸ªå·¥ä½œçº¿ç¨‹

Mainå‡½æ•°ä½¿ç”¨è¯´æ˜

1. `ThreadPool& pool = ThreadPool::getInstance(4)` - è·å–æœ‰4ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± å®ä¾‹
2. `pool.enqueue(taskFunction, i)` - æ·»åŠ ä»»åŠ¡åˆ°çº¿ç¨‹æ± 
3. å¤šæ¬¡è°ƒç”¨`getInstance()`è¿”å›çš„æ˜¯åŒä¸€ä¸ªå®ä¾‹
4. ç¨‹åºç»“æŸæ—¶è‡ªåŠ¨æ¸…ç†çº¿ç¨‹æ± èµ„æº

âœ… æ€»ç»“ï¼š`unique_ptr` + `call_once` å•ä¾‹æ¨¡å¼ä¼˜åŠ¿

| ç‰¹æ€§       | è¯´æ˜                                      |
| ---------- | ----------------------------------------- |
| å»¶è¿Ÿåˆå§‹åŒ– | ç¬¬ä¸€æ¬¡ç”¨åˆ°æ—¶æ‰åˆ›å»ºå¯¹è±¡                    |
| çº¿ç¨‹å®‰å…¨   | `std::call_once` ä¿è¯åªåˆå§‹åŒ–ä¸€æ¬¡         |
| æ— å†…å­˜æ³„æ¼ | `unique_ptr` è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡                 |
| ç¦æ­¢æ‹·è´   | `unique_ptr` è¯­ä¹‰åŒ¹é…å•ä¾‹â€œä¸å…è®¸å¤åˆ¶â€è®¾è®¡ |
| æ˜“äºç»´æŠ¤   | ä¸éœ€è¦æ‰‹åŠ¨ deleteï¼Œææ„è‡ªåŠ¨å®Œæˆ           |



#### 12  .async future packaged_task  promise  å¼‚æ­¥å¹¶å‘  è·å¾—çº¿ç¨‹çš„è¿”å›å€¼

`promise` / `future` ä¸€èˆ¬ç”¨äº **ä¸€æ¬¡æ€§** é€šä¿¡ã€‚   

##### 1. async  future

![image-20250717112818380](assets/image-20250717112818380.png)



![image-20250717113013558](assets/image-20250717113013558.png)

![image-20250717113251218](assets/image-20250717113251218-1752723172713-1.png)

```c++
future<int> future_res=async(launch::asunc,func); //å½“funcä¼ ç»™asyncæ—¶funcå·²ç»åœ¨åå°è¿è¡Œå¯ä»¥çœ‹æˆä¸€ä¸ªçº¿ç¨‹  ä¸é˜»å¡  åœ¨åå°è¿è¡Œï¼Œè¿”å›çš„ç»“æœå­˜åœ¨ future_res  ã€‚

cout<< future_res.get()<<endl;    //å¯èƒ½æ—©å°±è¿è¡Œå®Œäº†  å–ç»“æœï¼Œæ²¡è¿è¡Œå®Œå°±ç­‰å¾…ç»“æœ  ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼š**â€œæ­»ç­‰â€**ï¼Œä¸€ç›´ç­‰ func æ‰§è¡Œå®Œæˆã€‚



```

è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨std:asyncå‡½æ•°å¼‚æ­¥æ‰§è¡Œäº†ä¸€ä¸ªè€—æ—¶çš„è®¡ç®—ï¼Œè¿™ä¸ªè®¡ç®—å¯ä»¥åœ¨å¦ä¸€ä¸ª
çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿé¿å…äº†æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å’Œç®¡ç†çº¿ç¨‹çš„éº»çƒ¦ã€‚



```

```



åœ¨ C++ ä¸­ï¼Œ`std::async` å’Œ `std::future` æ˜¯ç”¨äºå®ç° **å¼‚æ­¥ä»»åŠ¡è°ƒåº¦ä¸ç»“æœè·å–** çš„æ ‡å‡†åº“ç»„ä»¶ã€‚ä¸‹é¢æˆ‘å°†å…·ä½“è§£é‡Šå®ƒä»¬çš„å«ä¹‰ã€ä½¿ç”¨æ–¹å¼ã€åº•å±‚åŸç†ï¼Œä»¥åŠä¸çº¿ç¨‹æ± çš„å¯¹æ¯”ã€‚





ä¸€ã€åŸºæœ¬æ¦‚å¿µ

1. `std::async`

`std::async` ä¼šå¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå¯èƒ½åœ¨æ–°çº¿ç¨‹ä¸­è¿è¡Œï¼Œä¹Ÿå¯èƒ½åœ¨è°ƒç”¨çº¿ç¨‹ä¸­å»¶è¿Ÿè¿è¡Œï¼ˆlazy evaluationï¼‰ï¼Œç”±ç­–ç•¥å†³å®šã€‚

```
cppCopyEdit#include <iostream>
#include <future>

int compute(int x) {
    return x * x;
}

int main() {
    std::future<int> fut = std::async(std::launch::async, compute, 10);
    // å¯åšå…¶ä»–äº‹æƒ…
    int result = fut.get();  // é˜»å¡ï¼Œç›´åˆ°computeå®Œæˆå¹¶è¿”å›ç»“æœ
    std::cout << "Result: " << result << std::endl;
}
```

2. `std::future`

`std::future<T>` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ª **å¼‚æ­¥è®¡ç®—æ“ä½œçš„ç»“æœ**ã€‚ä½ å¯ä»¥é€šè¿‡ `.get()` æ–¹æ³•æ¥è·å–ç»“æœï¼ˆå¦‚æœç»“æœè¿˜æ²¡å‡ºæ¥ï¼Œå®ƒä¼šé˜»å¡ï¼‰ã€‚



##### 2.packaged_task  

![image-20250717114106929](assets/image-20250717114106929.png)

packaged_task  ç”Ÿæˆä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡

```c++
packaged_task<int()> task(func);   //åŒ…è£… ç”Ÿæˆå¯è°ƒç”¨å¯¹è±¡  
auto future_res=task.get_future();  //  è¿”å›ä¸€ä¸ªfutureå¯¹è±¡
```

![image-20250717114645288](assets/image-20250717114645288.png)



##### 3.promise  

æ˜¯ä¸€ä¸ªç±»æ¨¡æ¿  ç”¨äºåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­äº§ç”Ÿä¹‹ï¼Œåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è·å–å€¼ï¼Œpromiseé€šå¸¸ä¸asyncä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºå®ç°å¼‚æ­¥ç¼–ç¨‹

![image-20250717115037939](assets/image-20250717115037939.png)

![image-20250717115417201](assets/image-20250717115417201.png)

 

```c++
#include <iostream>
#include <thread>
#include <future>
using namespace std;

/*


1. std::promise å’Œ std::future
std::promise<T>ï¼šç”¨äºåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è®¾ç½®å€¼

std::future<T>ï¼šç”¨äºåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è·å–è¯¥å€¼

å®ƒä»¬ä¹‹é—´é€šè¿‡ä¸€ä¸ªå…±äº«çŠ¶æ€é€šä¿¡ã€‚
*/
void producer(promise<int> prom)
{
    this_thread::sleep_for(chrono::seconds(1));
    prom.set_value(10);  //è®¾ç½®promiseçš„å€¼  åªè®¾ç½®ä¸€æ¬¡  ç¬¬äºŒæ¬¡ä¼šæŠ›å‡ºå¼‚å¸¸
}

void comsumer(future<int> fu)
{
    int ret=fu.get(); //ä¼šé˜»å¡ç­‰å¾…promiseè®¾ç½®å€¼   è¿™ å¹¶ä¸æ˜¯â€œåªè¯»â€æ“ä½œï¼Œè€Œæ˜¯â€œå–ä¸€æ¬¡å°±æ²¡äº†â€çš„æ“ä½œã€‚åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼ è°ƒç¬¬äºŒæ¬¡å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š
    cout<<"ret:"<<ret<<endl;
}

int main()
{
    promise<int> prom;
    future<int> fu=prom.get_future();

    thread t1(producer , std::move(prom));
    thread t2(comsumer, std::move(fu));

    t1.join();
    t2.join();

return 0;

}


```



2. std::async
std::async åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡åœ¨åå°è‡ªåŠ¨åˆ›å»ºçº¿ç¨‹æˆ–å»¶è¿Ÿè°ƒç”¨ã€‚

è¿”å›ä¸€ä¸ª std::future<T>ï¼Œé€šè¿‡å®ƒå¯ä»¥è·å–ä»»åŠ¡çš„è¿”å›å€¼ã€‚

```c++

#include <iostream>
#include <future>

int task(int x)
{
    std::this_thread::sleep_for(std::chrono::seconds(1));
    return x * 2;
}

int main()
{
    std::future<int> fut = std::async(std::launch::async, task, 21);
    std::cout << "ç­‰å¾…ç»“æœ...\n";
    std::cout << "ç»“æœæ˜¯: " << fut.get() << std::endl;
}
```

ä¸‰è€…ç»“åˆä½¿ç”¨ï¼špromise + future + async

æˆ‘ä»¬å¯ä»¥ç»“åˆä½¿ç”¨ `promise` ä¸ `future`ï¼Œå¹¶é€šè¿‡ `async` åˆ›å»ºå¼‚æ­¥ä»»åŠ¡ï¼Œå®Œæˆä¸€ä¸ªçº¿ç¨‹é—´æ•°æ®ä¼ é€’+å¼‚æ­¥è®¡ç®—çš„åœºæ™¯ï¼š

âœ… ç¤ºä¾‹ï¼šmain çº¿ç¨‹å‡†å¤‡æ•°æ® -> å¼‚æ­¥çº¿ç¨‹å¤„ç† -> è¿”å›å¤„ç†ç»“æœ

```c++
#include <iostream>
#include <future>
#include <thread>

// å¼‚æ­¥ä»»åŠ¡ï¼Œç­‰å¾…ä¸»çº¿ç¨‹ä¼ æ¥çš„å€¼
void worker(std::future<int> fut, std::promise<int> prom)
{
    int x = fut.get(); // ä»ä¸»çº¿ç¨‹æ¥æ”¶æ•°æ®  æ­»ç­‰
    int result = x * 10;
    prom.set_value(result); // å°†ç»“æœè¿”å›ç»™ä¸»çº¿ç¨‹
}

int main()
{
    std::promise<int> input_prom;
    std::future<int> input_fut = input_prom.get_future();

    std::promise<int> result_prom;
    std::future<int> result_fut = result_prom.get_future();

    // å¼‚æ­¥ä»»åŠ¡ï¼ˆä¹Ÿå¯ä»¥ç”¨ std::threadï¼‰
    std::thread t(worker, std::move(input_fut), std::move(result_prom));

    
    
    // ä¸»çº¿ç¨‹å‘å¼‚æ­¥çº¿ç¨‹å‘é€æ•°æ®
    input_prom.set_value(7);

    // ä¸»çº¿ç¨‹è·å–å¼‚æ­¥çº¿ç¨‹è¿”å›çš„ç»“æœ
    int result = result_fut.get();
    std::cout << "å¤„ç†ç»“æœ: " << result << std::endl;

    t.join();
}

```

å› ä¸ºè¿™ä¸¤ä¸ªç±»å‹ï¼š

```
cppCopyEditstd::future<int>
std::promise<int>
```

éƒ½**ä¸èƒ½è¢«æ‹·è´ï¼ˆcopyï¼‰**ï¼Œåªèƒ½è¢«**ç§»åŠ¨ï¼ˆmoveï¼‰**ï¼

âœ… 1. `std::future` å’Œ `std::promise` æ˜¯ **ä¸å¯æ‹·è´çš„ï¼ˆdeleted copy constructorï¼‰**

```
cppCopyEditstd::future<int> f1 = f2;  // âŒ ç¼–è¯‘é”™è¯¯ï¼
std::promise<int> p1 = p2; // âŒ ç¼–è¯‘é”™è¯¯ï¼
```

å®ƒä»¬å†…éƒ¨ç»´æŠ¤ç€åŒæ­¥çŠ¶æ€å’Œå…±äº«çŠ¶æ€æŒ‡é’ˆï¼Œä¸ºäº†é¿å…è¯¯ç”¨å’Œæ•°æ®å†²çªï¼Œæ ‡å‡†åº“ç¦æ­¢ä½ æ‹·è´å®ƒä»¬ã€‚





æ€»ç»“å¯¹æ¯”ï¼š

| æœºåˆ¶           | ç”¨é€”                         | ç‰¹ç‚¹                          |
| -------------- | ---------------------------- | ----------------------------- |
| `std::promise` | è®¾ç½®å¼‚æ­¥ç»“æœï¼ˆç”±ç”Ÿäº§è€…çº¿ç¨‹ï¼‰ | ä¸ `future` ä¸€å¯¹ä¸€ç»‘å®š        |
| `std::future`  | è·å–å¼‚æ­¥ç»“æœï¼ˆç”±æ¶ˆè´¹è€…çº¿ç¨‹ï¼‰ | `get()` ä¼šé˜»å¡ç›´åˆ°æœ‰ç»“æœ      |
| `std::async`   | è‡ªåŠ¨åˆ›å»ºå¼‚æ­¥ä»»åŠ¡             | è¿”å›ä¸€ä¸ª futureï¼›çº¿ç¨‹è‡ªåŠ¨ç®¡ç† |

####  13.åŸå­æ“ä½œ   atomic

å’Œäº’æ–¥é”  å…¨å±€å…±äº«å˜é‡



std:atomic æ˜¯C++11æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡æ¿ç±»ï¼Œç”¨äºå®ç°å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„åŸå­æ“ä½œã€‚å®ƒ
æä¾›äº†ä¸€ç§çº¿ç¨‹å®‰å…¨çš„æ–¹å¼æ¥è®¿é—®å’Œä¿®æ”¹å…±äº«å˜é‡ï¼Œå¯ä»¥é¿å…å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„æ•°æ®ç«äº‰é—®
é¢˜ã€‚



![image-20250717121442696](assets/image-20250717121442696.png)

```c++
#include<atomic>
atomic<int> shared_data=0;


#include <iostream>
#include <thread>
#include <mutex>
#include <atomic>

std::atomic<int> shared_data = 0;
void func() {
    for (int i = 0; i < 100000; ++i) {
   
    shared_data++;
    }
}

int main() {
    std::thread t1(func);
    std::thread t2(func);
    t1.join();
    t2.join();
    std::cout << "shared_data = " << shared_data << std::endl;
    return 0;
}
```

![image-20250717122035760](assets/image-20250717122035760.png)

ğŸ§± äºŒã€å¸¸è§æ“ä½œ

âœ… åŸå­è¯»å†™

```
cppCopyEditstd::atomic<int> x(0);
x = 5;              // åŸå­å†™
int y = x.load();   // åŸå­è¯»
```

âœ… åŸå­åŠ å‡

```
x++;                // åŸå­åŠ ä¸€
x.fetch_add(2);     // åŠ 2ï¼Œè¿”å›ä¿®æ”¹å‰çš„å€¼
x.fetch_sub(1);     // å‡1ï¼Œè¿”å›ä¿®æ”¹å‰çš„å€¼
```

âœ… compare_exchange

è¿™æ˜¯ **æ— é”ç¼–ç¨‹æ ¸å¿ƒæ“ä½œ**ï¼Œå®ç°ç±»ä¼¼ä¹è§‚é”çš„æœºåˆ¶ï¼š

```
int expected = 5;
if (x.compare_exchange_strong(expected, 10)) {
    // æˆåŠŸï¼šx åŸæœ¬æ˜¯ 5ï¼Œç°åœ¨æ”¹æˆ 10
} else {
    // å¤±è´¥ï¼šx å½“å‰ä¸æ˜¯ 5ï¼Œexpected è¢«æ›´æ–°ä¸º x çš„å½“å‰å€¼
}
```

ğŸš¥ ä¸‰ã€memory_order å†…å­˜åºï¼ˆå¯é€‰é«˜çº§ç”¨æ³•ï¼‰

- `memory_order_relaxed`: æœ€å¼±é¡ºåºï¼Œä»…ä¿è¯åŸå­æ€§ã€‚
- `memory_order_acquire / release`: ç”¨äºå•å‘åŒæ­¥ã€‚
- `memory_order_seq_cst`: é»˜è®¤ï¼Œæœ€å¼ºé¡ºåºï¼Œä¿è¯æ‰€æœ‰çº¿ç¨‹å¯¹åŸå­å˜é‡çš„æ“ä½œå…·æœ‰å…¨åºä¸€è‡´æ€§ã€‚

```
cppCopyEditx.store(1, std::memory_order_release);
int y = x.load(std::memory_order_acquire);
```

ğŸ“Œ å°ç»“

| æ“ä½œ                 | æ–¹æ³•æˆ–è¯­æ³•                     |
| -------------------- | ------------------------------ |
| åŸå­è¯»å†™             | `.load()`, `.store()`          |
| åŸå­åŠ /å‡            | `.fetch_add()`, `.fetch_sub()` |
| è‡ªå¢è‡ªå‡             | `++x`, `--x`                   |
| CAS æ“ä½œï¼ˆæ¯”è¾ƒäº¤æ¢ï¼‰ | `.compare_exchange_strong()`   |

#### 14.è¯»å†™é”

æ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œä¸iå¾å¤šä¸ªè¯»æ“ä½œåŒæ—¶è¿›è¡Œï¼Œå†™æ“ä½œå¿…é¡»ç‹¬ç«‹è®¿é—®ï¼Œé€šè¿‡åˆ†ç¦»è¯»å†™æ“ä½œæé«˜å¹¶å‘æ€§èƒ½ï¼Œæ˜¯ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯

æ— è¯»é”æ—¶ï¼Œè¯»å†™å¯å…±äº« 

æ— å†™æ— è¯»æ—¶ï¼Œæ‰å¯åŠ å†™é”

ä¼˜å…ˆçº§ç­–ç•¥ä¼˜åŒ–é—®é¢˜







### 3.C++11ç”¨è¿‡å“ªäº›æ–°ç‰¹æ€§



> [!IMPORTANT]
>
> è¯­æ³•å¡˜ï¼š
>
> â€‹	å…³é”®å­—ï¼šauto ã€decltype
>
> â€‹		      finalã€overwrte
>
> â€‹	è¯­æ³•ï¼š function å‡½æ•°å¯¹è±¡
>
> â€‹		     bind
>
> â€‹		     lambda
>
> STLå®¹å™¨:
>
> â€‹	array
>
> â€‹	forward_list
>
> â€‹	unordered_map
>
> â€‹	unordered_set
>
> æ™ºèƒ½æŒ‡é’ˆï¼š
>
> â€‹	shared_ptr/weak_ptr
>
> â€‹	unique_ptr
>
> å¤šçº¿ç¨‹ï¼š
>
> â€‹	thread
>
> â€‹	mutexã€lock_ground
>
> â€‹	condition_variable
>
> â€‹	atomic
>
> å³å€¼å¼•ç”¨
>
> â€‹	T&&ï¼š
>
> â€‹	å°†äº¡å€¼ï¼š
>
> â€‹			ç§»åŠ¨æ„é€ 
>
> â€‹			ç§»åŠ¨æ‹·è´æ„é€ 

â€‹	    å®ç°ç§»åŠ¨è¯­ä¹‰ï¼šstd::move()

â€‹            å®ç°å®Œç¾è½¬å‘ï¼šä¸‡èƒ½å¼•ç”¨ T&&

â€‹					forward





â€‹	



# 2.CåŸºç¡€





# 3. linuxåŸºç¡€å‘½ä»¤





# ä¸Šä¼ git



```c
 cd D:/

cd aèµ„æ–™/ç ”ç©¶ç”Ÿèµ„æ–™/æ‰¾å·¥ä½œ/C++çŸ¥è¯†/

 git add resum_.md
 git commit -m "2025/7/17"

git push -u origin master




```



## 1. GIT æŒ‡ä»¤

```c
//gloabl å…³é”®å­—è¡¨ç¤ºè¿™å°æœºå™¨ä¸Šçš„æ‰€æœ‰GITä»“åº“éƒ½ä¼šä½¿ç”¨è¿™ä¸ªé…ç½® ï¼Œä¹Ÿå¯ä»¥ä¸ºæŸä¸ªä»“åº“åˆ¶å®šä¸åŒçš„ä»“åº“åœ°å€
git config --global  user.name "JKX-yy"
git config --global  user.email "983008880@qq.com"
    
```



## 4

## 4. åˆ›å»ºç‰ˆæœ¬åº“



åˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªç›®å½•ï¼Œé‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶éƒ½å¯ä»¥è¢«GITç®¡ç†èµ·æ¥ï¼Œæ¯ä¸ªæ–‡ä»¶çš„ä¿®æ”¹åˆ é™¤ Gitéƒ½èƒ½è·Ÿè¸ªï¼Œä¸€è¾¹ä»»ä½•æ—¶åˆ»éƒ½å¯ä»¥è¿½è¸ªå†å²ï¼Œ

```c++
mkdir learngit 
cd learngit
pwd
```



åˆå§‹åŒ–ä¸ºå¯ç®¡ç†çš„ä»“åº“,`.git`çš„ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æ˜¯Gitæ¥è·Ÿè¸ªç®¡ç†ç‰ˆæœ¬åº“çš„ï¼Œæ²¡äº‹åƒä¸‡ä¸è¦æ‰‹åŠ¨ä¿®æ”¹è¿™ä¸ªç›®å½•é‡Œé¢çš„æ–‡ä»¶ï¼Œä¸ç„¶æ”¹ä¹±äº†ï¼Œå°±æŠŠGitä»“åº“ç»™ç ´åäº†.

```c
git init 
// ll  ä¼šå‡ºç°ä¸€ä¸ªéšè—ç›®å½•  .git 
    //ls -ah 
```



æäº¤æœ¬åœ°ä»“åº“





```c
//ç¬¬ä¸€æ­¥ï¼Œç”¨å‘½ä»¤git addå‘Šè¯‰Gitï¼ŒæŠŠæ–‡ä»¶æ·»åŠ åˆ°ä»“åº“
git add ..  //(å¯ä»¥å¤šæ¬¡add)
//ç¬¬äºŒæ­¥ï¼Œç”¨å‘½ä»¤git commitå‘Šè¯‰Gitï¼ŒæŠŠæ–‡ä»¶æäº¤åˆ°ä»“åº“ï¼š    
git commit -m "è¯´æ˜"
    
git push -u origin master
```



å› ä¸º`commit`å¯ä»¥ä¸€æ¬¡æäº¤å¾ˆå¤šæ–‡ä»¶ï¼Œæ‰€ä»¥ä½ å¯ä»¥å¤šæ¬¡`add`ä¸åŒçš„æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š

```c
$ git add file1.txt
$ git add file2.txt file3.txt
$ git commit -m "add 3 files."

```

## 5.æ—¶å…‰ç©¿æ¢­æœº



ä½¿ç”¨git addæäº¤å  ç»§ç»­ä¿®æ”¹æ–‡ä»¶ï¼Œ

### 1.æŸ¥çœ‹çŠ¶æ€

```c
git  status //æŸ¥çœ‹ä»“åº“çŠ¶æ€
    
    
$ git status
    /*
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   readme.txt  //å·²ç»ä¿®æ”¹

no changes added to commit (use "git add" and/or "git commit -a")*/

```

### 2. æŸ¥çœ‹å…·ä½“å“ªé‡Œä¿®æ”¹äº†difference

`git diff`é¡¾åæ€ä¹‰å°±æ˜¯æŸ¥çœ‹differenceï¼Œæ˜¾ç¤ºçš„æ ¼å¼æ­£æ˜¯Unixé€šç”¨çš„diffæ ¼å¼ï¼Œå¯ä»¥ä»ä¸Šé¢çš„å‘½ä»¤è¾“å‡ºçœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€è¡Œæ·»åŠ äº†ä¸€ä¸ª`distributed`å•è¯ã€‚

ä½†æ˜¯æˆ‘çš„æ˜¯mdçš„æ–‡ä»¶è°ƒç”¨åå¹¶æ²¡æœ‰è¾“å‡º

```c
git diff 
    
    
```

```
$ git diff readme.txt 
    
diff --git a/readme.txt b/readme.txt
index 46d49bf..9247db6 100644
--- a/readme.txt
+++ b/readme.txt
@@ -1,2 +1,2 @@
-Git is a version control system.
+Git is a distributed version control system.
 Git is free software.

```

### 1.ç‰ˆæœ¬é€€å›

Gitä¹Ÿæ˜¯ä¸€æ ·ï¼Œæ¯å½“ä½ è§‰å¾—æ–‡ä»¶ä¿®æ”¹åˆ°ä¸€å®šç¨‹åº¦çš„æ—¶å€™ï¼Œå°±å¯ä»¥â€œä¿å­˜ä¸€ä¸ªå¿«ç…§â€ï¼Œè¿™ä¸ªå¿«ç…§åœ¨Gitä¸­è¢«ç§°ä¸º`commit`ã€‚ä¸€æ—¦ä½ æŠŠæ–‡ä»¶æ”¹ä¹±äº†ï¼Œæˆ–è€…è¯¯åˆ äº†æ–‡ä»¶ï¼Œè¿˜å¯ä»¥ä»æœ€è¿‘çš„ä¸€ä¸ª`commit`æ¢å¤ï¼Œç„¶åç»§ç»­å·¥ä½œï¼Œè€Œä¸æ˜¯æŠŠå‡ ä¸ªæœˆçš„å·¥ä½œæˆæœå…¨éƒ¨ä¸¢å¤±ã€‚



æŸ¥çœ‹æäº¤çš„å†å²è®°å½•

```c
git log
  è¾“å‡º ç‰ˆæœ¬å·    
    
```

`git log`å‘½ä»¤æ˜¾ç¤ºä»æœ€è¿‘åˆ°æœ€è¿œçš„æäº¤æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°3æ¬¡æäº¤ï¼Œæœ€è¿‘çš„ä¸€æ¬¡æ˜¯`append GPL`ï¼Œä¸Šä¸€æ¬¡æ˜¯`add distributed`ï¼Œæœ€æ—©çš„ä¸€æ¬¡æ˜¯`wrote a readme file`ã€‚

å¦‚æœå«Œè¾“å‡ºä¿¡æ¯å¤ªå¤šï¼Œçœ‹å¾—çœ¼èŠ±ç¼­ä¹±çš„ï¼Œå¯ä»¥è¯•è¯•åŠ ä¸Š`--pretty=oneline`å‚æ•°ï¼š



```
$ git log
commit 1094adb7b9b3807259d8cb349e7df1d4d6477073 (HEAD -> master)//headè¡¨ç¤ºå½“å‰ç‰ˆæœ¬   æœ€æ–°ç‰ˆæœ¬
Author: Michael Liao <askxuefeng@gmail.com>
Date:   Fri May 18 21:06:15 2018 +0800

    append GPL

commit e475afc93c209a690c39c13a46716e8fa000c366
Author: Michael Liao <askxuefeng@gmail.com>
Date:   Fri May 18 21:03:36 2018 +0800

    add distributed

commit eaadf4e385e865d25c48e7ca9c8395c3f7dfaef0
Author: Michael Liao <askxuefeng@gmail.com>
Date:   Fri May 18 20:59:18 2018 +0800

    wrote a readme file

```

//å¦‚æœå…³æœºäº†  åæ‚”äº† æƒ³ç©¿è¶Šå›æ¥å¯ä»¥  git reflog  ç”¨æ¥è®°å½•ä½ çš„æ¯ä¸€æ¬¡å‘½ä»¤

```c
git reflog
    
```

```
$ git reflog
adf82ef (HEAD -> master) HEAD@{0}: commit: xx
7c3fa38 HEAD@{1}: commit: 2025/7/17
ac363eb (origin/master) HEAD@{2}: commit: çº¿ç¨‹æ± 2
52ee54e HEAD@{3}: commit: çº¿ç¨‹æ± 
77c6ce1 HEAD@{4}: commit (initial): c++ é¢è¯•å¯èƒ½ä¼šé—®çš„é—®é¢˜

```

æ¯æäº¤ä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œå®é™…ä¸ŠGitå°±ä¼šæŠŠå®ƒä»¬è‡ªåŠ¨ä¸²æˆä¸€æ¡æ—¶é—´çº¿ã€‚å¦‚æœä½¿ç”¨å¯è§†åŒ–å·¥å…·æŸ¥çœ‹Gitå†å²ï¼Œå°±å¯ä»¥æ›´æ¸…æ¥šåœ°çœ‹åˆ°æäº¤å†å²çš„æ—¶é—´çº¿ï¼š



ä¸Šä¸€ä¸ªç‰ˆæœ¬å°±æ˜¯`HEAD^`ï¼Œä¸Šä¸Šä¸€ä¸ªç‰ˆæœ¬å°±æ˜¯`HEAD^^`ï¼Œå½“ç„¶å¾€ä¸Š100ä¸ªç‰ˆæœ¬å†™100ä¸ª`^`æ¯”è¾ƒå®¹æ˜“æ•°ä¸è¿‡æ¥ï¼Œæ‰€ä»¥å†™æˆ`HEAD~100`ã€‚

```c
git reset --hard  HEAD^  //å›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ HEAD~n
```

ä»21ä¸–çºªç©¿è¶Šåˆ°19ä¸–çºª  ä½†æ˜¯åªè¦ç©¿æ¢­æœºä¸å…³ï¼ˆå‘½ä»¤è¡Œçª—å£è¿˜æ²¡æœ‰è¢«å…³æ‰ï¼‰ï¼Œå¯ä»¥æ‰¾åˆ°ä¹‹å‰çš„commit id  

ç‰ˆæœ¬å·æ²¡å¿…è¦å†™å…¨ï¼Œå‰å‡ ä½å°±å¯ä»¥äº†ï¼ŒGitä¼šè‡ªåŠ¨å»æ‰¾ã€‚å½“ç„¶ä¹Ÿä¸èƒ½åªå†™å‰ä¸€ä¸¤ä½ï¼Œå› ä¸ºGitå¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç‰ˆæœ¬å·ï¼Œå°±æ— æ³•ç¡®å®šæ˜¯å“ªä¸€ä¸ªäº†ã€‚

```c
git reset --hard 1094a
```





ğŸ”§ ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µå…ˆè§£é‡Šæ¸…æ¥š

| åè¯                        | å«ä¹‰                                          |
| --------------------------- | --------------------------------------------- |
| `HEAD`                      | å½“å‰æ‰€æŒ‡å‘çš„æäº¤ï¼ˆä½ æ­£åœ¨å“ªä¸ª commit ä¸Šï¼‰      |
| `index`ï¼ˆæš‚å­˜åŒºï¼‰           | ç”¨ `git add` åŠ è¿›å»çš„å†…å®¹ï¼ˆå‡†å¤‡è¦æäº¤çš„å†…å®¹ï¼‰ |
| å·¥ä½œåŒºï¼ˆWorking Directoryï¼‰ | ä½ å½“å‰çœ‹åˆ°çš„é¡¹ç›®æ–‡ä»¶ï¼ˆä½ åœ¨ç¼–è¾‘å™¨é‡Œæ”¹çš„å†…å®¹ï¼‰  |







ç¤ºä¾‹åœºæ™¯ï¼ˆä½ åˆšåšäº†ä¸¤æ¬¡æäº¤ï¼‰

å‡è®¾ä½ æœ‰ä¸€ä¸ª `file.txt` æ–‡ä»¶ï¼Œä¾æ¬¡æ‰§è¡Œäº†ä»¥ä¸‹æ“ä½œï¼š

```
bashCopyEditecho "first line" > file.txt
git add file.txt
git commit -m "first commit"

echo "second line" >> file.txt
git add file.txt
git commit -m "second commit"
```

ç°åœ¨ï¼š

- `HEAD` æŒ‡å‘ **ç¬¬äºŒæ¬¡æäº¤**

- `file.txt` å†…å®¹æ˜¯ï¼š

  ```
  first line
  second line
  ```

ğŸ‘‡ å‡è®¾ç°åœ¨ä½ æ‰§è¡Œï¼š

```

git reset --soft HEAD~1
```

| åŒºåŸŸ   | è¯´æ˜                              |
| ------ | --------------------------------- |
| HEAD   | â¬…ï¸ å›é€€åˆ°ç¬¬ä¸€æ¬¡æäº¤                |
| index  | âœ… æš‚å­˜åŒº **ä¿ç•™ç¬¬äºŒæ¬¡æäº¤çš„å†…å®¹** |
| å·¥ä½œåŒº | âœ… ä½ çœ‹åˆ°çš„æ–‡ä»¶å†…å®¹ **è¿˜æ˜¯æœ‰ä¸¤è¡Œ** |



ğŸ‘‰ æ„æ€æ˜¯ï¼š**åªæ˜¯æ’¤å›äº†æäº¤ï¼Œæ–‡ä»¶æ”¹åŠ¨è¿˜åœ¨ï¼Œå¹¶ä¸”è¿˜åœ¨ `add` çŠ¶æ€**

ä½ å¯ä»¥ç›´æ¥ï¼š

```

git commit -m "ä¿®æ”¹è¿‡çš„æäº¤ä¿¡æ¯"
```

æ¥æ”¹å†™åˆšæ‰çš„æäº¤ã€‚

ğŸ‘‡ å¦‚æœä½ æ‰§è¡Œï¼š

```
bash

git reset --mixed HEAD~1
```

| åŒºåŸŸ   | è¯´æ˜                                        |
| ------ | ------------------------------------------- |
| HEAD   | â¬…ï¸ å›é€€åˆ°ç¬¬ä¸€æ¬¡æäº¤                          |
| index  | âŒ æš‚å­˜åŒºæ¸…ç©ºï¼ˆä¹Ÿå°±æ˜¯æ’¤å› `git add` çš„æ•ˆæœï¼‰ |
| å·¥ä½œåŒº | âœ… æ–‡ä»¶å†…å®¹è¿˜æ˜¯ä¸¤è¡Œ                          |



ğŸ‘‰ æ„æ€æ˜¯ï¼šä½ æ’¤å›äº†æäº¤ï¼Œä¹Ÿæ’¤å›äº† `add`ï¼Œä½†æ”¹åŠ¨è¿˜åœ¨æ–‡ä»¶é‡Œ
 ä½ éœ€è¦é‡æ–° `git add file.txt` æ‰èƒ½å†æäº¤

ğŸ‘‡ å¦‚æœä½ æ‰§è¡Œï¼š

```

git reset --hard HEAD~1
```

| åŒºåŸŸ   | è¯´æ˜                                              |
| ------ | ------------------------------------------------- |
| HEAD   | â¬…ï¸ å›é€€åˆ°ç¬¬ä¸€æ¬¡æäº¤                                |
| index  | âŒ æš‚å­˜åŒºæ¢å¤åˆ°ç¬¬ä¸€æ¬¡æäº¤çš„çŠ¶æ€ï¼ˆä¸åŒ…å«ç¬¬äºŒè¡Œï¼‰    |
| å·¥ä½œåŒº | âŒ ä½ çœ‹åˆ°çš„æ–‡ä»¶ä¹Ÿåªå‰©ä¸‹ `first line`ï¼ˆç¬¬äºŒè¡Œä¸¢å¤±ï¼‰ |



ğŸ‘‰ æ„æ€æ˜¯ï¼š**æäº¤ã€æš‚å­˜ã€å·¥ä½œåŒºï¼Œå…¨éƒ½é€€å›å»äº†ï¼Œç¬¬äºŒæ¬¡æäº¤çš„æ”¹åŠ¨ä¸¢äº†**



### 2.å·¥ä½œåŒºå’Œæš‚å­˜åŒº



å·¥ä½œåŒºæ˜¯.git å­˜åœ¨çš„æ–‡ä»¶å¤¹  



ã€‚git(æ˜¯ç‰ˆæœ¬åº“)  åŒ…å«

â€‹	stage æš‚å­˜åŒº

â€‹	master åˆ›å»ºçš„ä¸€ä¸ªåˆ†æ”¯ï¼ˆå¹¶ç”±ä¸€ä¸ªæŒ‡å‘masterçš„æŒ‡é’ˆï¼‰



![git-repo](https://liaoxuefeng.com/books/git/time-travel/working-stage/repo.png)

```c
git  add //æ·»åŠ åˆ°æš‚å­˜åŒº  stage
```

```c
git commit //å°†æš‚å­˜åŒºæäº¤åˆ°åˆ†æ”¯
```

æ‰€ä»¥ï¼Œ`git add`å‘½ä»¤å®é™…ä¸Šå°±æ˜¯æŠŠè¦æäº¤çš„æ‰€æœ‰ä¿®æ”¹æ”¾åˆ°æš‚å­˜åŒºï¼ˆStageï¼‰ï¼Œç„¶åï¼Œæ‰§è¡Œ`git commit`å°±å¯ä»¥ä¸€æ¬¡æ€§æŠŠæš‚å­˜åŒºçš„æ‰€æœ‰ä¿®æ”¹æäº¤åˆ°åˆ†æ”¯ã€‚

![git-stage-after-commit](https://liaoxuefeng.com/books/git/time-travel/working-stage/commit.png)

### 3.ç®¡ç†ä¿®æ”¹

è·Ÿè¸ªç®¡ç†çš„æ˜¯ä¿®æ”¹   è€Œä¸æ˜¯æ–‡ä»¶

é‚£æ€ä¹ˆæäº¤ç¬¬äºŒæ¬¡ä¿®æ”¹å‘¢ï¼Ÿä½ å¯ä»¥ç»§ç»­`git add`å†`git commit`ï¼Œä¹Ÿå¯ä»¥åˆ«ç€æ€¥æäº¤ç¬¬ä¸€æ¬¡ä¿®æ”¹ï¼Œå…ˆ`git add`ç¬¬äºŒæ¬¡ä¿®æ”¹ï¼Œå†`git commit`ï¼Œå°±ç›¸å½“äºæŠŠä¸¤æ¬¡ä¿®æ”¹åˆå¹¶åä¸€å—æäº¤äº†ï¼š

ç¬¬ä¸€æ¬¡ä¿®æ”¹ -> `git add` -> ç¬¬äºŒæ¬¡ä¿®æ”¹ -> `git add` -> `git commit`

å¥½ï¼Œç°åœ¨ï¼ŒæŠŠç¬¬äºŒæ¬¡ä¿®æ”¹æäº¤äº†ï¼Œç„¶åå¼€å§‹å°ç»“ã€‚



### 4. æ’¤é”€ä¿®æ”¹

æ€»ä¹‹ï¼Œå°±æ˜¯è®©è¿™ä¸ªæ–‡ä»¶å›åˆ°æœ€è¿‘ä¸€æ¬¡`git commit`æˆ–`git add`æ—¶çš„çŠ¶æ€ã€‚

```c
git checkout -- file
```

æ’¤é”€åœ¨æ–‡ä»¶åŒºçš„ä¿®æ”¹

å‘½ä»¤`git checkout -- readme.txt`æ„æ€å°±æ˜¯ï¼ŒæŠŠ`readme.txt`æ–‡ä»¶åœ¨å·¥ä½œåŒºçš„ä¿®æ”¹å…¨éƒ¨æ’¤é”€ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µï¼š

ä¸€ç§æ˜¯`readme.txt`è‡ªä¿®æ”¹åè¿˜æ²¡æœ‰è¢«æ”¾åˆ°æš‚å­˜åŒºï¼Œç°åœ¨ï¼Œæ’¤é”€ä¿®æ”¹å°±å›åˆ°å’Œç‰ˆæœ¬åº“ä¸€æ¨¡ä¸€æ ·çš„çŠ¶æ€ï¼›

ä¸€ç§æ˜¯`readme.txt`å·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºåï¼Œåˆä½œäº†ä¿®æ”¹ï¼Œç°åœ¨ï¼Œæ’¤é”€ä¿®æ”¹å°±å›åˆ°æ·»åŠ åˆ°æš‚å­˜åŒºåçš„çŠ¶æ€ã€‚





`git checkout -- file`å‘½ä»¤ä¸­çš„`--`å¾ˆé‡è¦ï¼Œæ²¡æœ‰`--`ï¼Œå°±å˜æˆäº†â€œåˆ‡æ¢åˆ°å¦ä¸€ä¸ªåˆ†æ”¯â€çš„å‘½ä»¤ï¼Œæˆ‘ä»¬åœ¨åé¢çš„åˆ†æ”¯ç®¡ç†ä¸­ä¼šå†æ¬¡é‡åˆ°`git checkout`å‘½ä»¤ã€‚



GitåŒæ ·å‘Šè¯‰æˆ‘ä»¬ï¼Œç”¨å‘½ä»¤`git reset HEAD <file>`å¯ä»¥æŠŠæš‚å­˜åŒºçš„ä¿®æ”¹æ’¤é”€æ‰ï¼ˆunstageï¼‰ï¼Œé‡æ–°æ”¾å›å·¥ä½œåŒºï¼š

```c
git reset HEAD file //å¯¹å•ä¸ªæ–‡ä»¶çš„æ“ä½œ æŠŠ readme.txt ä» æš‚å­˜åŒºï¼ˆstage/indexï¼‰ ç§»é™¤ï¼ˆå›åˆ°å·¥ä½œåŒºï¼‰ï¼Œä½†ä¸ä¼šè¿˜åŸå·¥ä½œåŒºçš„å†…å®¹ï¼ˆä¸ä¼šæ”¹åŠ¨ä½ ç¼–è¾‘çš„æ–‡ä»¶ï¼‰ï¼Œæ‰€ä»¥åªæ˜¯â€œå–æ¶ˆ addâ€äº†è¿™ä¸ªæ–‡ä»¶ã€‚
it reset --mixed HEAD // æŠŠæ‰€æœ‰æš‚å­˜åŒºçš„å˜æ›´éƒ½æ’¤é”€æ‰ï¼ˆå³å›é€€åˆ° HEAD æŒ‡å‘çš„ç‰ˆæœ¬ï¼‰ï¼Œ ä½†ä¸ä¼šä¿®æ”¹å·¥ä½œåŒºå†…å®¹ï¼ˆæ”¹è¿‡çš„æ–‡ä»¶å†…å®¹è¿˜åœ¨ï¼‰ï¼Œ  ä¹Ÿå°±æ˜¯â€œå–æ¶ˆ git addâ€ã€‚
```

`git reset`å‘½ä»¤æ—¢å¯ä»¥å›é€€ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥æŠŠæš‚å­˜åŒºçš„ä¿®æ”¹å›é€€åˆ°å·¥ä½œåŒºã€‚å½“æˆ‘ä»¬ç”¨`HEAD`æ—¶ï¼Œè¡¨ç¤ºæœ€æ–°çš„ç‰ˆæœ¬ã€‚





```c
//ç°åœ¨æš‚å­˜åŒºæ˜¯å¹²å‡€çš„ï¼Œå·¥ä½œåŒºæœ‰ä¿®æ”¹
 git checkout -- readme.txt//ä¸¢å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹ å›åˆ°æœ€è¿‘ä¸€ä¸€ç‰ˆçš„add / commit
```

åœºæ™¯1ï¼šå½“ä½ æ”¹ä¹±äº†å·¥ä½œåŒºæŸä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œæƒ³ç›´æ¥ä¸¢å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹æ—¶ï¼Œç”¨å‘½ä»¤`git checkout -- file`ã€‚

åœºæ™¯2ï¼šå½“ä½ ä¸ä½†æ”¹ä¹±äº†å·¥ä½œåŒºæŸä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œè¿˜æ·»åŠ åˆ°äº†æš‚å­˜åŒºæ—¶ï¼Œæƒ³ä¸¢å¼ƒä¿®æ”¹ï¼Œåˆ†ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥ç”¨å‘½ä»¤`git reset HEAD <file>`ï¼Œå°±å›åˆ°äº†åœºæ™¯1ï¼Œç¬¬äºŒæ­¥æŒ‰åœºæ™¯1æ“ä½œã€‚



```
git reset HEAD file  //é’ˆå¯¹æ’¤é”€add  æ²¡æœ‰å®Œæˆcommit

*********************ä¸‹é¢çš„ä¸‰ç§é’ˆå¯¹å®Œæˆ  å·¥ä½œåŒºä¿®æ”¹+add+commit****************
git reset --hard HEAD^   //å®Œå…¨æ¸…ç©º  å·¥ä½œåŒº+æš‚å­˜åŒº+HEADç§»åŠ¨
git reset --soft  HEAD^
git reset  --mixed HEAD^ 
```

ğŸ§  æ€»ç»“å¯¹æ¯”è¡¨

| å‘½ä»¤                         | HEAD ç§»åŠ¨ | æš‚å­˜åŒºå˜åŒ–          | å·¥ä½œåŒºå˜åŒ–         | å¤‡æ³¨                     |
| ---------------------------- | --------- | ------------------- | ------------------ | ------------------------ |
| `git reset HEAD <file>`      | âŒ         | å°†æ–‡ä»¶ unstage      | âŒ ä¿ç•™ä¿®æ”¹         | ç”¨äºå–æ¶ˆ `git add`       |
| `git reset --soft <commit>`  | âœ…         | ä¸å˜ï¼ˆä¿ç•™ stagedï¼‰ | âŒ ä¿ç•™ä¿®æ”¹         | æ”¹åŠ¨ä»åœ¨æš‚å­˜åŒº           |
| `git reset --mixed <commit>` | âœ…         | æ¸…ç©ºæš‚å­˜åŒº          | âŒ ä¿ç•™ä¿®æ”¹         | é»˜è®¤è¡Œä¸ºï¼Œæ”¹åŠ¨ä»å¯è§     |
| `git reset --hard <commit>`  | âœ…         | æ¸…ç©º                | âŒ æ¸…ç©ºï¼ˆè¿˜åŸæ–‡ä»¶ï¼‰ | æ”¹åŠ¨å½»åº•ä¸¢å¤±ï¼Œè¯·è°¨æ…ä½¿ç”¨ |









### 5 åˆ é™¤æ–‡ä»¶  ï¼ˆæœ¬åœ°åˆ é™¤äº† æœ¬åœ°ä»“åº“ä¹Ÿå¾—åˆ é™¤ï¼‰

```c
rm file
```

è¿™ä¸ªæ—¶å€™ï¼ŒGitçŸ¥é“ä½ åˆ é™¤äº†æ–‡ä»¶ï¼Œå› æ­¤ï¼Œå·¥ä½œåŒºå’Œç‰ˆæœ¬åº“å°±ä¸ä¸€è‡´äº†ï¼Œ

ç°åœ¨ä½ æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€æ˜¯ç¡®å®è¦ä»ç‰ˆæœ¬åº“ä¸­åˆ é™¤è¯¥æ–‡ä»¶ï¼Œé‚£å°±ç”¨å‘½ä»¤`git rm`åˆ æ‰ï¼Œå¹¶ä¸”`git commit`ï¼š

```c
$ git rm test.txt
rm 'test.txt'

$ git commit -m "remove test.txt"
[master d46f35e] remove test.txt
 1 file changed, 1 deletion(-)
 delete mode 100644 test.txt

```

 æ³¨æ„

ä»æ¥æ²¡æœ‰è¢«æ·»åŠ åˆ°ç‰ˆæœ¬åº“å°±è¢«åˆ é™¤çš„æ–‡ä»¶ï¼Œæ˜¯æ— æ³•æ¢å¤çš„ï¼

## 6.è¿œç¨‹ä»“åº“



1. ç¬¬1æ­¥ï¼šåˆ›å»ºSSH Keyã€‚åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰.sshç›®å½•ï¼Œå¦‚æœæœ‰ï¼Œå†çœ‹çœ‹è¿™ä¸ªç›®å½•ä¸‹æœ‰æ²¡æœ‰`id_rsa`å’Œ`id_rsa.pub`è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚æœå·²ç»æœ‰äº†ï¼Œå¯ç›´æ¥è·³åˆ°ä¸‹ä¸€æ­¥ã€‚å¦‚æœæ²¡æœ‰ï¼Œæ‰“å¼€Shellï¼ˆWindowsä¸‹æ‰“å¼€Git Bashï¼‰ï¼Œåˆ›å»ºSSH Keyï¼š

   

   ```c
   $ ssh-keygen -t rsa -C "youremail@example.com"
   ```

   

2. ç™»é™†GitHubï¼Œæ‰“å¼€â€œAccount settingsâ€ï¼Œâ€œSSH Keysâ€é¡µé¢ï¼š

   ç„¶åï¼Œç‚¹â€œAdd SSH Keyâ€ï¼Œå¡«ä¸Šä»»æ„Titleï¼Œåœ¨Keyæ–‡æœ¬æ¡†é‡Œç²˜è´´`id_rsa.pub`æ–‡ä»¶çš„å†…å®¹

### 1. æ·»åŠ è¿œç¨‹ä»“åº“

1. åˆ›å»ºè¿œç¨‹ä»“åº“

   ![github-create-repo-1](https://liaoxuefeng.com/books/git/remote/add-remote/new-repo.png)

2. åœ¨æœ¬åœ°å·¥ä½œåŒºå…³è”è¿œç¨‹ä»“åº“

   ```c
   
   git remote add origin git@ã€‚ã€‚ã€‚ã€‚
   ```

3. æ¨é€ 

   æŠŠæœ¬åœ°åº“çš„å†…å®¹æ¨é€åˆ°è¿œç¨‹ï¼Œç”¨`git push`å‘½ä»¤ï¼Œå®é™…ä¸Šæ˜¯æŠŠå½“å‰åˆ†æ”¯`master`æ¨é€åˆ°è¿œç¨‹ã€‚

   ```c
   git push -u origin master
   
   ```

4. åˆ é™¤è¿œç¨‹ä»“åº“ 

   å¦‚æœæ·»åŠ çš„æ—¶å€™æ·»åŠ é”™äº†  åƒåˆ é™¤

   ```c
   git remote -v //æŸ¥çœ‹
   ```

   

åˆ é™¤è¿œç¨‹åº“

å¦‚æœæ·»åŠ çš„æ—¶å€™åœ°å€å†™é”™äº†ï¼Œæˆ–è€…å°±æ˜¯æƒ³åˆ é™¤è¿œç¨‹åº“ï¼Œå¯ä»¥ç”¨`git remote rm <name>`å‘½ä»¤ã€‚ä½¿ç”¨å‰ï¼Œå»ºè®®å…ˆç”¨`git remote -v`æŸ¥çœ‹è¿œç¨‹åº“ä¿¡æ¯ï¼š

```c
$ git remote -v
origin  git@github.com:michaelliao/learn-git.git (fetch)
origin  git@github.com:michaelliao/learn-git.git (push)
```



ç„¶åï¼Œæ ¹æ®åå­—åˆ é™¤ï¼Œæ¯”å¦‚åˆ é™¤`origin`ï¼š

```c
$ git remote rm origin
```



æ­¤å¤„çš„â€œåˆ é™¤â€å…¶å®æ˜¯è§£é™¤äº†æœ¬åœ°å’Œè¿œç¨‹çš„ç»‘å®šå…³ç³»ï¼Œå¹¶ä¸æ˜¯ç‰©ç†ä¸Šåˆ é™¤äº†è¿œç¨‹åº“ã€‚è¿œç¨‹åº“æœ¬èº«å¹¶æ²¡æœ‰ä»»ä½•æ”¹åŠ¨ã€‚è¦çœŸæ­£åˆ é™¤è¿œç¨‹åº“ï¼Œéœ€è¦ç™»å½•åˆ°GitHubï¼Œåœ¨åå°é¡µé¢æ‰¾åˆ°åˆ é™¤æŒ‰é’®å†åˆ é™¤ã€‚

å°ç»“

è¦å…³è”ä¸€ä¸ªè¿œç¨‹åº“ï¼Œä½¿ç”¨å‘½ä»¤`git remote add origin git@server-name:path/repo-name.git`ï¼›

å…³è”ä¸€ä¸ªè¿œç¨‹åº“æ—¶å¿…é¡»ç»™è¿œç¨‹åº“æŒ‡å®šä¸€ä¸ªåå­—ï¼Œ`origin`æ˜¯é»˜è®¤ä¹ æƒ¯å‘½åï¼›

å…³è”åï¼Œä½¿ç”¨å‘½ä»¤`git push -u origin master`ç¬¬ä¸€æ¬¡æ¨é€`master`åˆ†æ”¯çš„æ‰€æœ‰å†…å®¹ï¼›

æ­¤åï¼Œæ¯æ¬¡æœ¬åœ°æäº¤åï¼Œåªè¦æœ‰å¿…è¦ï¼Œå°±å¯ä»¥ä½¿ç”¨å‘½ä»¤`git push origin master`æ¨é€æœ€æ–°ä¿®æ”¹ï¼›

### 2. ä»è¿œç¨‹ä»“åº“å…‹éš†



## 7.åˆ†æ”¯ç®¡ç†

### 1. åˆ›å»ºä¸åˆå¹¶åˆ†æ”¯





ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œ`master`åˆ†æ”¯æ˜¯ä¸€æ¡çº¿ï¼ŒGitç”¨`master`æŒ‡å‘æœ€æ–°çš„æäº¤ï¼Œå†ç”¨`HEAD`æŒ‡å‘`master`ï¼Œå°±èƒ½ç¡®å®šå½“å‰åˆ†æ”¯ï¼Œä»¥åŠå½“å‰åˆ†æ”¯çš„æäº¤ç‚¹ï¼š

```
                  HEAD
                    â”‚
                    â–¼
                 master
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”
â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚
â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜
```

æ¯æ¬¡æäº¤ï¼Œ`master`åˆ†æ”¯éƒ½ä¼šå‘å‰ç§»åŠ¨ä¸€æ­¥ï¼Œè¿™æ ·ï¼Œéšç€ä½ ä¸æ–­æäº¤ï¼Œ`master`åˆ†æ”¯çš„çº¿ä¹Ÿè¶Šæ¥è¶Šé•¿ã€‚

å½“æˆ‘ä»¬åˆ›å»ºæ–°çš„åˆ†æ”¯ï¼Œä¾‹å¦‚`dev`æ—¶ï¼ŒGitæ–°å»ºäº†ä¸€ä¸ªæŒ‡é’ˆå«`dev`ï¼ŒæŒ‡å‘`master`ç›¸åŒçš„æäº¤ï¼Œå†æŠŠ`HEAD`æŒ‡å‘`dev`ï¼Œå°±è¡¨ç¤ºå½“å‰åˆ†æ”¯åœ¨`dev`ä¸Šï¼š

```
                 master
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”
â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚
â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜
                    â–²
                    â”‚
                   dev
                    â–²
                    â”‚
                  HEAD
```

ä½ çœ‹ï¼ŒGitåˆ›å»ºä¸€ä¸ªåˆ†æ”¯å¾ˆå¿«ï¼Œå› ä¸ºé™¤äº†å¢åŠ ä¸€ä¸ª`dev`æŒ‡é’ˆï¼Œæ”¹æ”¹`HEAD`çš„æŒ‡å‘ï¼Œå·¥ä½œåŒºçš„æ–‡ä»¶éƒ½æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼

ä¸è¿‡ï¼Œä»ç°åœ¨å¼€å§‹ï¼Œå¯¹å·¥ä½œåŒºçš„ä¿®æ”¹å’Œæäº¤å°±æ˜¯é’ˆå¯¹`dev`åˆ†æ”¯äº†ï¼Œæ¯”å¦‚æ–°æäº¤ä¸€æ¬¡åï¼Œ`dev`æŒ‡é’ˆå¾€å‰ç§»åŠ¨ä¸€æ­¥ï¼Œè€Œ`master`æŒ‡é’ˆä¸å˜ï¼š

```
                 master
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”
â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚
â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜
                             â–²
                             â”‚
                            dev
                             â–²
                             â”‚
                           HEAD
```

å‡å¦‚æˆ‘ä»¬åœ¨`dev`ä¸Šçš„å·¥ä½œå®Œæˆäº†ï¼Œå°±å¯ä»¥æŠŠ`dev`åˆå¹¶åˆ°`master`ä¸Šã€‚Gitæ€ä¹ˆåˆå¹¶å‘¢ï¼Ÿæœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯ç›´æ¥æŠŠ`master`æŒ‡å‘`dev`çš„å½“å‰æäº¤ï¼Œå°±å®Œæˆäº†åˆå¹¶ï¼š

```
                           HEAD
                             â”‚
                             â–¼
                          master
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”
â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚
â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜
                             â–²
                             â”‚
                            dev
```

æ‰€ä»¥Gitåˆå¹¶åˆ†æ”¯ä¹Ÿå¾ˆå¿«ï¼å°±æ”¹æ”¹æŒ‡é’ˆï¼Œå·¥ä½œåŒºå†…å®¹ä¹Ÿä¸å˜ï¼

åˆå¹¶å®Œåˆ†æ”¯åï¼Œç”šè‡³å¯ä»¥åˆ é™¤`dev`åˆ†æ”¯ã€‚åˆ é™¤`dev`åˆ†æ”¯å°±æ˜¯æŠŠ`dev`æŒ‡é’ˆç»™åˆ æ‰ï¼Œåˆ æ‰åï¼Œæˆ‘ä»¬å°±å‰©ä¸‹äº†ä¸€æ¡`master`åˆ†æ”¯ï¼š

```
                           HEAD
                             â”‚
                             â–¼
                          master
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”
â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚
â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜
```

çœŸæ˜¯å¤ªç¥å¥‡äº†ï¼Œä½ çœ‹å¾—å‡ºæ¥æœ‰äº›æäº¤æ˜¯é€šè¿‡åˆ†æ”¯å®Œæˆçš„å—ï¼Ÿ

ä¸‹é¢å¼€å§‹å®æˆ˜ã€‚

```c
//åˆ›å»ºåˆ†æ”¯å¹¶è¿›å…¥
git checkout -b dev
git switch -c dev
//ç­‰åŒäº
git branch dev
git checkout dev



```



```c
git branch

```

`it branch`å‘½ä»¤ä¼šåˆ—å‡ºæ‰€æœ‰åˆ†æ”¯ï¼Œå½“å‰åˆ†æ”¯å‰é¢ä¼šæ ‡ä¸€ä¸ª`*`å·ã€‚

ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨`dev`åˆ†æ”¯ä¸Šæ­£å¸¸æäº¤ï¼Œ



```c
//ä¸€å®šè¦  add  commit  ä¸ç„¶ä¼šä¸¢å¤±
git add

git commit

    
//åˆ‡æ¢å›master
    
git checkout master 
git switch master
//åˆå¹¶åˆ†æ”¯
    
git merge dev
   
    
    
//åˆå¹¶å®Œåˆ†æ”¯åï¼Œç”šè‡³å¯ä»¥åˆ é™¤devåˆ†æ”¯ã€‚åˆ é™¤devåˆ†æ”¯å°±æ˜¯æŠŠdevæŒ‡é’ˆç»™åˆ æ‰ï¼Œåˆ æ‰åï¼Œæˆ‘ä»¬å°±å‰©ä¸‹äº†ä¸€æ¡masteråˆ†æ”¯ï¼š
git branch -d dev     
    
```





æˆ‘ä»¬æ³¨æ„åˆ°åˆ‡æ¢åˆ†æ”¯ä½¿ç”¨`git checkout <branch>`ï¼Œè€Œå‰é¢è®²è¿‡çš„æ’¤é”€ä¿®æ”¹åˆ™æ˜¯`git checkout -- <file>`ï¼ŒåŒä¸€ä¸ªå‘½ä»¤ï¼Œæœ‰ä¸¤ç§ä½œç”¨ï¼Œç¡®å®æœ‰ç‚¹ä»¤äººè¿·æƒ‘ã€‚



å®é™…ä¸Šï¼Œåˆ‡æ¢åˆ†æ”¯è¿™ä¸ªåŠ¨ä½œï¼Œç”¨`switch`æ›´ç§‘å­¦ã€‚å› æ­¤ï¼Œæœ€æ–°ç‰ˆæœ¬çš„Gitæä¾›äº†æ–°çš„`git switch`å‘½ä»¤æ¥åˆ‡æ¢åˆ†æ”¯ï¼š

åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ–°çš„`dev`åˆ†æ”¯ï¼Œå¯ä»¥ä½¿ç”¨ï¼š

  



å°ç»“

Gité¼“åŠ±å¤§é‡ä½¿ç”¨åˆ†æ”¯ï¼š

æŸ¥çœ‹åˆ†æ”¯ï¼š`git branch`

åˆ›å»ºåˆ†æ”¯ï¼š`git branch <name>`

åˆ‡æ¢åˆ†æ”¯ï¼š`git checkout <name>`æˆ–è€…`git switch <name>`

åˆ›å»º+åˆ‡æ¢åˆ†æ”¯ï¼š`git checkout -b <name>`æˆ–è€…`git switch -c <name>`

åˆå¹¶æŸåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯ï¼š`git merge <name>`

åˆ é™¤åˆ†æ”¯ï¼š`git branch -d <name>`



### 2. è§£å†³å†²çª



å½“Gitæ— æ³•è‡ªåŠ¨åˆå¹¶åˆ†æ”¯æ—¶ï¼Œå°±å¿…é¡»é¦–å…ˆè§£å†³å†²çªã€‚è§£å†³å†²çªåï¼Œå†æäº¤ï¼Œåˆå¹¶å®Œæˆã€‚

è§£å†³å†²çªå°±æ˜¯æŠŠGitåˆå¹¶å¤±è´¥çš„æ–‡ä»¶æ‰‹åŠ¨ç¼–è¾‘ä¸ºæˆ‘ä»¬å¸Œæœ›çš„å†…å®¹ï¼Œå†æäº¤ã€‚

ç”¨`git log --graph`å‘½ä»¤å¯ä»¥çœ‹åˆ°åˆ†æ”¯åˆå¹¶å›¾ã€‚



```c
//åˆ›å»ºæ–°åˆ†æ”¯  åœ¨æ–°åˆ†æ”¯ä¸Š
git switch -c fu1
echo >> "hello" hello.txt
git add 
git commit 
git switch  master
//æ­£å¸¸merge
git merge fu1
//ä½†æ˜¯å½“è¿˜æ²¡æœ‰merge  æ¥ç€ä¿®æ”¹hello.txt
git add
git commit 
//ç°åœ¨ï¼Œmasteråˆ†æ”¯å’Œfeature1åˆ†æ”¯å„è‡ªéƒ½åˆ†åˆ«æœ‰æ–°çš„æäº¤ï¼Œå˜æˆäº†è¿™æ ·ï¼š


```

ç°åœ¨ï¼Œ`master`åˆ†æ”¯å’Œ`feature1`åˆ†æ”¯å„è‡ªéƒ½åˆ†åˆ«æœ‰æ–°çš„æäº¤ï¼Œå˜æˆäº†è¿™æ ·ï¼š

```
                            HEAD
                              â”‚
                              â–¼
                           master
                              â”‚
                              â–¼
                            â”Œâ”€â”€â”€â”
                         â”Œâ”€â–¶â”‚   â”‚
â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”  â”‚  â””â”€â”€â”€â”˜
â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚â”€â”€â”€â–¶â”‚   â”‚â”€â”€â”¤
â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜  â”‚  â”Œâ”€â”€â”€â”
                         â””â”€â–¶â”‚   â”‚
                            â””â”€â”€â”€â”˜
                              â–²
                              â”‚
                          feature1
```

è¿™ç§æƒ…å†µä¸‹ï¼ŒGitæ— æ³•æ‰§è¡Œâ€œå¿«é€Ÿåˆå¹¶â€ï¼Œåªèƒ½è¯•å›¾æŠŠå„è‡ªçš„ä¿®æ”¹åˆå¹¶èµ·æ¥ï¼Œä½†è¿™ç§åˆå¹¶å°±å¯èƒ½ä¼šæœ‰å†²çªï¼Œæˆ‘ä»¬è¯•è¯•çœ‹ï¼š

git merge fu1

æœç„¶å†²çªäº†ï¼Gitå‘Šè¯‰æˆ‘ä»¬ï¼Œ`readme.txt`æ–‡ä»¶å­˜åœ¨å†²çªï¼Œå¿…é¡»æ‰‹åŠ¨è§£å†³å†²çªåå†æäº¤ã€‚`git status`ä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ä»¬å†²çªçš„æ–‡ä»¶ï¼š

```
$ git status
On branch master
Your branch is ahead of 'origin/master' by 2 commits.
  (use "git push" to publish your local commits)

You have unmerged paths.
  (fix conflicts and run "git commit")
  (use "git merge --abort" to abort the merge)

Unmerged paths:
  (use "git add <file>..." to mark resolution)

	both modified:   readme.txt

no changes added to commit (use "git add" and/or "git commit -a")

```

éœ€è¦æ‰‹åŠ¨ä¿®æ”¹å†²çªçš„æ–‡ä»¶  ç„¶åä¿å­˜

![image-20250717214435479](assets/image-20250717214435479.png)

ç”¨å¸¦å‚æ•°çš„`git log`ä¹Ÿå¯ä»¥çœ‹åˆ°åˆ†æ”¯çš„åˆå¹¶æƒ…å†µï¼š



```
$ git log --graph --pretty=oneline --abbrev-commit
```



```c
//åˆ é™¤åˆ†æ”¯
git branch -d fu1
```

å°ç»“

å½“Gitæ— æ³•è‡ªåŠ¨åˆå¹¶åˆ†æ”¯æ—¶ï¼Œå°±å¿…é¡»é¦–å…ˆè§£å†³å†²çªã€‚è§£å†³å†²çªåï¼Œå†æäº¤ï¼Œåˆå¹¶å®Œæˆã€‚

è§£å†³å†²çªå°±æ˜¯æŠŠGitåˆå¹¶å¤±è´¥çš„æ–‡ä»¶æ‰‹åŠ¨ç¼–è¾‘ä¸ºæˆ‘ä»¬å¸Œæœ›çš„å†…å®¹ï¼Œå†æäº¤ã€‚

### 3. åˆ†æ”¯ç®¡ç†ç­–ç•¥

é€šå¸¸ï¼Œåˆå¹¶åˆ†æ”¯æ—¶ï¼Œå¦‚æœå¯èƒ½ï¼ŒGitä¼šç”¨`Fast forward`æ¨¡å¼ï¼Œä½†è¿™ç§æ¨¡å¼ä¸‹ï¼Œåˆ é™¤åˆ†æ”¯åï¼Œä¼šä¸¢æ‰åˆ†æ”¯ä¿¡æ¯ã€‚

å¦‚æœè¦å¼ºåˆ¶ç¦ç”¨`Fast forward`æ¨¡å¼ï¼ŒGitå°±ä¼šåœ¨mergeæ—¶ç”Ÿæˆä¸€ä¸ªæ–°çš„commitï¼Œè¿™æ ·ï¼Œä»åˆ†æ”¯å†å²ä¸Šå°±å¯ä»¥çœ‹å‡ºåˆ†æ”¯ä¿¡æ¯ã€‚



å‡†å¤‡åˆå¹¶`dev`åˆ†æ”¯ï¼Œè¯·æ³¨æ„`--no-ff`å‚æ•°ï¼Œè¡¨ç¤ºç¦ç”¨`Fast forward`ï¼š

```c
$ git merge --no-ff -m "merge with no-ff" dev
```



![image-20250717214925333](assets/image-20250717214925333.png)



```c
$ git log --graph --pretty=oneline --abbrev-commit
*   e1e9c68 (HEAD -> master) merge with no-ff
|\  
| * f52c633 (dev) add merge
|/  
*   cf810e4 conflict fixed
...

```

åˆ†æ”¯ç­–ç•¥

é¦–å…ˆï¼Œ`master`åˆ†æ”¯åº”è¯¥æ˜¯éå¸¸ç¨³å®šçš„ï¼Œä¹Ÿå°±æ˜¯ä»…ç”¨æ¥å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œå¹³æ—¶ä¸èƒ½åœ¨ä¸Šé¢å¹²æ´»ï¼›

é‚£åœ¨å“ªå¹²æ´»å‘¢ï¼Ÿå¹²æ´»éƒ½åœ¨`dev`åˆ†æ”¯ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ`dev`åˆ†æ”¯æ˜¯ä¸ç¨³å®šçš„ï¼Œåˆ°æŸä¸ªæ—¶å€™ï¼Œæ¯”å¦‚1.0ç‰ˆæœ¬å‘å¸ƒæ—¶ï¼Œå†æŠŠ`dev`åˆ†æ”¯åˆå¹¶åˆ°`master`ä¸Šï¼Œåœ¨`master`åˆ†æ”¯å‘å¸ƒ1.0ç‰ˆæœ¬ï¼›

ä½ å’Œä½ çš„å°ä¼™ä¼´ä»¬æ¯ä¸ªäººéƒ½åœ¨`dev`åˆ†æ”¯ä¸Šå¹²æ´»ï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„åˆ†æ”¯ï¼Œæ—¶ä¸æ—¶åœ°å¾€`dev`åˆ†æ”¯ä¸Šåˆå¹¶å°±å¯ä»¥äº†ã€‚

 



å°ç»“

Gitåˆ†æ”¯ååˆ†å¼ºå¤§ï¼Œåœ¨å›¢é˜Ÿå¼€å‘ä¸­åº”è¯¥å……åˆ†åº”ç”¨ã€‚

åˆå¹¶åˆ†æ”¯æ—¶ï¼ŒåŠ ä¸Š`--no-ff`å‚æ•°å°±å¯ä»¥ç”¨æ™®é€šæ¨¡å¼åˆå¹¶ï¼Œåˆå¹¶åçš„å†å²æœ‰åˆ†æ”¯ï¼Œèƒ½çœ‹å‡ºæ¥æ›¾ç»åšè¿‡åˆå¹¶ï¼Œè€Œ`fast forward`åˆå¹¶å°±çœ‹ä¸å‡ºæ¥æ›¾ç»åšè¿‡åˆå¹¶ã€‚



### 4.Bugåˆ†æ”¯



è½¯ä»¶å¼€å‘ä¸­ï¼Œbugå°±åƒå®¶å¸¸ä¾¿é¥­ä¸€æ ·ã€‚æœ‰äº†bugå°±éœ€è¦ä¿®å¤ï¼Œåœ¨Gitä¸­ï¼Œç”±äºåˆ†æ”¯æ˜¯å¦‚æ­¤çš„å¼ºå¤§ï¼Œæ‰€ä»¥ï¼Œæ¯ä¸ªbugéƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªæ–°çš„ä¸´æ—¶åˆ†æ”¯æ¥ä¿®å¤ï¼Œä¿®å¤åï¼Œåˆå¹¶åˆ†æ”¯ï¼Œç„¶åå°†ä¸´æ—¶åˆ†æ”¯åˆ é™¤ã€‚

å½“ä½ æ¥åˆ°ä¸€ä¸ªä¿®å¤ä¸€ä¸ªä»£å·101çš„bugçš„ä»»åŠ¡æ—¶ï¼Œå¾ˆè‡ªç„¶åœ°ï¼Œä½ æƒ³åˆ›å»ºä¸€ä¸ªåˆ†æ”¯`issue-101`æ¥ä¿®å¤å®ƒï¼Œä½†æ˜¯ï¼Œç­‰ç­‰ï¼Œå½“å‰æ­£åœ¨`dev`ä¸Šè¿›è¡Œçš„å·¥ä½œè¿˜æ²¡æœ‰æäº¤ï¼š(  è¦ç¦»å¼€å½“å‰åˆ†æ”¯   åŒºmasteræˆ–è€…åˆ«çš„åˆ†æ”¯åˆ›å»ºissue-101åˆ†æ”¯ä¿®å¤bug   ä½†æ˜¯å½“å‰çš„å·¥ä½œæ²¡åšå®Œ ä¸æƒ³git add git commit  å¯ä»¥éšè—)

å¹¶ä¸æ˜¯ä½ ä¸æƒ³æäº¤ï¼Œè€Œæ˜¯å·¥ä½œåªè¿›è¡Œåˆ°ä¸€åŠï¼Œè¿˜æ²¡æ³•æäº¤ï¼Œé¢„è®¡å®Œæˆè¿˜éœ€1å¤©æ—¶é—´ã€‚ä½†æ˜¯ï¼Œå¿…é¡»åœ¨ä¸¤ä¸ªå°æ—¶å†…ä¿®å¤è¯¥bugï¼Œæ€ä¹ˆåŠï¼Ÿ

```
å¹¸å¥½ï¼ŒGitè¿˜æä¾›äº†ä¸€ä¸ªstashåŠŸèƒ½ï¼Œå¯ä»¥æŠŠå½“å‰å·¥ä½œç°åœºâ€œå‚¨è—â€èµ·æ¥ï¼Œç­‰ä»¥åæ¢å¤ç°åœºåç»§ç»­å·¥ä½œï¼š
git  stach
```

ç°åœ¨ï¼Œç”¨`git status`æŸ¥çœ‹å·¥ä½œåŒºï¼Œå°±æ˜¯å¹²å‡€çš„ï¼ˆé™¤éæœ‰æ²¡æœ‰è¢«Gitç®¡ç†çš„æ–‡ä»¶ï¼‰ï¼Œå› æ­¤å¯ä»¥æ”¾å¿ƒåœ°åˆ›å»ºåˆ†æ”¯æ¥ä¿®å¤bugã€‚



é¦–å…ˆç¡®å®šè¦åœ¨å“ªä¸ªåˆ†æ”¯ä¸Šä¿®å¤bugï¼Œå‡å®šéœ€è¦åœ¨`master`åˆ†æ”¯ä¸Šä¿®å¤ï¼Œå°±ä»`master`åˆ›å»ºä¸´æ—¶åˆ†æ”¯ï¼š

```c
//åœ¨devåˆ†æ”¯æš‚å­˜  æŠŠå½“å‰å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„æ”¹åŠ¨éƒ½ä¿å­˜åˆ°ä¸€ä¸ªâ€œä¸´æ—¶å †æ ˆâ€é‡Œï¼›å½“å‰åˆ†æ”¯ï¼ˆæ¯”å¦‚ devï¼‰çš„çŠ¶æ€ä¼šæ¢å¤æˆå¹²å‡€çŠ¶æ€ï¼›æ”¹åŠ¨å†…å®¹ä¸ä¼šä¸¢ï¼Œåªæ˜¯ä¸´æ—¶è—èµ·æ¥äº†ã€‚
git stash  //git stash save "name"  å½“å‰åœ¨ dev åˆ†æ”¯ï¼Œä¿å­˜å½“å‰å·¥ä½œç°åœº
    
//# åˆ‡æ¢åˆ° masterï¼Œä¿®å¤ bug
git checkout master
git checkout -b issue-101  //åˆ›å»º

 git add readme.txt 
 git commit -m "fix bug 101"
 
 //ä¿®å¤å®Œæˆåï¼Œåˆ‡æ¢åˆ°masteråˆ†æ”¯ï¼Œå¹¶å®Œæˆåˆå¹¶ï¼Œæœ€ååˆ é™¤issue-101åˆ†æ”¯ï¼š
 git switch master
 git merge --no-ff -m "merged bug fix 101" issue-101
 git branch -d issue-101 
 
 //å¤ªæ£’äº†ï¼ŒåŸè®¡åˆ’ä¸¤ä¸ªå°æ—¶çš„bugä¿®å¤åªèŠ±äº†5åˆ†é’Ÿï¼ç°åœ¨ï¼Œæ˜¯æ—¶å€™æ¥ç€å›åˆ°devåˆ†æ”¯å¹²æ´»äº†ï¼
 git switch dev
 
 //å·¥ä½œåŒºæ˜¯å¹²å‡€çš„ï¼Œåˆšæ‰çš„å·¥ä½œç°åœºå­˜åˆ°å“ªå»äº†ï¼Ÿç”¨git stash listå‘½ä»¤çœ‹çœ‹ï¼š
 git stash list
 
 
 //å·¥ä½œç°åœºè¿˜åœ¨ï¼ŒGitæŠŠstashå†…å®¹å­˜åœ¨æŸä¸ªåœ°æ–¹äº†ï¼Œä½†æ˜¯éœ€è¦æ¢å¤ä¸€ä¸‹ï¼Œæœ‰ä¸¤ä¸ªåŠæ³•ï¼šä¸€æ˜¯ç”¨git stash applyæ¢å¤ï¼Œä½†æ˜¯æ¢å¤åï¼Œstashå†…å®¹å¹¶ä¸åˆ é™¤ï¼Œä½ éœ€è¦ç”¨git stash dropæ¥åˆ é™¤ï¼›å¦ä¸€ç§æ–¹å¼æ˜¯ç”¨git stash popï¼Œæ¢å¤çš„åŒæ—¶æŠŠstashå†…å®¹ä¹Ÿåˆ äº†ï¼š
git stash pop  

// æŠŠ master ä¸Šçš„ä¿®å¤åŒæ­¥è¿› dev
git cherry-pick <ä¿®å¤çš„ commit hash>
```



```c
//ä½ å¯ä»¥å¤šæ¬¡stashï¼Œæ¢å¤çš„æ—¶å€™ï¼Œå…ˆç”¨git stash listæŸ¥çœ‹ï¼Œç„¶åæ¢å¤æŒ‡å®šçš„stashï¼Œç”¨å‘½ä»¤ï¼š
$ git stash list

    /*
stash@{0}: On dev: save dev wip
stash@{1}: On main: fix bug
    */
    
$ git stash apply stash@{0}  //å›å¤æŒ‡å®šç‰ˆæœ¬

```

åœ¨`master`åˆ†æ”¯ä¸Šä¿®å¤äº†bugåï¼Œæˆ‘ä»¬è¦æƒ³ä¸€æƒ³ï¼Œ`dev`åˆ†æ”¯æ˜¯æ—©æœŸä»`master`åˆ†æ”¯åˆ†å‡ºæ¥çš„ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªbugå…¶å®åœ¨å½“å‰`dev`åˆ†æ”¯ä¸Šä¹Ÿå­˜åœ¨ã€‚

é‚£æ€ä¹ˆåœ¨`dev`åˆ†æ”¯ä¸Šä¿®å¤åŒæ ·çš„bugï¼Ÿé‡å¤æ“ä½œä¸€æ¬¡ï¼Œæäº¤ä¸å°±è¡Œäº†ï¼Ÿ

æœ‰æœ¨æœ‰æ›´ç®€å•çš„æ–¹æ³•ï¼Ÿ



åŒæ ·çš„bugï¼Œè¦åœ¨`dev`ä¸Šä¿®å¤ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠ`4c805e2 fix bug 101`è¿™ä¸ªæäº¤æ‰€åšçš„ä¿®æ”¹â€œå¤åˆ¶â€åˆ°`dev`åˆ†æ”¯ã€‚æ³¨æ„ï¼šæˆ‘ä»¬åªæƒ³å¤åˆ¶`4c805e2 fix bug 101`è¿™ä¸ªæäº¤æ‰€åšçš„ä¿®æ”¹ï¼Œå¹¶ä¸æ˜¯æŠŠæ•´ä¸ª`master`åˆ†æ”¯mergeè¿‡æ¥ã€‚

ä¸ºäº†æ–¹ä¾¿æ“ä½œï¼ŒGitä¸“é—¨æä¾›äº†ä¸€ä¸ª`cherry-pick`å‘½ä»¤ï¼Œè®©æˆ‘ä»¬èƒ½å¤åˆ¶ä¸€ä¸ªç‰¹å®šçš„æäº¤åˆ°å½“å‰åˆ†æ”¯ï¼š

```c
git branch
* dev
  master
git cherry-pick 4c805e2 //commit id  Gitè‡ªåŠ¨ç»™`dev`åˆ†æ”¯åšäº†ä¸€æ¬¡æäº¤ï¼Œæ³¨æ„è¿™æ¬¡æäº¤çš„commitæ˜¯`1d4b803`
```

Gitè‡ªåŠ¨ç»™`dev`åˆ†æ”¯åšäº†ä¸€æ¬¡æäº¤ï¼Œæ³¨æ„è¿™æ¬¡æäº¤çš„commitæ˜¯`1d4b803`ï¼Œå®ƒå¹¶ä¸åŒäº`master`çš„`4c805e2`ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªcommitåªæ˜¯æ”¹åŠ¨ç›¸åŒï¼Œä½†ç¡®å®æ˜¯ä¸¤ä¸ªä¸åŒçš„commitã€‚ç”¨`git cherry-pick`ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦åœ¨`dev`åˆ†æ”¯ä¸Šæ‰‹åŠ¨å†æŠŠä¿®bugçš„è¿‡ç¨‹é‡å¤ä¸€éã€‚





æœ‰äº›èªæ˜çš„ç«¥é‹ä¼šæƒ³äº†ï¼Œæ—¢ç„¶å¯ä»¥åœ¨`master`åˆ†æ”¯ä¸Šä¿®å¤bugåï¼Œåœ¨`dev`åˆ†æ”¯ä¸Šå¯ä»¥â€œé‡æ”¾â€è¿™ä¸ªä¿®å¤è¿‡ç¨‹ï¼Œé‚£ä¹ˆç›´æ¥åœ¨`dev`åˆ†æ”¯ä¸Šä¿®å¤bugï¼Œç„¶ååœ¨`master`åˆ†æ”¯ä¸Šâ€œé‡æ”¾â€è¡Œä¸è¡Œï¼Ÿå½“ç„¶å¯ä»¥ï¼Œä¸è¿‡ä½ ä»ç„¶éœ€è¦`git stash`å‘½ä»¤ä¿å­˜ç°åœºï¼Œæ‰èƒ½ä»`dev`åˆ†æ”¯åˆ‡æ¢åˆ°`master`åˆ†æ”¯ã€‚



ä¿®å¤bugæ—¶ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡åˆ›å»ºæ–°çš„bugåˆ†æ”¯è¿›è¡Œä¿®å¤ï¼Œç„¶ååˆå¹¶ï¼Œæœ€ååˆ é™¤ï¼›

å½“æ‰‹å¤´å·¥ä½œæ²¡æœ‰å®Œæˆæ—¶ï¼Œå…ˆæŠŠå·¥ä½œç°åœº`git stash`ä¸€ä¸‹ï¼Œç„¶åå»ä¿®å¤bugï¼Œä¿®å¤åï¼Œå†`git stash pop`ï¼Œå›åˆ°å·¥ä½œç°åœºï¼›

åœ¨`master`åˆ†æ”¯ä¸Šä¿®å¤çš„bugï¼Œæƒ³è¦åˆå¹¶åˆ°å½“å‰`dev`åˆ†æ”¯ï¼Œå¯ä»¥ç”¨`git cherry-pick <commit>`å‘½ä»¤ï¼ŒæŠŠbugæäº¤çš„ä¿®æ”¹â€œå¤åˆ¶â€åˆ°å½“å‰åˆ†æ”¯ï¼Œé¿å…é‡å¤åŠ³åŠ¨ã€‚



æ€»ç»“ï¼šä»€ä¹ˆæ—¶å€™åœ¨ dev ä¿®ï¼Œä»€ä¹ˆæ—¶å€™åœ¨ master ä¿®ï¼Ÿ

| åœºæ™¯                           | ä¿®å¤ä½ç½®                                                 | æ˜¯å¦éœ€è¦åŒæ­¥        |
| ------------------------------ | -------------------------------------------------------- | ------------------- |
| ä»… dev æœ‰ bugï¼ˆæ–°åŠŸèƒ½å¼•å…¥ï¼‰    | dev ä¿®                                                   | ä¸éœ€è¦åŒæ­¥åˆ° master |
| master å’Œ dev éƒ½æœ‰ bug         | æ¨èï¼šåœ¨ master ä¿®ï¼Œå† cherry-pick åˆ° dev                |                     |
| åªåœ¨ dev ä¿®ï¼Œä½†æƒ³åŒæ­¥åˆ° master | å…è®¸ï¼Œä½†è¦ cherry-pickï¼ŒåªæŒ‘å‡ºä¿®å¤ï¼Œä¸å¸¦å…¥å…¶ä»–æœªå®Œæˆå¼€å‘ |                     |





### 5. Featureåˆ†æ”¯

æ·»åŠ ä¸€ä¸ªæ–°åŠŸèƒ½æ—¶ï¼Œä½ è‚¯å®šä¸å¸Œæœ›å› ä¸ºä¸€äº›å®éªŒæ€§è´¨çš„ä»£ç ï¼ŒæŠŠä¸»åˆ†æ”¯æä¹±äº†ï¼Œæ‰€ä»¥ï¼Œæ¯æ·»åŠ ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œæœ€å¥½æ–°å»ºä¸€ä¸ªfeatureåˆ†æ”¯ï¼Œåœ¨ä¸Šé¢å¼€å‘ï¼Œå®Œæˆåï¼Œåˆå¹¶ï¼Œæœ€åï¼Œåˆ é™¤è¯¥featureåˆ†æ”¯ã€‚







```c
 git switch -c feature-vulcan
 $ git add vulcan.py

$ git status
     $ git commit -m "add feature vulcan"
     
 $ git switch dev
    /*
    ä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œfeatureåˆ†æ”¯å’Œbugåˆ†æ”¯æ˜¯ç±»ä¼¼çš„ï¼Œåˆå¹¶ï¼Œç„¶ååˆ é™¤ã€‚
ä½†æ˜¯ï¼
å°±åœ¨æ­¤æ—¶ï¼Œæ¥åˆ°ä¸Šçº§å‘½ä»¤ï¼Œå› ç»è´¹ä¸è¶³ï¼Œæ–°åŠŸèƒ½å¿…é¡»å–æ¶ˆï¼
è™½ç„¶ç™½å¹²äº†ï¼Œä½†æ˜¯è¿™ä¸ªåŒ…å«æœºå¯†èµ„æ–™çš„åˆ†æ”¯è¿˜æ˜¯å¿…é¡»å°±åœ°é”€æ¯ï¼š
    */
 git branch -d feature-vulcan    
     /*
     é”€æ¯å¤±è´¥ã€‚Gitå‹æƒ…æé†’ï¼Œfeature-vulcanåˆ†æ”¯è¿˜æ²¡æœ‰è¢«åˆå¹¶ï¼Œå¦‚æœåˆ é™¤ï¼Œå°†ä¸¢å¤±æ‰ä¿®æ”¹ï¼Œå¦‚æœè¦å¼ºè¡Œåˆ é™¤ï¼Œéœ€è¦ä½¿ç”¨å¤§å†™çš„-Då‚æ•°ã€‚ã€‚
     */
     git branch -D feature-vulcan
```



å¦‚æœè¦ä¸¢å¼ƒä¸€ä¸ªæ²¡æœ‰è¢«åˆå¹¶è¿‡çš„åˆ†æ”¯ï¼Œå¯ä»¥é€šè¿‡`git branch -D <name>`å¼ºè¡Œåˆ é™¤ã€‚

### 6. å¤šäººåä½œ





æ¨é€åˆ†æ”¯

æ¨é€åˆ†æ”¯ï¼Œå°±æ˜¯æŠŠè¯¥åˆ†æ”¯ä¸Šçš„æ‰€æœ‰æœ¬åœ°æäº¤æ¨é€åˆ°è¿œç¨‹åº“ã€‚æ¨é€æ—¶ï¼Œè¦æŒ‡å®šæœ¬åœ°åˆ†æ”¯ï¼Œè¿™æ ·ï¼ŒGitå°±ä¼šæŠŠè¯¥åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹åº“å¯¹åº”çš„è¿œç¨‹åˆ†æ”¯ä¸Šï¼š

```
git  push origin(è¿œç¨‹ä»“åº“é»˜è®¤åå­—) master(æœ¬åœ°åˆ†æ”¯)
```

```
git push origin dev
```

ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯ä¸€å®šè¦æŠŠæœ¬åœ°åˆ†æ”¯å¾€è¿œç¨‹æ¨é€ï¼Œé‚£ä¹ˆï¼Œå“ªäº›åˆ†æ”¯éœ€è¦æ¨é€ï¼Œå“ªäº›ä¸éœ€è¦å‘¢ï¼Ÿ

- `master`åˆ†æ”¯æ˜¯ä¸»åˆ†æ”¯ï¼Œå› æ­¤è¦æ—¶åˆ»ä¸è¿œç¨‹åŒæ­¥ï¼›
- `dev`åˆ†æ”¯æ˜¯å¼€å‘åˆ†æ”¯ï¼Œå›¢é˜Ÿæ‰€æœ‰æˆå‘˜éƒ½éœ€è¦åœ¨ä¸Šé¢å·¥ä½œï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦ä¸è¿œç¨‹åŒæ­¥ï¼›
- bugåˆ†æ”¯åªç”¨äºåœ¨æœ¬åœ°ä¿®å¤bugï¼Œå°±æ²¡å¿…è¦æ¨åˆ°è¿œç¨‹äº†ï¼Œé™¤éè€æ¿è¦çœ‹çœ‹ä½ æ¯å‘¨åˆ°åº•ä¿®å¤äº†å‡ ä¸ªbugï¼›
- featureåˆ†æ”¯æ˜¯å¦æ¨åˆ°è¿œç¨‹ï¼Œå–å†³äºä½ æ˜¯å¦å’Œä½ çš„å°ä¼™ä¼´åˆä½œåœ¨ä¸Šé¢å¼€å‘ã€‚

æ€»ä¹‹ï¼Œå°±æ˜¯åœ¨Gitä¸­ï¼Œåˆ†æ”¯å®Œå…¨å¯ä»¥åœ¨æœ¬åœ°è‡ªå·±è—ç€ç©ï¼Œæ˜¯å¦æ¨é€ï¼Œè§†ä½ çš„å¿ƒæƒ…è€Œå®šï¼



æŠ“å–åˆ†æ”¯

å¤šäººåä½œæ—¶ï¼Œå¤§å®¶éƒ½ä¼šå¾€`master`å’Œ`dev`åˆ†æ”¯ä¸Šæ¨é€å„è‡ªçš„ä¿®æ”¹ã€‚

ç°åœ¨ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªä½ çš„å°ä¼™ä¼´ï¼Œå¯ä»¥åœ¨å¦ä¸€å°ç”µè„‘ï¼ˆæ³¨æ„è¦æŠŠSSH Keyæ·»åŠ åˆ°GitHubï¼‰æˆ–è€…åŒä¸€å°ç”µè„‘çš„å¦ä¸€ä¸ªç›®å½•ä¸‹å…‹éš†ï¼š

```c
//å½“ä½ çš„å°ä¼™ä¼´ä»è¿œç¨‹åº“cloneæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä½ çš„å°ä¼™ä¼´åªèƒ½çœ‹åˆ°æœ¬åœ°çš„masteråˆ†æ”¯
git branch

//ä½ çš„å°ä¼™ä¼´è¦åœ¨devåˆ†æ”¯ä¸Šå¼€å‘ï¼Œå°±å¿…é¡»åˆ›å»ºè¿œç¨‹originçš„devåˆ†æ”¯åˆ°æœ¬åœ°ï¼Œäºæ˜¯ä»–ç”¨è¿™ä¸ªå‘½ä»¤åˆ›å»ºæœ¬åœ°devåˆ†æ”¯ï¼š
$ git checkout -b dev origin/dev
//ä»–å°±å¯ä»¥åœ¨devä¸Šç»§ç»­ä¿®æ”¹ï¼Œç„¶åï¼Œæ—¶ä¸æ—¶åœ°æŠŠdevåˆ†æ”¯pushåˆ°è¿œç¨‹ï¼š
git add env.txt
git commit -m "add env"
 git push origin dev

//ä½ çš„å°ä¼™ä¼´å·²ç»å‘origin/devåˆ†æ”¯æ¨é€äº†ä»–çš„æäº¤ï¼Œè€Œç¢°å·§ä½ ä¹Ÿå¯¹åŒæ ·çš„æ–‡ä»¶ä½œäº†ä¿®æ”¹ï¼Œå¹¶è¯•å›¾æ¨é€ï¼š

$ git add env.txt
$ git commit -m "add new env"
$ git push origin dev

//æ¨é€å¤±è´¥ï¼Œå› ä¸ºä½ çš„å°ä¼™ä¼´çš„æœ€æ–°æäº¤å’Œä½ è¯•å›¾æ¨é€çš„æäº¤æœ‰å†²çªï¼Œè§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼ŒGitå·²ç»æç¤ºæˆ‘ä»¬ï¼Œå…ˆç”¨git pullæŠŠæœ€æ–°çš„æäº¤ä»origin/devæŠ“ä¸‹æ¥ï¼Œç„¶åï¼Œåœ¨æœ¬åœ°åˆå¹¶ï¼Œè§£å†³å†²çªï¼Œå†æ¨é€ï¼š

$ git pull
 git branch --set-upstream-to=origin/dev dev//git pullä¹Ÿå¤±è´¥äº†ï¼ŒåŸå› æ˜¯æ²¡æœ‰æŒ‡å®šæœ¬åœ°devåˆ†æ”¯ä¸è¿œç¨‹origin/devåˆ†æ”¯çš„é“¾æ¥ï¼Œæ ¹æ®æç¤ºï¼Œè®¾ç½®devå’Œorigin/devçš„é“¾æ¥ï¼š
   $ git pull
    
   ///è¿™å›git pullæˆåŠŸï¼Œä½†æ˜¯åˆå¹¶æœ‰å†²çªï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³ï¼Œè§£å†³çš„æ–¹æ³•å’Œåˆ†æ”¯ç®¡ç†ä¸­çš„è§£å†³å†²çªå®Œå…¨ä¸€æ ·ã€‚è§£å†³åï¼Œæäº¤ï¼Œå†pushï¼š 
    $ git commit -m "fix env conflict"
    $ git push origin dev
```

å› æ­¤ï¼Œå¤šäººåä½œçš„å·¥ä½œæ¨¡å¼é€šå¸¸æ˜¯è¿™æ ·ï¼š

1. é¦–å…ˆï¼Œå¯ä»¥å°è¯•ç”¨`git push origin <branch-name>`æ¨é€è‡ªå·±çš„ä¿®æ”¹ï¼›
2. å¦‚æœæ¨é€å¤±è´¥ï¼Œåˆ™å› ä¸ºè¿œç¨‹åˆ†æ”¯æ¯”ä½ çš„æœ¬åœ°æ›´æ–°ï¼Œéœ€è¦å…ˆç”¨`git pull`è¯•å›¾åˆå¹¶ï¼›
3. å¦‚æœåˆå¹¶æœ‰å†²çªï¼Œåˆ™è§£å†³å†²çªï¼Œå¹¶åœ¨æœ¬åœ°æäº¤ï¼›
4. æ²¡æœ‰å†²çªæˆ–è€…è§£å†³æ‰å†²çªåï¼Œå†ç”¨`git push origin <branch-name>`æ¨é€å°±èƒ½æˆåŠŸï¼

å¦‚æœ`git pull`æç¤º`no tracking information`ï¼Œåˆ™è¯´æ˜æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„é“¾æ¥å…³ç³»æ²¡æœ‰åˆ›å»ºï¼Œç”¨å‘½ä»¤`git branch --set-upstream-to <branch-name> origin/<branch-name>`ã€‚

è¿™å°±æ˜¯å¤šäººåä½œçš„å·¥ä½œæ¨¡å¼ï¼Œä¸€æ—¦ç†Ÿæ‚‰äº†ï¼Œå°±éå¸¸ç®€å•ã€‚

å°ç»“

- æŸ¥çœ‹è¿œç¨‹åº“ä¿¡æ¯ï¼Œä½¿ç”¨`git remote -v`ï¼›
- æœ¬åœ°æ–°å»ºçš„åˆ†æ”¯å¦‚æœä¸æ¨é€åˆ°è¿œç¨‹ï¼Œå¯¹å…¶ä»–äººå°±æ˜¯ä¸å¯è§çš„ï¼›
- ä»æœ¬åœ°æ¨é€åˆ†æ”¯ï¼Œä½¿ç”¨`git push origin branch-name`ï¼Œå¦‚æœæ¨é€å¤±è´¥ï¼Œå…ˆç”¨`git pull`æŠ“å–è¿œç¨‹çš„æ–°æäº¤ï¼›
- åœ¨æœ¬åœ°åˆ›å»ºå’Œè¿œç¨‹åˆ†æ”¯å¯¹åº”çš„åˆ†æ”¯ï¼Œä½¿ç”¨`git checkout -b branch-name origin/branch-name`ï¼Œæœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯çš„åç§°æœ€å¥½ä¸€è‡´ï¼›
- å»ºç«‹æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„å…³è”ï¼Œä½¿ç”¨`git branch --set-upstream branch-name origin/branch-name`ï¼›
- ä»è¿œç¨‹æŠ“å–åˆ†æ”¯ï¼Œä½¿ç”¨`git pull`ï¼Œå¦‚æœæœ‰å†²çªï¼Œè¦å…ˆå¤„ç†å†²çªã€‚



```c
ä¸ºä»€ä¹ˆå push çš„äººéœ€è¦å…ˆ pullï¼Ÿ
å½“å¤šäººåä½œæ—¶ï¼Œå‡è®¾ä½ å’ŒåŒäº‹éƒ½åœ¨ dev åˆ†æ”¯ä¸Šå·¥ä½œï¼š

åˆå§‹çŠ¶æ€ï¼šè¿œç¨‹ä»“åº“å’Œä½ ä»¬æœ¬åœ°çš„ dev åˆ†æ”¯éƒ½æ˜¯ç‰ˆæœ¬ A

åŒäº‹å…ˆæ¨é€ï¼š

åŒäº‹ä¿®æ”¹ä»£ç å¹¶æäº¤åˆ°æœ¬åœ°ï¼ˆç‰ˆæœ¬ Bï¼‰

åŒäº‹æ‰§è¡Œ git push origin dev æˆåŠŸï¼Œè¿œç¨‹ä»“åº“æ›´æ–°ä¸ºç‰ˆæœ¬ B

ä½ ä¹Ÿä¿®æ”¹äº†ä»£ç ï¼š

ä½ åŸºäºç‰ˆæœ¬ A ä¿®æ”¹äº†ä»£ç å¹¶æäº¤åˆ°æœ¬åœ°ï¼ˆç‰ˆæœ¬ Cï¼‰

å½“ä½ å°è¯• git push origin dev æ—¶ï¼ŒGit ä¼šæ‹’ç»ä½ çš„æ¨é€

Git ä¸ºä»€ä¹ˆä¼šæ‹’ç»ä½ çš„æ¨é€ï¼Ÿ
å› ä¸º Git å‘ç°è¿œç¨‹ä»“åº“çš„ dev åˆ†æ”¯ï¼ˆç‰ˆæœ¬ Bï¼‰å·²ç»ä¸æ˜¯ä½ ä¸Šæ¬¡æ‹‰å–æ—¶çš„çŠ¶æ€ï¼ˆç‰ˆæœ¬ Aï¼‰äº†ã€‚Git è¦æ±‚ä½ å¿…é¡»å…ˆåˆå¹¶è¿œç¨‹çš„æœ€æ–°æ›´æ”¹ï¼ˆç‰ˆæœ¬ Bï¼‰åˆ°ä½ çš„æœ¬åœ°åˆ†æ”¯ï¼ˆç‰ˆæœ¬ Cï¼‰ï¼Œç„¶åæ‰èƒ½æ¨é€ã€‚

å…·ä½“æµç¨‹
ä½ å°è¯•æ¨é€ï¼š

bash
git push origin dev
ä¼šæ”¶åˆ°ç±»ä¼¼è¿™æ ·çš„é”™è¯¯ï¼š

text
! [rejected]        dev -> dev (non-fast-forward)
Git æç¤ºä½ éœ€è¦å…ˆ pullï¼š

text
hint: Updates were rejected because the tip of your current branch is behind
hint: its remote counterpart. Integrate the remote changes (e.g.
hint: 'git pull ...') before pushing again.
ä½ æ‰§è¡Œ pull æ“ä½œï¼š

bash
git pull origin dev
è¿™ç›¸å½“äºï¼š

git fetch origin devï¼ˆè·å–è¿œç¨‹æœ€æ–°ä»£ç ï¼‰

git merge origin/devï¼ˆå°†è¿œç¨‹å˜æ›´åˆå¹¶åˆ°æœ¬åœ°ï¼‰

è¿™æ—¶æœ‰ä¸¤ç§æƒ…å†µï¼š

æ²¡æœ‰å†²çªï¼šGit ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåˆå¹¶æäº¤ï¼ˆç‰ˆæœ¬ Dï¼ŒåŒ…å« B å’Œ C çš„ä¿®æ”¹ï¼‰

æœ‰å†²çªï¼šéœ€è¦æ‰‹åŠ¨è§£å†³å†²çªï¼ˆå¦‚å‰ä¸€èŠ‚æ‰€è¿°ï¼‰

è§£å†³å†²çªåï¼ˆå¦‚æœ‰ï¼‰ï¼Œæäº¤åˆå¹¶ç»“æœï¼š

bash
git commit -m "Merge remote changes"
æœ€åæ¨é€ï¼š

bash
git push origin dev
ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ
è¿™ç§æœºåˆ¶æ˜¯ Git çš„é‡è¦å®‰å…¨ç‰¹æ€§ï¼š

é˜²æ­¢æ„å¤–è¦†ç›–ä»–äººçš„å·¥ä½œ

ç¡®ä¿å†å²è®°å½•çš„å®Œæ•´æ€§

å¼ºåˆ¶å¼€å‘è€…æ„è¯†åˆ°å¹¶å¤„ç†ä»£ç å˜æ›´ä¹‹é—´çš„äº¤äº’

å®é™…å·¥ä½œä¸­çš„å»ºè®®
å¼€å§‹å·¥ä½œå‰å…ˆ pullï¼šgit pull origin dev è·å–æœ€æ–°ä»£ç 

é¢‘ç¹æäº¤å’Œæ¨é€ï¼šå‡å°‘å¤§èŒƒå›´å†²çªçš„å¯èƒ½æ€§

å°æ­¥æäº¤ï¼šæ¯æ¬¡æäº¤åªåšä¸€ä¸ªå°åŠŸèƒ½çš„ä¿®æ”¹ï¼Œå†²çªæ›´å®¹æ˜“è§£å†³

è¿™ç§å·¥ä½œæµè™½ç„¶æœ‰æ—¶æ˜¾å¾—ç¹çï¼Œä½†èƒ½æœ‰æ•ˆé˜²æ­¢ä»£ç ä¸¢å¤±å’Œå†²çªï¼Œæ˜¯å¤šäººåä½œçš„å¿…è¦æµç¨‹ã€‚
```







### 7.Rebase

åœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬çœ‹åˆ°äº†ï¼Œå¤šäººåœ¨åŒä¸€ä¸ªåˆ†æ”¯ä¸Šåä½œæ—¶ï¼Œå¾ˆå®¹æ˜“å‡ºç°å†²çªã€‚å³ä½¿æ²¡æœ‰å†²çªï¼Œåpushçš„ç«¥é‹ä¸å¾—ä¸å…ˆpullï¼Œåœ¨æœ¬åœ°åˆå¹¶ï¼Œç„¶åæ‰èƒ½pushæˆåŠŸã€‚





### å°ç»“

- rebaseæ“ä½œå¯ä»¥æŠŠæœ¬åœ°æœªpushçš„åˆ†å‰æäº¤å†å²æ•´ç†æˆç›´çº¿ï¼›
- rebaseçš„ç›®çš„æ˜¯ä½¿å¾—æˆ‘ä»¬åœ¨æŸ¥çœ‹å†å²æäº¤çš„å˜åŒ–æ—¶æ›´å®¹æ˜“ï¼Œå› ä¸ºåˆ†å‰çš„æäº¤éœ€è¦ä¸‰æ–¹å¯¹æ¯”ã€‚

## 2. æ ‡ç­¾ç®¡ç†

Git æ ‡ç­¾ï¼ˆTagï¼‰ç¡®å®æ˜¯ä¸ºäº†æ›´æ–¹ä¾¿åœ°ç®¡ç† commitï¼Œç‰¹åˆ«æ˜¯åœ¨ç‰ˆæœ¬å‘å¸ƒå’Œé‡è¦èŠ‚ç‚¹æ ‡è®°æ–¹é¢éå¸¸æœ‰ç”¨ã€‚ä¸‹é¢æˆ‘ä¼šè¯¦ç»†è§£é‡Šæ ‡ç­¾çš„ä½œç”¨ã€ä½¿ç”¨åœºæ™¯ä»¥åŠå…·ä½“æ“ä½œã€‚

**Git æ ‡ç­¾çš„ä½œç”¨**

æ ‡ç­¾ï¼ˆTagï¼‰æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª**æŒ‡å‘ç‰¹å®š commit(é»˜è®¤å½“å‰HEAD) çš„ä¸å¯å˜å¼•ç”¨**ï¼ˆç±»ä¼¼äºåˆ†æ”¯ï¼Œä½†ä¸ä¼šç§»åŠ¨ï¼‰ã€‚å®ƒçš„ä¸»è¦ç”¨é€”åŒ…æ‹¬ï¼š

**1. æ ‡è®°é‡è¦ç‰ˆæœ¬ï¼ˆå¦‚è½¯ä»¶å‘å¸ƒï¼‰**

- ä¾‹å¦‚ `v1.0.0`ã€`v2.3.1` ç­‰ï¼Œæ–¹ä¾¿å¿«é€Ÿæ‰¾åˆ°æŸä¸ªå‘å¸ƒç‰ˆæœ¬å¯¹åº”çš„ä»£ç ã€‚
- æ¯”ç›´æ¥è®°å¿† commit hashï¼ˆå¦‚ `a1b2c3d`ï¼‰æ›´ç›´è§‚ã€‚

**2. æ–¹ä¾¿å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬**

- å¦‚æœçº¿ä¸Šç‰ˆæœ¬ `v1.2.0` å‡ºç° Bugï¼Œå¯ä»¥ç›´æ¥æ£€å‡ºï¼ˆ`git checkout v1.2.0`ï¼‰è¿›è¡Œä¿®å¤ï¼Œè€Œä¸ç”¨è®°ä½ commit IDã€‚  åˆ‡æ¢åˆ°æ ‡ç­¾ç‰ˆæœ¬





### 1.åˆ›å»ºæ ‡ç­¾

```c
git branch
//åˆ‡æ¢åˆ°éœ€è¦æ‰“æ ‡ç­¾çš„åˆ†æ”¯ä¸Š
git switch master
git tag V1.0 //ç„¶åï¼Œæ•²å‘½ä»¤git tag <name>å°±å¯ä»¥æ‰“ä¸€ä¸ªæ–°æ ‡ç­¾ï¼š

git tag   //å¯ä»¥ç”¨å‘½ä»¤git tagæŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾ï¼š  æ‰“æ ‡ç­¾æ˜¯commitä¸Š
    
/*
é»˜è®¤æ ‡ç­¾æ˜¯æ‰“åœ¨æœ€æ–°æäº¤çš„commitä¸Šçš„ã€‚æœ‰æ—¶å€™ï¼Œå¦‚æœå¿˜äº†æ‰“æ ‡ç­¾ï¼Œæ¯”å¦‚ï¼Œç°åœ¨å·²ç»æ˜¯å‘¨äº”äº†ï¼Œä½†åº”è¯¥åœ¨å‘¨ä¸€æ‰“çš„æ ‡ç­¾æ²¡æœ‰æ‰“ï¼Œæ€ä¹ˆåŠï¼Ÿ
æ–¹æ³•æ˜¯æ‰¾åˆ°å†å²æäº¤çš„commit idï¼Œç„¶åæ‰“ä¸Šå°±å¯ä»¥äº†ï¼š
*/    
     git log --pretty=oneline --abbrev-commit
    //æ¯”æ–¹è¯´è¦å¯¹add mergeè¿™æ¬¡æäº¤æ‰“æ ‡ç­¾ï¼Œå®ƒå¯¹åº”çš„commit idæ˜¯f52c633ï¼Œæ•²å…¥å‘½ä»¤
    $ git tag v0.9 f52c633
//å†ç”¨å‘½ä»¤git tagæŸ¥çœ‹æ ‡ç­¾ï¼š
  git  tag
    //æ³¨æ„ï¼Œæ ‡ç­¾ä¸æ˜¯æŒ‰æ—¶é—´é¡ºåºåˆ—å‡ºï¼Œè€Œæ˜¯æŒ‰å­—æ¯æ’åºçš„ã€‚å¯ä»¥ç”¨git show <tagname>æŸ¥çœ‹æ ‡ç­¾ä¿¡æ¯ï¼š
    git show v0.9
```

```
//å¯ä»¥çœ‹åˆ°ï¼Œv0.9ç¡®å®æ‰“åœ¨add mergeè¿™æ¬¡æäº¤ä¸Šã€‚
$ git show v0.9
commit f52c63349bc3c1593499807e5c8e972b82c8f286 (tag: v0.9)
Author: Michael Liao <askxuefeng@gmail.com>
Date:   Fri May 18 21:56:54 2018 +0800

    add merge

diff --git a/readme.txt b/readme.txt
...

```

```c
//è¿˜å¯ä»¥åˆ›å»ºå¸¦æœ‰è¯´æ˜çš„æ ‡ç­¾ï¼Œç”¨-aæŒ‡å®šæ ‡ç­¾åï¼Œ-mæŒ‡å®šè¯´æ˜æ–‡å­—ï¼š
git tag -a v1.0 -m "è¯´æ˜" commit_id
$ git tag -a v0.1 -m "version 0.1 released" 1094adb

```

æ ‡ç­¾æ€»æ˜¯å’ŒæŸä¸ªcommitæŒ‚é’©ã€‚å¦‚æœè¿™ä¸ªcommitæ—¢å‡ºç°åœ¨masteråˆ†æ”¯ï¼Œåˆå‡ºç°åœ¨devåˆ†æ”¯ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸¤ä¸ªåˆ†æ”¯ä¸Šéƒ½å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ ‡ç­¾ã€‚

#### å°ç»“

- å‘½ä»¤`git tag <tagname>`ç”¨äºæ–°å»ºä¸€ä¸ªæ ‡ç­¾ï¼Œé»˜è®¤ä¸º`HEAD`ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªcommit idï¼›

- å‘½ä»¤`git tag -a <tagname> -m "blablabla..."`å¯ä»¥æŒ‡å®šæ ‡ç­¾ä¿¡æ¯ï¼›

- å‘½ä»¤`git tag`å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾ã€‚

  

### 2. æ“ä½œæ ‡ç­¾

```c
git tag -d v1.0 //å¦‚æœæ ‡ç­¾æ‰“é”™äº†ï¼Œä¹Ÿå¯ä»¥åˆ é™¤
    
    //å¦‚æœè¦æ¨é€æŸä¸ªæ ‡ç­¾åˆ°è¿œç¨‹ï¼Œä½¿ç”¨å‘½ä»¤git push origin <tagname>ï¼š
    git push origin v1.0
    // ä¸€æ¬¡æ€§æ¨é€å…¨éƒ¨å°šæœªæ¨é€åˆ°è¿œç¨‹çš„æœ¬åœ°æ ‡ç­¾ï¼š
    git push origin --tags
    
    //å¦‚æœæ ‡ç­¾å·²ç»æ¨é€åˆ°è¿œç¨‹ï¼Œè¦åˆ é™¤è¿œç¨‹æ ‡ç­¾å°±éº»çƒ¦ä¸€ç‚¹ï¼Œå…ˆä»æœ¬åœ°åˆ é™¤ï¼š
    git tag -d v0.9
    git push origin :refs/tags/v0.9 //ç„¶åï¼Œä»è¿œç¨‹åˆ é™¤ã€‚åˆ é™¤å‘½ä»¤ä¹Ÿæ˜¯pushï¼Œä½†æ˜¯æ ¼å¼å¦‚ä¸‹ï¼š
    
```

#### å°ç»“

- å‘½ä»¤`git push origin <tagname>`å¯ä»¥æ¨é€ä¸€ä¸ªæœ¬åœ°æ ‡ç­¾ï¼›
- å‘½ä»¤`git push origin --tags`å¯ä»¥æ¨é€å…¨éƒ¨æœªæ¨é€è¿‡çš„æœ¬åœ°æ ‡ç­¾ï¼›
- å‘½ä»¤`git tag -d <tagname>`å¯ä»¥åˆ é™¤ä¸€ä¸ªæœ¬åœ°æ ‡ç­¾ï¼›
- å‘½ä»¤`git push origin :refs/tags/<tagname>`å¯ä»¥åˆ é™¤ä¸€ä¸ªè¿œç¨‹æ ‡ç­¾ã€‚





#### å®Œæ•´ç¤ºä¾‹æµç¨‹**

**åœºæ™¯ï¼šä¿®å¤æ—§ç‰ˆæœ¬ `v1.0.0` çš„ Bug**

1. **æŸ¥çœ‹æ ‡ç­¾**ï¼š

   bash

   ```
   git tag
   ```

   è¾“å‡ºï¼š

   text

   ```
   v1.0.0
   v1.1.0
   v2.0.0
   ```

2. **åŸºäº `v1.0.0` åˆ›å»ºä¿®å¤åˆ†æ”¯**ï¼š

   bash

   ```
   git checkout -b fix-bug-v1.0.0 v1.0.0
   ```

3. **ä¿®æ”¹ä»£ç å¹¶æäº¤**ï¼š

   bash

   ```
   vim app.js  # ä¿®å¤ Bug
   git add app.js
   git commit -m "ä¿®å¤ v1.0.0 çš„ç™»å½•é—®é¢˜"
   ```

4. **å¯é€‰ï¼šåˆå¹¶å› `master`ï¼ˆå¦‚æœéœ€è¦ï¼‰**ï¼š

   bash

   ```
   git checkout master
   git merge fix-bug-v1.0.0
   ```

**æ€»ç»“**

| æ“ä½œ                       | å‘½ä»¤                              | è¯´æ˜                              |
| :------------------------- | :-------------------------------- | :-------------------------------- |
| **æŸ¥çœ‹æ ‡ç­¾**               | `git tag`                         | åˆ—å‡ºæ‰€æœ‰æ ‡ç­¾                      |
| **åŸºäºæ ‡ç­¾åˆ›å»ºåˆ†æ”¯**       | `git checkout -b æ–°åˆ†æ”¯å æ ‡ç­¾å` | ä»æ ‡ç­¾åˆ›å»ºå¯ä¿®æ”¹çš„åˆ†æ”¯            |
| **ç›´æ¥åˆ‡æ¢åˆ°æ ‡ç­¾ï¼ˆåªè¯»ï¼‰** | `git checkout æ ‡ç­¾å`             | è¿›å…¥ `detached HEAD` çŠ¶æ€ï¼ˆæ…ç”¨ï¼‰ |

**å…³é”®ç‚¹**ï¼š
âœ… **æ ‡ç­¾æ˜¯åªè¯»çš„**ï¼Œè¦ä¿®æ”¹ä»£ç å¿…é¡»**å…ˆåˆ›å»ºåˆ†æ”¯**ã€‚
âœ… **æ–°åˆ†æ”¯å’Œ `master` æ— å…³**ï¼Œé™¤éä½ ä¸»åŠ¨åˆå¹¶ã€‚
âœ… **é€‚ç”¨äºä¿®å¤æ—§ç‰ˆæœ¬ Bug**ï¼Œè€Œä¸ä¼šå½±å“æœ€æ–°ä»£ç ã€‚

ç°åœ¨ä½ åº”è¯¥æ¸…æ¥šæ•´ä¸ªæµç¨‹äº†ï¼å¦‚æœè¿˜æœ‰ç–‘é—®ï¼Œæ¬¢è¿ç»§ç»­æé—® ğŸ˜Š
